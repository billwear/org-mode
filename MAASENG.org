#+STARTUP: showeverything
* TODO [#C] Subnets table consistent with new layout
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2431
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-11-23 09:39:55
:Modified: 2023-11-23 12:43:58
:END:
** Description
- The Subnets/Spaces page
    - has two buttons that act as group, we should make it a group
    - table should use the same layout as the machine listing table, one should think of the layout as in “grouped by fabric” or “grouped by space”
** Comments
* DONE [#C] Subnets Table layout from the machine list page
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2435
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Sub-task
:Created:  2023-11-24 12:41:13
:Modified: 2023-11-28 15:37:29
:END:
** Description
Subnets table grouping currently:

!Google Chrome screenshot 001135@2x-20231124-124217.png|width=1581,height=493!

should be made consistent with machine list table layout below:

!Google Chrome screenshot 001133@2x-20231124-124155.png|width=1585,height=672!

Collapsing of groups and other extra features available on machine listing are nice to have, but not required. This is mostly about visual consistency.



This will resolve [[https://bugs.launchpad.net/maas/+bug/1996500|smart-link][https://bugs.launchpad.net/maas/+bug/1996500]]
** Comments
*** [2023-11-27 Mon 14:22] Jones Ogolo
:PROPERTIES:
:CommId:   347461
:TYPE:     ejira-comment
:Author:   Jones Ogolo
:Created:  2023-11-27 14:22:06
:END:
I’ve had a look at [[https://bugs.launchpad.net/maas/+bug/1996500|smart-link][https://bugs.launchpad.net/maas/+bug/1996500]] . I’m curious to understand how updating the table layout fixes this bug, from what I can infer from the machine list page, we’d have the spill overs still grouped under the fabric name with the total count, like so:

!image-20231127-142120.png|width=1176,height=598!

Would there ba any extra changes?
*** [2023-11-27 Mon 15:04] Thorsten Merten
:PROPERTIES:
:CommId:   347519
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-11-27 15:04:12
:Modified: 2023-11-27 15:05:36
:END:
In my understanding it can always happen that an item spills over to the next page. However, if we group them in the same way (using the same UX as for machines), it should be clearer. Especially if we add the “group header” on the 2nd page as well (which might be one source of the confusion in the linked bug).
* DONE [#C] Display fabric and space as group by
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2434
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Sub-task
:Created:  2023-11-24 12:39:19
:Modified: 2023-11-24 14:07:06
:END:
** Description
!Google Chrome screenshot 001131@2x-20231124-123953.png|width=214,height=151!
** Comments
* TODO [#C] As a MAAS user, I want to be able to choose scripts to be executed during the machine release life cycle
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2299
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-10-18 21:44:07
:Modified: 2023-10-18 21:44:08
:END:
** Description
** Comments
* TODO [#C] Create script result set for release scripts
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2390
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee: Alberto Donato
:Issuetype: Sub-task
:Created:  2023-11-15 11:23:08
:Modified: 2023-11-15 11:23:20
:END:
** Description
** Comments
* TODO [#C] Update scripts section in the documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2302
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2023-10-18 21:44:47
:Modified: 2023-10-18 21:44:48
:END:
** Description
** Comments
* DONE [#C] Migrate Navigation components to component library
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2281
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-10-17 08:46:30
:Modified: 2023-11-06 13:49:11
:END:
** Description
Both Navigation in maas-site-manager and  AppSideNavigation components need to be migrated to the component library.

Refer to the spec (in particular the Compound Component example of Navigation): [[https://docs.google.com/document/d/1O5DNfiTrc87WYAE4e1XSbx6Jj1dCq25QMoEHA2MewH4/edit#heading=h.u5qdczjzqjs0|smart-link][https://docs.google.com/document/d/1O5DNfiTrc87WYAE4e1XSbx6Jj1dCq25QMoEHA2MewH4/edit#heading=h.u5qdczjzqjs0]]



And live documentation: [[https://github.com/canonical/maas-react-components/blob/main/GUIDELINES.md|smart-link][https://github.com/canonical/maas-react-components/blob/main/GUIDELINES.md]]
** Comments
* TODO [#C] [Dev] Disable expand on hover
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2346
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Sub-task
:Created:  2023-10-26 09:20:56
:Modified: 2023-10-26 09:22:22
:END:
** Description
The design team is currently working on a universal version of the side navigation that all teams can use. In this version, the navigation will only expand when you click the button to do so (or the keyboard shortcut). We should mirror this behaviour in maas-react-components.
** Comments
* DONE [#C] As a MAAS user I want to make a diskless deploy Ubuntu 18.04+ for a machine that has disks
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2128
:TYPE:     ejira-story
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Story
:Created:  2023-08-29 09:17:42
:Modified: 2023-08-29 09:18:18
:END:
** Description
** Comments
* DONE [#C] setup copr repository to deliver a cloud-init package for centos/rhel built from source
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2217
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Jacopo Rota
:Assignee: Jacopo Rota
:Issuetype: Sub-task
:Created:  2023-09-29 14:32:40
:Modified: 2023-09-29 14:32:49
:END:
*** Description
*** Comments
* TODO [#C] configure network for custom images with cloud-init
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2171
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-09-18 13:44:55
:Modified: 2023-09-18 13:44:55
:END:
** Description
** Comments
* TODO [#C] Investigate what is required for an image to be deployed to RAM
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2133
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Sub-task
:Created:  2023-08-29 09:24:09
:Modified: 2023-08-29 09:24:10
:END:
** Description
** Comments
* TODO [#C] [Dev] Map spec + download and packaging
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2100
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-08-16 12:22:40
:Modified: 2023-08-30 11:46:10
:END:
** Description
Once the map spec is finished we need to implement a pipeline that

- downloads map data
- removes unnecessary data (e.g. walking paths, traffic signs, speed limits, …)
- defines the data we want to show per zoom level
- (possibly) styles the vector graphics
    - otherwise we need to have an option applying styles later
- packages it as an =.mbtile= format

See the frontend map spec for details on what necessary data is and what we want to show on which zoom level(s).

Assuming we have some steps to create tiles “by hand” (e.g. copy and pasting in a terminal)  we should create a small shell script (e.g. a bash script) that executes all of the steps and share this in a branch for review.
Also we could add  a [[http://README.md][README.md]] file describing how to do it by hand.
** Comments
*** [2023-08-16 Wed 12:27] Thorsten Merten
:PROPERTIES:
:CommId:   296479
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-08-16 12:27:27
:END:
We have access to hosts on Prodstack 5 with lots of RAM. So once we have a script/idea how to do this for a small region (e.g. once country) we can run it for the whole world there.
* TODO [#C] Style the vector graphics (the tiles)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2138
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-08-30 11:50:42
:Modified: 2023-08-30 11:56:00
:END:
** Description
We have an initial idea of a style file from maputnik created by Max (below). We need to instruct =tilemaker= to apply the styles correctly.

- take the json below
- change the =id= and possibly =type= to match the names from the tiles (e.g. via =tileinfo=)
- inject the modified json file in the build process by telling =tilemaker= how to style the tiles



{noformat}{
  "version": 8,
  "name": "Toner",
  "metadata": {
    "mapbox:autocomposite": false,
    "mapbox:type": "template",
    "openmaptiles:version": "3.x",
    "openmaptiles:mapbox:owner": "openmaptiles",
    "openmaptiles:mapbox:source:url": "mapbox://openmaptiles.4qljc88t",
    "maputnik:thunderforest_access_token": "7692c387aa79428386997988618083b7"
  },
  "center": [20.838971352362933, 47.241654485577584],
  "zoom": 2.8784041883593225,
  "bearing": 0,
  "pitch": 0,
  "sources": {
    "openmaptiles": {
      "type": "vector",
      "url": "https://api.maptiler.com/tiles/v3/tiles.json?key=cWp8MkNxUqqUIxJBqNj1"
    }
  },
  "glyphs": "https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=cWp8MkNxUqqUIxJBqNj1",
  "layers": [
    {
      "id": "background",
      "type": "background",
      "layout": {"visibility": "visible"},
      "paint": {"background-color": "rgba(243, 243, 243, 1)"}
    },
    {
      "id": "water",
      "type": "fill",
      "source": "openmaptiles",
      "source-layer": "water",
      "filter": ["all", ["==", "class", "ocean"]],
      "layout": {"visibility": "visible"},
      "paint": {"fill-color": "rgba(51, 51, 51, 1)"}
    },
    {
      "id": "water_inland",
      "type": "fill",
      "source": "openmaptiles",
      "source-layer": "water",
      "filter": ["all", ["!=", "class", "ocean"]],
      "layout": {"visibility": "visible"},
      "paint": {"fill-color": "rgba(215, 223, 232, 1)"}
    },
    {
      "id": "building-top",
      "type": "fill",
      "metadata": {"mapbox:group": "1444849364238.8171"},
      "source": "openmaptiles",
      "source-layer": "building",
      "layout": {"visibility": "visible"},
      "paint": {
        "fill-translate": {"base": 1, "stops": [[14, [0, 0]], [16, [-2, -2]]]},
        "fill-outline-color": "rgba(181, 180, 179, 1)",
        "fill-color": "rgba(249, 249, 249, 1)",
        "fill-opacity": {"base": 1, "stops": [[13, 0], [16, 1]]}
      }
    },
    {
      "id": "transportation-copy",
      "type": "line",
      "metadata": {},
      "source": "openmaptiles",
      "source-layer": "transportation",
      "minzoom": 5,
      "filter": [
        "all",
        ["==", "$type", "LineString"],
        ["==", "class", "minor"]
      ],
      "layout": {"visibility": "visible"},
      "paint": {
        "line-width": {"stops": [[12, 0.5], [16, 1], [17, 3]]},
        "line-color": {
          "stops": [[12, "rgba(212, 209, 209, 1)"], [16, "rgba(8, 8, 8, 1)"]]
        }
      }
    },
    {
      "id": "transportation-2-copy",
      "type": "line",
      "metadata": {},
      "source": "openmaptiles",
      "source-layer": "transportation",
      "minzoom": 5,
      "filter": [
        "all",
        ["==", "$type", "LineString"],
        ["==", "class", "tertiary"]
      ],
      "layout": {"visibility": "none"},
      "paint": {
        "line-width": {"stops": [[12, 0.5], [16, 1], [17, 3]]},
        "line-color": {
          "stops": [[12, "rgba(212, 209, 209, 1)"], [16, "rgba(8, 8, 8, 1)"]]
        }
      }
    },
    {
      "id": "transportation-2",
      "type": "line",
      "metadata": {},
      "source": "openmaptiles",
      "source-layer": "transportation",
      "minzoom": 5,
      "filter": [
        "all",
        ["==", "$type", "LineString"],
        ["==", "class", "secondary"]
      ],
      "layout": {"visibility": "visible"},
      "paint": {
        "line-width": {"stops": [[12, 0.5], [16, 1], [17, 3]]},
        "line-color": {
          "stops": [[12, "rgba(212, 209, 209, 1)"], [16, "rgba(8, 8, 8, 1)"]]
        }
      }
    },
    {
      "id": "transportation",
      "type": "line",
      "metadata": {},
      "source": "openmaptiles",
      "source-layer": "transportation",
      "minzoom": 5,
      "filter": [
        "all",
        ["==", "$type", "LineString"],
        ["==", "class", "primary"]
      ],
      "layout": {"visibility": "visible"},
      "paint": {
        "line-width": {"stops": [[12, 0.5], [16, 1], [17, 3]]},
        "line-color": {
          "stops": [[12, "rgba(212, 209, 209, 1)"], [16, "rgba(8, 8, 8, 1)"]]
        }
      }
    },
    {
      "id": "highway-name-minor",
      "type": "symbol",
      "source": "openmaptiles",
      "source-layer": "transportation_name",
      "minzoom": 15,
      "filter": [
        "all",
        ["==", "$type", "LineString"],
        ["in", "class", "minor", "service"],
        ["==", "c", ""]
      ],
      "layout": {
        "text-size": {"base": 1, "stops": [[13, 12], [14, 13]]},
        "text-font": ["Noto Sans Regular"],
        "text-field": "{name:latin} {name:nonlatin}",
        "symbol-placement": "line",
        "text-rotation-alignment": "map",
        "visibility": "visible"
      },
      "paint": {
        "text-halo-blur": 0.5,
        "text-color": "rgba(0, 0, 0, 1)",
        "text-halo-width": 1,
        "text-halo-color": "rgba(255, 255, 255, 1)"
      }
    },
    {
      "id": "highway-name-major",
      "type": "symbol",
      "source": "openmaptiles",
      "source-layer": "transportation_name",
      "minzoom": 12.2,
      "filter": ["all", ["in", "class", "primary", "secondary", "tertiary"]],
      "layout": {
        "text-size": {"base": 1, "stops": [[13, 12], [14, 13]]},
        "text-font": ["Noto Sans Regular"],
        "text-field": "{name:latin} {name:nonlatin}",
        "symbol-placement": "line",
        "text-rotation-alignment": "map",
        "visibility": "visible"
      },
      "paint": {
        "text-halo-blur": 0.5,
        "text-color": "rgba(0, 0, 0, 1)",
        "text-halo-width": 1,
        "text-halo-color": "rgba(255, 255, 255, 1)"
      }
    },
    {
      "id": "place_label_city",
      "type": "symbol",
      "source": "openmaptiles",
      "source-layer": "place",
      "maxzoom": 16,
      "filter": ["all", ["==", "$type", "Point"], ["==", "class", "city"]],
      "layout": {
        "text-field": "{name:latin}ogiqpgcmfvhruhxzunktjiictzuqfqjzn{name:nonlatin}",
        "text-font": ["Noto Sans Regular"],
        "text-max-width": 10,
        "text-size": {"stops": [[3, 12], [8, 16]]},
        "visibility": "visible"
      },
      "paint": {
        "text-color": "hsl(0, 0%, 0%)",
        "text-halo-color": "hsla(0, 0%, 100%, 0.75)",
        "text-halo-blur": 0,
        "text-halo-width": 2
      }
    },
    {
      "id": "place-country",
      "type": "symbol",
      "source": "openmaptiles",
      "source-layer": "place",
      "filter": ["==", "class", "country"],
      "layout": {
        "visibility": "visible",
        "text-field": "{name:latin}",
        "text-font": ["Noto Sans Bold"],
        "text-size": 12
      },
      "paint": {"text-halo-color": "#fff", "text-halo-width": 1.5}
    },
    {
      "id": "boundary_state",
      "type": "line",
      "metadata": {"mapbox:group": "a14c9607bc7954ba1df7205bf660433f"},
      "source": "openmaptiles",
      "source-layer": "boundary",
      "minzoom": 4,
      "filter": ["==", "admin_level", 4],
      "layout": {
        "line-cap": "round",
        "line-join": "round",
        "visibility": "visible"
      },
      "paint": {
        "line-color": "rgba(72, 70, 70, 1)",
        "line-width": {"base": 1.3, "stops": [[3, 1.5], [22, 15]]},
        "line-blur": 0.4,
        "line-dasharray": [0.5, 2],
        "line-opacity": 1
      }
    },
    {
      "id": "boundary_country",
      "type": "line",
      "metadata": {"mapbox:group": "a14c9607bc7954ba1df7205bf660433f"},
      "source": "openmaptiles",
      "source-layer": "boundary",
      "filter": ["all", ["==", "admin_level", 2], ["==", "maritime", 0]],
      "layout": {
        "line-cap": "round",
        "line-join": "round",
        "visibility": "visible"
      },
      "paint": {
        "line-color": "rgba(0, 0, 0, 1)",
        "line-width": {"base": 1.1, "stops": [[3, 2], [22, 20]]},
        "line-blur": {"base": 1, "stops": [[0, 0.4], [22, 4]]},
        "line-opacity": 1
      }
    }
  ],
  "id": "ciwigmbgt00fw2ps58s6klalp"
}{noformat}
** Comments
* TODO [#C] Remove unnecessary data (e.g. walking paths, traffic signs, speed limits, …)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2137
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-08-30 11:47:11
:Modified: 2023-08-30 11:50:16
:END:
** Description
When we download map data from Open Street Map (OSM) it includes everything that is available (including walking paths, traffic signs, speed limits, etc.).

However Max specified some data per zoom level in the spec.

We need to instruct =tilemaker= to discard all data not specified by Max (or include only the data specified, whatever is more convenient and whatever =tilemaker= understands).
** Comments
* DONE [#C] MAAS logs in systemd journal
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2044
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Igor Brovtsin
:Assignee:
:Issuetype: Task
:Created:  2023-08-01 13:45:48
:Modified: 2023-08-01 13:45:48
:END:
** Description
** Comments
* DONE [#C] Update Ansible playbooks o11y configuration
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2112
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Eline Maaike de Weerd
:Assignee: Eline Maaike de Weerd
:Issuetype: Sub-task
:Created:  2023-08-22 08:42:47
:Modified: 2023-10-10 07:17:40
:END:
*** Description
Ansible playbooks to be updated to generate the correct configuration to collect logs from the systemd journal
*** Comments
* DONE [#C] Update o11y documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2111
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Eline Maaike de Weerd
:Assignee: Eline Maaike de Weerd
:Issuetype: Sub-task
:Created:  2023-08-22 08:42:01
:Modified: 2023-10-10 07:16:12
:END:
*** Description
Documentation about o11y setup is updated to match the new layout.

There’s documentation about how to migrate existing o11y setups to the new configuration.
*** Comments
* TODO [#C] Update sample Grafana configuration
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2110
:TYPE:     ejira-subtask
:Status:   In Review
:Reporter: Eline Maaike de Weerd
:Assignee: Eline Maaike de Weerd
:Issuetype: Sub-task
:Created:  2023-08-22 08:41:17
:Modified: 2023-11-27 07:02:52
:END:
** Description
The sample configuration for grafana-agent needs to be updated to scrape logs from the system journal. It should also contain comments about what needs to be modified for snap/deb cases.
** Comments
* TODO [#C] Update the documentation with the new commands to access the logs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2054
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Igor Brovtsin
:Assignee:
:Issuetype: Sub-task
:Created:  2023-08-01 13:52:01
:Modified: 2023-08-01 13:52:02
:END:
** Description
** Comments
* TODO [#B] Use MainToolbar across all main pages in maas-site-manager
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2441
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-11-28 14:09:06
:Modified: 2023-11-28 15:37:12
:END:
** Description
** Comments
* TODO [#B] Use MainToolbar across all main pages in maas-ui
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2440
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-11-28 14:08:10
:Modified: 2023-11-28 14:09:22
:END:
** Description
As an example, =MachineListControls= should render the MainToollbar component instead of using custom style declarations.
** Comments
* TODO [#C] DHCP in Go (Spike)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2437
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-11-27 13:40:54
:Modified: 2023-11-27 14:29:40
:END:
** Description
- */Please provide a concise description of the problem statement:/*

We thought about [[https://warthogs.atlassian.net/browse/PF-3898][running DHCP on the region using KEA and proxying the requests on the racks with something written ourselves in golang]]. In the Riga discussion it was revealed that this architecture can be a bottleneck, if many rackds forward DHCP requests from machines at the same time. This is especially a problem with virtual machines, as many of which can come up at the same time.
That said, we cant the rackd to be unit of scale. This means that MAAS should scale out rather linearily when adding more rackds for everything that requires compute.

Because of this we want to

1. provide DHCP on the rack itself and
2. make this DHCP possible in a high availability setting (e.g. 2 rackds should be able to share the responsibility and continue the service if one of them goes down)
    1. a suggested technology for this was dqlite and we should investigate this
    2. so far we found the following libraries, both of which did not serve our needs fully: [[https://github.com/insomniacslk/dhcp|smart-link][https://github.com/insomniacslk/dhcp]]  and [[https://github.com/coredhcp/coredhcp|smart-link][https://github.com/coredhcp/coredhcp]]

In this spike we want to:

- Understand the amount of work necessary to do a full DHCP implementation in GO (have reliable estimates)
- Select the technology to do so
- Have some code in golang to build upon
- Some knowledge on how good the solution scales (e.g. how many DHCP requests our solution can serve / time)
-  Create a specification containing all the information above and a rough execution plan (e.g. the steps necessary to achieve the goal and knowledge which of those will be potentially problematic)
- */Please provide an outline of the proposed solution and example use-case:/*

A MAAS installation adds 200 new servers. We want to be able to add another rackd and it should not be a problem to serve DHCP to those servers and (reasonable amounts of) virtual instances on them.

Additional resources:

- [[https://github.com/facebookincubator/dhcplb][+dhcplb is Facebook's implementation of a load balancer for DHCP.+]]
- [[https://engineering.fb.com/2016/09/13/data-infrastructure/dhcplb-an-open-source-load-balancer/|smart-link][https://engineering.fb.com/2016/09/13/data-infrastructure/dhcplb-an-open-source-load-balancer/]]
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

MAAS operators

- */What are the functional requirements and acceptance criteria of the requested solution?/*

Quality requirements:

- Pure golang implementation that can be run in the rackd without watching over external processes
- The concept works without involving KEA and or DHCPd
- We know how well the concept scales

Functional requirements (in addition to the general description above):

- The concept supports reservation of IPs (for devices and machines)
- The concept
- The concept includes a way to query “what’s going on” in the networks from the UI or CLI
    - the CEO suggested querying the rackds live when such a request is made by the user; we should investigate this and also other solutions (e.g. using dqlite to communicate the state to the rack)



- */What other considerations need to be factored in (eg security, compliance, stability)/*

none

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

-

- */How critical is this idea to the success of the product?/*

We will need to replace DHCPd due to it not being maintained anymore. Independently of the solution we provide, this item is critical for maintainability and security.
** Comments
*** [2023-11-27 Mon 14:29] Thorsten Merten
:PROPERTIES:
:CommId:   347465
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-11-27 14:29:16
:END:
Other relevant requirements from our previous discussion on using KEA

1. [Rough sizing: S] Make MAAS aware of lease changes (subscribe, poll, or query, we need to figure out the best way)
2. [Rough sizing: S] Update HA docs & configuration & tests
3. [Rough sizing: M] Test upgrades from DHCPs to “own DHCP” versions of MAAS, considering different starting MAAS versions and DHCP configurations.
4. Add option to configure dhcp lease time in MAAS: start with global setting. For the future, consider option to change commissioning lease time or lease time per subnet or per pool.

To be defined further: Which other DHCP options could be relevant. This needs additional UX research and researching what other servers (such as KEA) offer.
* DONE [#C] Investigate current state of the DPU and try to enlist it into MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2436
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-11-24 15:17:27
:Modified: 2023-11-24 15:20:16
:END:
** Description
** Comments
*** [2023-11-24 Fri 15:20] Bjorn Tillenius
:PROPERTIES:
:CommId:   345575
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-24 15:20:16
:END:
Did some preliminary work, like installing rshim and the doca tools on the host, and poked around into the running DPU.

I was able to see the console of the DPU using /dev/rshim0/console from the host. The DPU currently has the following kernel command line arguments:

linux   /boot/vmlinuz-5.15.0-1021-bluefield root=UUID=154faa8f-f78c-45fd-b3df-98ade82efe3a ro console=hvc0 console=ttyAMA0 earlycon=pl011,0x13010000 fixrtc net.ifnames=0 biosdevname=0 iommu.passthrough=1 console=tty1 console=ttyS0

Next week I’ll use efibootmgr to make it PXE boot and see what happens when I try to enlist it into labmaas.
* DONE [#C] Additional metrics: error rate
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2433
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Eline Maaike de Weerd
:Assignee: Eline Maaike de Weerd
:Issuetype: Task
:Created:  2023-11-23 14:47:40
:Modified: 2023-11-23 14:47:41
:END:
** Description
Error rate metric to be added
** Comments
* DONE [#C] Create main view component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2432
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-11-23 09:52:01
:Modified: 2023-11-27 16:00:36
:END:
** Description
Some of the main pages ( those accessible via the side navigation) often contain similar elements such as headings, buttons, search bars, tabs, tables, etc., but arranged in a slightly different way.

We should find out where these different approaches actually make sense and where they are simply an historical development and then align them where it actually makes sense to make MAAS's pages more consistent.

An approach to this is to use the same component for all of these elements so they’re rendered in the same way.

- The machines list has the buttons and search elements in the first row, next to the header. All other pages have the search bar and buttons on the next row.
    - We should check if we can apply the same design on the other pages to save space
    - When there are tabs, we should not move the search up to the first row, it needs to stay below the tabs
- On the machine details page the buttons should also be at the top row and aligned to the right
    - [~accountid:63b3c5e878aabbefa9d429f0] will add input how to display the power information in a better way, so that it’s clear that the question-mark and the text belongs together (e.g. a chip)

[[https://www.figma.com/file/a8OV0Ms0ST78bEyqTiDr7b/Main-pages-consistency?type=design&node-id=1-8518&mode=design][Main pages consistency]] [[https://app.zeplin.io/project/655b96b42ec75d1fab5a3d5c/screen/655b96f72f65141ff278aca1|smart-link][https://app.zeplin.io/project/655b96b42ec75d1fab5a3d5c/screen/655b96f72f65141ff278aca1]]
** Comments
* TODO [#C] Uniform pagination across maas-ui and maas-site-manager
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2430
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-11-23 09:36:03
:Modified: 2023-11-28 15:41:28
:END:
** Description
** Comments
* DONE [#C] Create pagination component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2429
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-11-23 09:29:07
:Modified: 2023-11-27 10:56:09
:END:
** Description
Pagination has different font weight and uses different components. We should use the machine listing pagination component on all pages
** Comments
* DONE [#C] Contextual Menu: auto adjust vertical position
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2428
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-11-22 15:43:20
:Modified: 2023-11-22 15:43:26
:END:
** Description
** Comments
* TODO [#C] Determine format of compatibility matrix
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2424
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Jack Lloyd-Walters
:Assignee: Stamatis Katsaounis
:Issuetype: Task
:Created:  2023-11-21 15:35:09
:Modified: 2023-11-28 15:32:19
:END:
** Description
** Comments
* DONE [#C] Onboard to shared temporal infrastructure
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2423
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Jack Lloyd-Walters
:Assignee: Stamatis Katsaounis
:Issuetype: Task
:Created:  2023-11-21 15:34:31
:Modified: 2023-11-21 15:34:43
:END:
** Description
** Comments
* TODO [#C] Automatic triggering of testing workflows
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2422
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-11-21 15:34:13
:Modified: 2023-11-21 15:36:04
:END:
** Description
** Comments
* DONE [#C] Automatic triggering of promotion workflows
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2421
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters
:Issuetype: Task
:Created:  2023-11-21 15:34:01
:Modified: 2023-11-28 15:32:05
:END:
** Description
** Comments
* TODO [#C] Investigate candidate image failures
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2420
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters
:Issuetype: Bug
:Created:  2023-11-21 15:33:33
:Modified: 2023-11-23 15:29:13
:END:
** Description
** Comments
* DONE [#C] Assist in moving a machine (gloat) with BF3 DPUs from Partner Engineering
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2418
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-11-21 10:29:00
:Modified: 2023-11-23 08:45:45
:END:
** Description
** Comments
*** [2023-11-22 Wed 15:39] Bjorn Tillenius
:PROPERTIES:
:CommId:   343896
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-22 15:39:21
:END:
The machine we’re getting is this one: [[http://10.229.32.21:5240/MAAS/r/machine/n3qqqk/summary][http://10.229.32.21:5240/MAAS/r/machine/n3qqqk/summary]]

I think it should be connected to our VLAN, except for the BMC. The plan is to try to enlist it in our MAAS, and when we that everything is connected correctly, we switch over the BMC as well.

I’ll take a stab at this tomorrow.
*** [2023-11-23 Thu 08:45] Bjorn Tillenius
:PROPERTIES:
:CommId:   344302
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-23 08:45:45
:END:
The situation is that one of the main NICs is connected to the PE VLAN, and the other to our VLAN.

It was tricky to get it to PXE boot against our VLAN, since the other NIC wasn’t available as boot option.

I had to go into the bios, in “Network Settings”. There I had to enable “PXE Device2”. In addition to that, I also had to go into “PXE Device2 Settings” and change the “Interface” to “Embedded NIC 2 Port 1 Partition 1”.
* TODO [#C] Release 3.4.0
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2417
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Alberto Donato
:Assignee: Alberto Donato
:Issuetype: Task
:Created:  2023-11-21 08:25:48
:Modified: 2023-11-21 15:32:20
:END:
** Description
** Comments
* DONE [#C] Windows packer-maas template
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2416
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Task
:Created:  2023-11-20 15:33:21
:Modified: 2023-11-20 15:33:40
:END:
** Description
[[https://github.com/canonical/packer-maas/pull/162][https://github.com/canonical/packer-maas/pull/162]]
** Comments
* DONE [#C] Deploy FIPS kernel with MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2414
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Javier Fuentes
:Assignee: Javier Fuentes
:Issuetype: Task
:Created:  2023-11-20 14:35:03
:Modified: 2023-11-27 17:24:04
:END:
** Description
Deploy VM and enable FIPS using MAAS.

This process should be similar to deploying a VM and enable real time kernel.
** Comments
*** [2023-11-23 Thu 09:43] Javier Fuentes
:PROPERTIES:
:CommId:   344358
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-23 09:43:40
:END:
*TLDR:* VM can be deployed and enabled FIPS using cloud-init MAAS, but one needs to use certain cloud-init config file.
*** [2023-11-23 Thu 09:43] Javier Fuentes
:PROPERTIES:
:CommId:   344360
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-23 09:43:47
:Modified: 2023-11-27 16:58:52
:END:
***** Experiment 1: description of the deployment process and environment

Run MAAS in dev env mode (I have used [[https://github.com/maas/maas-dev-setup/tree/main][Thorsten’s instructions]] in Ubuntu 22.04), and proceed as follows:

{color:#ff5630}1){color} Create and compose a new VM using the default configuration

+Compose+

VM name: cloudinit-machine
Cores: 1 (any available)
RAM (MiB): 2048

+Interfaces+

Name: default
IP address: created by hypervisor at compose time

+Storage configuration+

Size (GB): 8
Location: default

{color:#ff5630}2){color} Deploy the VM with the cloud-init config file

OS: Ubuntu
Release: Ubuntu 22.04 LTS "Jammy Jellyfish"
Kernel: No minimum kernel

+Deployment target+

Deploy to disk

+Customise options+

[X] Cloud-init user-data...

{noformat}#cloud-config
runcmd:
  - echo "INFO_RUN apt update"
  - apt update
  - echo "INFO_RUN apt upgrade"
  - apt upgrade -y
  - echo "INFO_RUN attach pro license"
  - pro attach <Ubuntu PRO token>
  - echo "INFO_RUN enable esm"
  - pro enable esm-infra
  - echo "INFO_RUN enable fips-updates"
  - pro enable --assume-yes fips-updates
  - echo "INFO_RUN apt upgrade"
  - apt upgrade -y
  - echo "INFO_RUN reboot"
  - reboot{noformat}

{color:#ff5630}3){color} Verify deployment status

ssh into the machine once the deployment is done.

{noformat}> ssh ubuntu@<assigned_ip>{noformat}

Wait for =cloud-init= to finish (if you ssh-ed into the machine too soon you might be kicked out because of the =reboot= command):

{noformat}> cloud-init status --wait{noformat}

Check the status of the Ubuntu Pro services:

{noformat}> pro status --all
SERVICE          ENTITLED  STATUS       DESCRIPTION
anbox-cloud      yes       disabled     Scalable Android in the cloud
cc-eal           yes       n/a          Common Criteria EAL2 Provisioning Packages
esm-apps         yes       enabled      Expanded Security Maintenance for Applications
esm-infra        yes       enabled      Expanded Security Maintenance for Infrastructure
fips             yes       n/a          NIST-certified FIPS crypto packages
fips-preview     yes       n/a          Preview of FIPS crypto packages undergoing certification with NIST
fips-updates     yes       enabled      FIPS compliant crypto packages with stable security updates
livepatch        yes       warning      Current kernel is not supported
realtime-kernel  yes       disabled     Ubuntu kernel with PREEMPT_RT patches integrated
├ generic        yes       disabled     Generic version of the RT kernel (default)
└ intel-iotg     yes       disabled     RT kernel optimized for Intel IOTG platform
ros              yes       n/a          Security Updates for the Robot Operating System
ros-updates      yes       n/a          All Updates for the Robot Operating System
usg              yes       disabled     Security compliance and audit tools

NOTICES
The current kernel (5.15.0-73-fips, x86_64) is not supported by livepatch.
Supported kernels are listed here: https://ubuntu.com/security/livepatch/docs/kernels
Either switch to a supported kernel or `pro disable livepatch` to dismiss this warning.

Enable services with: pro enable <service>

     Account: <email account associated to the Ubuntu Pro Token>
Subscription: Ubuntu Pro - free personal subscription{noformat}

{color:#ff5630}Conclusion{color}

MAAS can deploy VMs and enable FIPS using cloud-init.
*** [2023-11-23 Thu 10:00] Javier Fuentes
:PROPERTIES:
:CommId:   344386
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-23 10:00:19
:Modified: 2023-11-27 16:59:12
:END:
***** Experiment 2: description of the deployment process and environment

The environment and configuration is exactly as before. The only change is the cloud-init config file.

{color:#ff5630}1){color} Create and compose a new VM using the default configuration

{color:#ff5630}2){color}  Deploy the VM with the cloud-init config file

[X] Cloud-init user-data...

{noformat}#cloud-config
package_upgrade: true
packages:
 - python3-pip
ubuntu_advantage:
  token: <Ubuntu PRO token>
  enable:
    - esm{noformat}

Upgrading the packages to use the latest version. Installing python3-pip to verify that the cloud-init was loaded and executed (at least partially).

{color:#ff5630}3){color} Verify deployment status

Based on MAAS feedback (GUI icons and logs) the VM is deployed successfully. Technically, the machine is up and running but if we ssh into the VM we see that there was an error.

{noformat}> ssh ubuntu@<assigned_ip>
> cloud-init status
status: error{noformat}

To get more detail about the error, you can either use the request more information to the cloud-init command:

{noformat}> cloud-init status
status: error
boot_status_code: enabled-by-generator
last_update: Thu, 23 Nov 2023 10:18:43 +0000
detail:
('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm')){noformat}

Or going through the logs:

{noformat}> view /var/logs/cloud-init-output.log{noformat}

If you search for ubuntu-advantage you will reach a line that looks like this:

{noformat}2023-11-23 10:18:26,735 - util.py[WARNING]: Running module ubuntu_advantage (<module 'cloudinit.config.cc_ubuntu_advantage' from '/usr/lib/python3/dist-packages/cloudinit/config/cc_ubuntu_advantage.py'>) failed{noformat}

{color:#ff5630}Conclusion{color}

MAAS can deploy VMs with FIPS enabled. However, cloud-init seems to have a problem with the ubuntu_advantage key.

I have also used (maybe not exactly the same config file, but the error was the same):

- 20.04 LTS as VM OS
- enabling only ESM + Real Time
- enabling only Real Time
- enabling only FIPS
*** [2023-11-23 Thu 10:20] Javier Fuentes
:PROPERTIES:
:CommId:   344396
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-23 10:20:32
:Modified: 2023-11-27 17:24:04
:END:
****** Debugging cloud-init error

- In order to discard MAAS as potential root cause, I deployed a VM using LXD and provided the cloud-init config file directly. The error occurs in that case.
- I try to provide some commands in the cloud-init config file to debug errors. Unfortunately, cloud-init always runs =ubuntu_advantage= before than =runcmd=.
- Compatibility table:

| *Config file* | *OS* | *cloud-init* | *status* |
|---------------+------+--------------+----------|
|{noformat}#cloud-config
ubuntu_advantage:
  token: <Ubuntu PRO token>
  enable:
    - esm-infra
    - fips-updates{noformat}|Ubuntu 18.04.6 LTS|23.1.2-0ubuntu0~18.04.1|('ubuntu-advantage', RuntimeError('Failure enabling Ubuntu Advantage service(s): ',))|
| |Ubuntu 20.04.6 LTS|23.3.1-0ubuntu1~20.04.1|('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm-infra'))|
| |Ubuntu 20.04.6 LTS|23.3.3-0ubuntu0_20.04.1|('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm-infra, fips-updates'))|
| |Ubuntu 22.04.3 LTS|23.2.2-0ubuntu0_22.04.1|('ubuntu-advantage', RuntimeError('Error while enabling service(s): esm-infra, fips-updates'))|
| | |23.3.1-0ubuntu1~22.04.1|('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm-infra'))|
| | |23.1.2-0ubuntu0~22.04.1|('ubuntu-advantage', RuntimeError('Error while enabling service(s): esm-infra'))|
| | |(using repository tag)
23.3.2|('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm-infra, fips-updates'))|
| | |(using repository tag)
23.3.3|('ubuntu_advantage', RuntimeError('Error while enabling service(s): esm-infra, fips-updates'))|
| | |(daily built)
23.3.daily-202311220503-ce48aadd~ubuntu22.04.1|status: done
(main branch also works)|



After some digging, I found that the issue was already reported, fixed, and merged into main ([[https://github.com/canonical/cloud-init/issues/4491|smart-link][https://github.com/canonical/cloud-init/issues/4491]]).

main [[https://github.com/canonical/cloud-init/blob/main/cloudinit/config/cc_ubuntu_advantage.py#L300][fixed] -> [https://github.com/canonical/cloud-init/blob/main/cloudinit/config/cc_ubuntu_advantage.py#L300]]
23.1.x [[https://github.com/canonical/cloud-init/blob/23.1.x/cloudinit/config/cc_ubuntu_advantage.py#L301][not fixed] -> [https://github.com/canonical/cloud-init/blob/23.1.x/cloudinit/config/cc_ubuntu_advantage.py#L301]]
23.2.x [[https://github.com/canonical/cloud-init/blob/23.2.x/cloudinit/config/cc_ubuntu_advantage.py#L300][not fixed] -> [https://github.com/canonical/cloud-init/blob/23.2.x/cloudinit/config/cc_ubuntu_advantage.py#L300]]
23.3.x [[https://github.com/canonical/cloud-init/blob/23.3.x/cloudinit/config/cc_ubuntu_advantage.py#L300][not fixed] -> [https://github.com/canonical/cloud-init/blob/23.3.x/cloudinit/config/cc_ubuntu_advantage.py#L300]]


I could verify that the error is gone using the Daily PPA and installing locally the main branch of the cloud-init GitHub repository.

I contacted the cloud-init team through their [[https://kiwiirc.com/nextclient/irc.libera.chat/cloud-init][IRC channel]] and asked what release is expected to include the bug fix:

#+BEGIN_QUOTE
  *blackboxsw Chat Smith*
  javier-fs: to answer the question you posed Friday, that fix will for Ubuntu Pro fips enablement will be in 23.4 which will be cut and released to Ubuntu Nobel this week, the plan is then to SRU that back to Focal, Jammy, Lunar and Mantic after we cut the release this week. We are only holding the release 23.4 to wrap up reviews on pull requests tagged "23.4"

  [https://github.com/canonical/cloud-init/pulls?q=is%3Apr+is%3Aopen+label%3A23.4|https://github.com/canonical/cloud-init/pulls?q=is%3Apr+is%3Aopen+label%3A23.4|smart-link]
  Noble rather than Nobel
#+END_QUOTE
*** [2023-11-23 Thu 10:36] Javier Fuentes
:PROPERTIES:
:CommId:   344404
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-23 10:36:39
:Modified: 2023-11-27 16:00:02
:END:
*Final conclusion*

I cannot access to 23.4 release branch, however, I found the diffs between 23.3.1 and 23.4 via this [[https://launchpad.net/ubuntu/+source/cloud-init/+changelog][link]]. Diffs can be found here:

[[http://launchpadlibrarian.net/697251612/cloud-init_23.3.1-0ubuntu2_23.4~3g0cb0b80f-0ubuntu1.diff.gz][http://launchpadlibrarian.net/697251612/cloud-init_23.3.1-0ubuntu2_23.4~3g0cb0b80f-0ubuntu1.diff.gz]]

Based on the diffs, 23.4 version will include the bug fix, and MAAS will be able to deploy VMs with FIPS enabled using the =ubuntu_advantages= key in cloud-init. Previous version, can still enable FIPS or any other Ubuntu Pro service running commands through the =runcmd= key in the cloud-init yaml config file.


Originally, 23.4 release was estimated to happen on November 13th  ([[https://discourse.ubuntu.com/t/2023-cloud-init-release-schedule/32244][ref]]), but it was postpone to November 20th ([[https://lists.launchpad.net/cloud-init/msg00461.html][ref]]).
*** [2023-11-27 Mon 10:36] Javier Fuentes
:PROPERTIES:
:CommId:   346377
:TYPE:     ejira-comment
:Author:   Javier Fuentes
:Created:  2023-11-27 10:36:24
:Modified: 2023-11-27 16:30:48
:END:
*NOTES*

- If cloud-init raised an error, should not the deployment failed or at least raised a warning?
* DONE [#C] Fonts are not being resolved at built time with Vite
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2413
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Nick De Villiers
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-11-20 14:06:50
:Modified: 2023-11-21 10:06:11
:END:
** Description
When running =vite build= in Site Manager CI, the paths to the local Ubuntu fonts are not being resolved, with the following error:

{noformat} /assets/fonts/f1ea362b-Ubuntu%5Bwdth,wght%5D-latin-v0.896a.woff2 referenced in /run/build/checkout/frontend/src/styles/App.scss didn't resolve at build time, it will remain unchanged to be resolved at runtime{noformat}

This is reproducible locally as well, by running =yarn build=.

What this means is that even though the build is succeeding, if a user runs Site Manager in air-gapped mode, they will not be able to fetch the Ubuntu web fonts, and thus the fonts in the UI will fall back onto system fonts.
** Comments
*** [2023-11-20 Mon 14:15] Peter Makowski
:PROPERTIES:
:CommId:   341951
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-11-20 14:15:47
:END:
More on how vite assets are handled

- [[https://vitejs.dev/guide/assets.html|smart-link][https://vitejs.dev/guide/assets.html]]
- [[https://vitejs.dev/config/shared-options.html#assetsinclude|smart-link][https://vitejs.dev/config/shared-options.html#assetsinclude]]
* TODO [#C] Consistent handling of side panels and their routing
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2411
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-11-20 09:36:14
:Modified: 2023-11-22 15:53:35
:END:
** Description
as an example the users add/edit forms have a route saying /users/edit , this route should open the table and the site panel and we should make this pattern consistent for all site panels.
** Comments
* TODO [#C] All collapsible forms should be in a side panel [needs info]
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2410
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-11-20 08:53:15
:Modified: 2023-11-23 08:49:34
:END:
** Description
With the new application layout we moved most forms to side panels. Some however are still part of a page or forward to a new page. We should move all remaining forms to side panels.
** Comments
*** [2023-11-20 Mon 09:07] Peter Makowski
:PROPERTIES:
:CommId:   341695
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-11-20 09:07:55
:END:
Before we proceed with individual forms we need to investigate whether the current way of triggering side panels is still fit for purpose considering the number of forms that we’ll have.
* TODO [#C] Make sure opened context menu scrolls together with the page
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2407
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Thorsten Merten
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-11-20 08:51:24
:Modified: 2023-11-22 15:42:10
:END:
** Description
If you open a context menu the opened menu should also scroll and not stay in the same absolute position.
** Comments
*** [2023-11-22 Wed 13:11] Peter Makowski
:PROPERTIES:
:CommId:   343761
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-11-22 13:11:45
:END:
[[https://github.com/canonical/react-components/pull/1000|smart-link][https://github.com/canonical/react-components/pull/1000]]
* TODO [#C] Make settings content max width consistent
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2403
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-11-20 08:48:31
:Modified: 2023-11-23 12:47:24
:END:
** Description
Unify the layout in the settings:

- always the same max-width
- buttons for saving always in the same place
- see below -uniform structuring of the content (in the sense that, for example, the same sequence of headings, description texts and input fields is always used, etc.).-
- [[https://zpl.io/MdMYywJ|smart-link][~accountid:63b3c5e878aabbefa9d429f0] prepared visual guidelines for this [https://zpl.io/MdMYywJ]]
** Comments
*** [2023-11-20 Mon 09:19] Thorsten Merten
:PROPERTIES:
:CommId:   341713
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-11-20 09:19:03
:END:
[~accountid:63b3c5e878aabbefa9d429f0] Do you know if we have some guidance on this somewhere or can you provide some?
*** [2023-11-20 Mon 09:32] Maximilian Blazek
:PROPERTIES:
:CommId:   341723
:TYPE:     ejira-comment
:Author:   Maximilian Blazek
:Created:  2023-11-20 09:32:35
:END:
afaik there is no guidance, I’ll write something up today
*** [2023-11-20 Mon 17:37] Maximilian Blazek
:PROPERTIES:
:CommId:   342150
:TYPE:     ejira-comment
:Author:   Maximilian Blazek
:Created:  2023-11-20 17:37:16
:END:
Settings consistency screens: [[https://zpl.io/MdMYywJ|smart-link][https://zpl.io/MdMYywJ]]

TLDR is: everything that has a table is full width, everything else is half width. + some smaller adjustments.

As for the spacing I know spacing in Vanilla is a little tricky sometimes, so treat the spacing indicators I have put as a rough guidance rather than absolute values. I have also put a spacing indicator under one of the H5s. I think in the settings we need to modify the H5s spacing a little bit: ATM it is too much as a subheading in settings imo. If you look for example at the current "General" settings page the checkbox is as far away from its own heading as it is to the next one, which doesnt seem right.
* TODO [#C] Site Manager Rock and Charm
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2402
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-11-16 11:10:55
:Modified: 2023-11-27 12:34:52
:END:
** Description
- */Please provide a concise description of the problem statement:/*

Deployment of MAAS Site Manager is currently done via a snap and manual instructions for setting up the database and load balancing.

- */Please provide an outline of the proposed solution and example use-case:/*

We want to charm MAAS Site Manager to be able to

- easily scale out horizontally
- be able to relate site manager to MAAS (which will also be charmed but as a machine charm)
- run it on K8S as a (chiseled) rock

Also see [[https://docs.google.com/document/d/1o9rW8TBstX0s8qLeqs23GAi2m6OQRX4KXw3CfA7sSSA/edit][Rocks @ Canonical]] and the [[https://docs.google.com/document/d/1bh7wClORf9UqAalMogqsQLxxGXgzZH1MRhvUXJ_ujEY/edit][ROCK specification]].

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

Admin/Operator

- */What are the functional requirements and acceptance criteria of the requested solution?/*

This needs to be rock solid

- */What other considerations need to be factored in (eg security, compliance, stability)/*

The aspect of securely onboarding MAAS to Site Manager should be handled using charm relations.

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

-

- */How critical is this idea to the success of the product?/*

Mark suggested this idea to use our own methods of deployment.
** Comments
* DONE [#C] Create Canonical guidelines for REST API
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2392
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Jacopo Rota
:Assignee: Jacopo Rota
:Issuetype: Task
:Created:  2023-11-15 12:28:24
:Modified: 2023-11-15 12:29:26
:END:
** Description
MAAS needs a new set of REST API.
Since Canonical does not have guidelines at an organization level regarding REST API, this is the opportunity to propose and create one.
The goal of this task is to craft a set of guidelines such as

azure - [[https://github.com/microsoft/api-guidelines/blob/vNext/azure/Guidelines.md][https://github.com/microsoft/api-guidelines/blob/vNext/azure/Guidelines.md]]

google - [[https://cloud.google.com/apis/design|smart-link][https://cloud.google.com/apis/design]]

IBM - [[https://cloud.ibm.com/docs/api-handbook?topic=api-handbook-intro|smart-link][https://cloud.ibm.com/docs/api-handbook?topic=api-handbook-intro]]

A preliminary work to compare the competitors guidelines can be found here [[https://docs.google.com/document/d/1GxJJg7zAIaQ1Mk2GWM1dXZ_NqyCw3Ra9SI6BzqfGijc/edit|smart-link][https://docs.google.com/document/d/1GxJJg7zAIaQ1Mk2GWM1dXZ_NqyCw3Ra9SI6BzqfGijc/edit]]
** Comments
* TODO [#C] Meter background color hover effect bug
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2387
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee:
:Issuetype: Task
:Created:  2023-11-09 13:30:42
:Modified: 2023-11-09 13:31:53
:END:
** Description
Barely noticable, but on hover of the meter component its background color changes.
** Comments
* DONE [#C] View changer box shadow bug
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2386
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Maximilian Blazek
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-11-09 13:24:12
:Modified: 2023-11-10 12:02:43
:END:
** Description
When decreasing the screen size the wrapper of the view changer does not hug the buttons anymore so the box shadow is in the wrong place.
** Comments
* TODO [#C] Quick info box hover is dropped
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2385
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee:
:Issuetype: Task
:Created:  2023-11-09 13:19:16
:Modified: 2023-11-09 13:23:19
:END:
** Description
When you hover a marker and then go to the quick info box the hover effect is lost and the quick info box is closed. What should happen is that the hover effect (marker color change and size increase + quick info box shown) should remain.
** Comments
* TODO [#C] Mobile menu does not close on link click
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2384
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-11-09 08:19:08
:Modified: 2023-11-23 12:46:36
:END:
** Description
** Comments
* TODO [#C] maas.io maintenance
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2383
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Epic
:Created:  2023-11-09 06:15:54
:Modified: 2023-11-09 06:16:15
:END:
** Description
** Comments
* TODO [#C] MAAS's tracking of personal data should be opt-in/opt-out
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2382
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee: Maximilian Blazek
:Issuetype: Story
:Created:  2023-11-08 14:48:55
:Modified: 2023-11-09 07:36:27
:END:
** Description
Currently MAAS starts it’s tracking and calling home as soon as you install it. Although you can turn off tracking, we do not explicitly ask for the user’s consent.

However, we should do this.

TODO:

We need the UX journey for this, e.g. when to show this and should we do opt-in vs. opt-out?
** Comments
* TODO [#C] Fix meter key/label positioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2381
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-11-08 13:10:40
:Modified: 2023-11-08 13:13:31
:END:
** Description
[[https://github.com/canonical/maas-ui/pull/5206#issuecomment-1801861211|smart-link][https://github.com/canonical/maas-ui/pull/5206#issuecomment-1801861211]]

There’s some places in MAAS UI (particularly where meters are used) where the spacing of labels and keys on smaller screens is too little. See the link above for an example on the LXD host screen
** Comments
* TODO [#B] Add Application Layout component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2377
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-31 15:24:12
:Modified: 2023-10-31 15:26:45
:END:
** Description
We’ll need to look into reuse of the application layout structure across maas-ui and maas-site-manager that will enable sharing such patterns as described in this issue.
** Comments
* TODO [#C] Add playwright Navigation component tests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2375
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-31 12:57:21
:Modified: 2023-11-06 13:49:11
:END:
** Description
** Comments
* TODO [#C] Install MAAS Discourse theme from github
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2374
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-31 09:15:38
:Modified: 2023-11-09 06:16:15
:END:
** Description
[[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2373|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2373]]



It doesn’t seem currently possible to install themes from git due to 500 error. This is likely related to issues with uploading assets onto discourse and will need to be investigated.



Relevant issue: [[https://github.com/canonical/discourse-k8s-operator/issues/135|smart-link][https://github.com/canonical/discourse-k8s-operator/issues/135]]


{noformat}https://discourse.maas.io/admin/themes/import

Request Method:

POST

Status Code:

500 Internal Server Error{noformat}

!Google Chrome screenshot 001053@2x-20231031-091530.png|width=1026,height=613!
** Comments
* TODO [#C] Make MAAS UI More Consistent (UI  Only Part)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2370
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 13:43:58
:Modified: 2023-11-28 14:09:07
:END:
** Description
- */Please provide a concise description of the problem statement:/*

In MAAS UI there are some small inconsistencies, bugs and the like that alone don't have a big impact, but combined, if fixed, could make MAAS UI look and feel much more pleasent and professional.

- */Please provide an outline of the proposed solution and example use-case:/*

Following is a list of such nuisances with proposed solutions:

- Settings content max width is inconsistent
    - Unify the layout in the settings: always the same max-width, buttons for saving always in the same place, uniform structuring of the content (in the sense that, for example, the same sequence of headings, description texts and input fields is always used, etc.).
- Layout of MAASs main pages is often slightly off
    - Some of the main pages ( those accessible via the side navigation) often contain similar elements such as headings, buttons, search bars, tabs, tables, etc., but arranged in a slightly different way. We should find out where these different approaches actually make sense and where they are simply an historical development and then align them where it actually makes sense to make MAAS's pages more consistent.
- In the side navigation the element of the current page is not cursor-pointer
    - The navigation item of the current page should still be cursor-pointer since it can be used to go to the root page of that section. (eg you go to machine details, you can go back to machines list by clicking on “Machines)
- The line for the tab element is at the top
    - In MAAS the line for the tab element is at the top. It should be at the bottom instead, in line with the official Vanilla component.
- An opened context menu stays in the same (absolut) position when scrolling
    - If you open a context menu the opened menu should also scroll and not stay in the same absolute position.
- If the user is an admin in MAAS they are forwarded to network discovery when clicking on the logo
    - All users should be forwarded to the machines list if they click on the MAAS logo, as that is the main page of MAAS.
- The URL of network discovery is “dashboard”
    - The URL of network discovery should be “network-discovery” or similar instead.
- Forms which are not yet in a side panel
    - With the new application layout we moved /most/ forms to side panels. Some however are still part of a page or forward to a new page. We should move all remaining forms to side panels.



*Preliminary estimations:*


The following tries to estimate the UI effort for the tasks with and without the UX part.

- Does not need UX input → 4 weeks total
    - 0.5 weeks: Settings content max width is inconsistent
    - 1 weeks: Layout of MAASs main pages is often slightly off
    - 0.5 weeks:
        - In the side navigation the element of the current page is not cursor-pointer
        - The line for the tab element is at the top
    - 1 weeks: An opened context menu stays in the same (absolut) position when scrolling
    - 0.5 weeks:
        - If the user is an admin in MAAS they are forwarded to network discovery when clicking on the logo
        - The URL of network discovery is “dashboard”
    - 0.5 weeks: Subnet page reload behaviour
- Much can be done without UX input but maybe not all → 3 weeks total
    - 3 weeks: Forms which are not yet in a side panel
** Comments
* TODO [#C] Beta API: new, performant operator APIs for querying machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2369
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 09:50:38
:Modified: 2023-10-27 09:54:53
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - In the last pulse we created [[https://docs.google.com/document/d/1ie1DM2GXQWSZIpYOb_PnP3IiqdsH2zmpGkjlJZ7ac8Y/edit][MA161]] describing how we can clean up our (external) API,  make it more REST conform and especially speed it up, as we already did with our websocket API
    - In the long term this tasks should also help to re-use more code in the external and the websocket API. The common ground for this seems to be our SQL Alchemy efforts
- */Please provide an outline of the proposed solution and example use-case:/*
    - Some of our users run quick, periodic polls on the MAAS API. There is two problems with this:
        - As the current API fetches pretty much all the information about machines, it slows down responses (and in some cases even MAAS) down significantly
        - Our users are not interested in some of the data so it should be much better for them to be able to ask for the data they really need specifically (e.g. using multiple small and fast REST API calls instead of one big and slow call and having to throw some of the data away)
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - Integration/ops/admins
- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - See stories above and spec (to be) linked above
- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - This API needs to be as secure as the previous one and should allow for the same or similar authentication
    - We need to make clear that the API may change and is in a beta state
- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - TODO: This was a particular ask from NVIDIA in one of our calls as one of their users have a bad experience (in terms of speed and data transformation) using the API
- */How critical is this idea to the success of the product?/*
    - Improving the API speed is very important for the product as quick API calls can not only slow MAAS down significantly it can also create such a high load that MAAS cannot process other tasks correctly or even fails.
** Comments
* TODO [#C] Update DPU support to include Bluefield 3 (Spike and Spec)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2368
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:18:07
:Modified: 2023-11-24 15:17:27
:END:
** Description
Support in MAAS for Smart NICs
** Comments
* TODO [#C] Charmed MAAS Deployment
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2367
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:17:53
:Modified: 2023-11-14 12:54:31
:END:
** Description
Summary : Charmed MAAS Deployment. We want to be able to deploy MAAS on the infra nodes using charms. It would be good for the multinode installation process to be fully owned by the MAAS team.

The scope of this item includes design and implementation of the MAAS charm.

Note: sunbeam solution for charmed openstack deployment contains a solution for bootstrapping a few bare metal machines for juju to use. This could be a great starting point for charmed MAAS.

For 24.04:

- Spike of charmed MAAS to figure out the general principles and design (this estimate)
- Time reservation for first implementation, scope to be determined after the spike.
** Comments
* TODO [#C] Migration from dhcpd-server to Kea
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2366
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:17:41
:Modified: 2023-10-27 08:30:40
:END:
** Description
Dhcpd support is being dropped from Ubuntu in the future, and we will need to switch over to the replacement which is Kea.

Notes from refinement session

Work items:

1. [Rough sizing: XL] Add modeling of “reserved” IPs, that remain sticky to a MAC (UI + backend)
2. [Rough sizing: S] Add Kea package to MAAS & make it use the database
3. [Rough sizing: S] Find or make Python3 kea client library
4. [Rough sizing: S] Make MAAS aware of lease changes in Kea (subscribe or poll, we don’t know yet how)
5. [Rough sizing: M] Implement DHCP relay agent on the rack side and
6. [Rough sizing: S] Update system tests to make them Kea-compatible (remove dependencies on dhcpd)
7. [Rough sizing: L]  Update service configurations to start appropriate daemons/agents in rack, region, region+rack configurations and test that. Expose new DHCP configuration options to the users giving them a choice to use their own DHCP relays. Update service health indicators.
8. [Rough sizing: S] Update HA docs & configuration & tests.
9. [Rough sizing: M] Test upgrades from non-Kea to Kea-enabled versions of MAAS, considering different starting MAAS versions and DHCP configurations.
10. [Rough sizing: S] Make sure commissioning uses either reserved IPs if configured, or releases the lease after completion.
11. Add option to configure dhcp lease time in MAAS: start with global setting. For the future, consider option to change commissioning lease time or lease time per subnet or per pool.
12. to be defined further: giving operators the ability to set DHCP options. Likely a future item, needs additional UX research.



Assumptions:

1. The work will start on a feature branch, which will get merged only upon completion. That means - we need to reserve time to sync between branches.
2. Kea will store configuration in the database. It will help us with HA scenario. It may require additional upgrade migration effort and DB tuning.



When we know we’re done:

1. MAAS no longer depends on dhcpd-server package
2. There’s an automated migration in place, and for things that can’t be migrated (e.g. DHCP snippets) there’s appropriate documentation explaining the changes



Resources:

1. [[https://kea.readthedocs.io/en/kea-2.2.0/arm/admin.html|smart-link][https://kea.readthedocs.io/en/kea-2.2.0/arm/admin.html]]  - describes how Kea supports migrations
2. [[https://docs.google.com/document/d/1qV-L0i8DDLjKSrclbgSWXM8h2gvjMvvJR7Gj8PMjwsQ/edit|smart-link][https://docs.google.com/document/d/1qV-L0i8DDLjKSrclbgSWXM8h2gvjMvvJR7Gj8PMjwsQ/edit]]
** Comments
* TODO [#C] FIPS compliant Ubuntu on deployed machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2365
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:17:29
:Modified: 2023-10-27 09:13:17
:END:
** Description
Work items:

1. Test deploying FIPS-enabled machines with MAAS. Relatively straightforward, similar to how RT-kernel is deployed: via a cloud-init snippet that provides Ubuntu Pro credentials and [[https://ubuntu.com/security/certifications/docs/fips-enablement][enables FIPS]].

Questions:

- Is “pro enable realtime-kernel” and “pro enable fips” mutually exclusive?

Estimations:

- Test + Doc: 2 SP
** Comments
* TODO [#C] O11y: Integrator Charm implementation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2364
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:17:16
:Modified: 2023-10-27 08:33:38
:END:
** Description
Following on from our work on O11y with the COS team in 23.10, implement the O11y integrator charm specified in [[https://docs.google.com/document/d/1kHk7CxdXJHCB3Dqf8pu017Q6txmDbGcMMHUS5YMrCoU/edit|smart-link][https://docs.google.com/document/d/1kHk7CxdXJHCB3Dqf8pu017Q6txmDbGcMMHUS5YMrCoU/edit]]

Work will consist of:

- new repo, cloning from the charm bootstrap project, with its own CI/CD
- creating a basic charm, that imports a library and implements very simple hooks to handle config and establish a relation - we expect it to be tens of lines of code, not much larger
- publishing to a charm store together with required documentation
- user-facing documentation to mention the integrator charm
- We assume this will be a machine charm, to be confirmed with the O11y team (Simon) if that will work.
** Comments
* TODO [#C] O11y: Additional metrics [requested by NVIDIA]
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2363
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Automation for Jira
:Assignee: Eline Maaike de Weerd
:Issuetype: Epic
:Created:  2023-10-27 08:17:02
:Modified: 2023-11-23 14:47:40
:END:
** Description
- */Please provide a concise description of the problem statement:/*

NVIDIA operate large MAAS clusters. Based on their practices, they would like to see MAAS expose o11y metrics they know from other systems:

- Service availability wrt the API
    - Is the API reachable, is the service running the API up?
- Deployment time
- Image download time
- Error rate
    - When we throw an error intentionally (e.g. by patching some exception up in the tree)
    - Web server not responding (e.g. timeouts, cpu/mem problems) → check if we can place hooks in nginx or whatever is running django
- API performance
    - response time of API calls
    - ??

- */Please provide an outline of the proposed solution and example use-case:/*

Add new metrics and documentation [[https://maas.io/docs/metrics-reference][https://maas.io/docs/metrics-reference]]

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

MAAS administrator

- */What are the functional requirements and acceptance criteria of the requested solution?/*

Func. req.: requested metrics are implemented and exposed by MAAS

Acceptance criteria: the new metrics respond in expected ways to the conditions under which MAAS operates

- */What other considerations need to be factored in (eg security, compliance, stability)/*

Collection of the new metrics should not degrade MAAS system performance

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

n/a

- */How critical is this idea to the success of the product?/*

Moderately at present. Its criticality will increase with the rate of adoption of MAAS by customers used to large scale operations.
** Comments
*** [2023-11-16 Thu 08:48] Thorsten Merten
:PROPERTIES:
:CommId:   340025
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-11-16 08:48:55
:END:
My recommendation: Write a lean spec/table containing

- what we can do for the current API
- what we can do for the MAAS 4 API

Review this with Nvidia folks.
*** [2023-11-22 Wed 09:48] Jacopo Rota
:PROPERTIES:
:CommId:   343551
:TYPE:     ejira-comment
:Author:   Jacopo Rota
:Created:  2023-11-22 09:48:28
:END:
Regarding the point =Is the API reachable, is the service running the API up?= I think we have to add a =/status= endpoint that returns all the internal services statuses. Some frameworks provide this functionality (that can be extended) out of the box (for example [[https://quarkus.io/guides/smallrye-health|smart-link][https://quarkus.io/guides/smallrye-health]] ). We need to check if FastAPI provides such feature or if we have to implement it - should not be that hard anyways.

Regarding the error rate I think it depends. We can for sure keep track of http calls that failed. But for the internals calls (for example the failed RPC calls that are not triggered by the user) are they really useful for the end user? I’d rather rely on the =/status= endpoint to check if the internal services of maas are properly working, not at the failed RPC calls that should be transparent to the user.

Then for the =response time of API calls= we should already have the metrics in place
*** [2023-11-23 Thu 08:12] Eline Maaike de Weerd
:PROPERTIES:
:CommId:   344287
:TYPE:     ejira-comment
:Author:   Eline Maaike de Weerd
:Created:  2023-11-23 08:12:06
:END:
From what I have gathered:

- Service availability wrt the API
    - Current API: nothing is in place to implement this
    - Future API: as Jacopo outlines below, it should be fairly easy to implement (add status endpoints)
- Deployment time
    - Current API: tricky- would need to calculate and store the timestamp somewhere: in the database?
    - Future API: should be fairly straightforward to add
- Image download time
    - Current API: this is affected by the image storage redesign, and the extent to which it is affected is not yet known (still in progress). Hence can’t say at this point what we can add
    - Future API: I expect this will not be too hard to add, but can give a better estimate when the image storage redesign work is completed
- Error rate
    - Current API: we can probably add keeping track of failed http calls
    - Future API: as for current API, can keep track of failed calls
    - Other errors/internal calls, I agree with Jacopo that this would probably not be useful for the user
- API performance
    - Already available in the current metrics (referred to as ‘latency’)
* TODO [#C] ReBAC authorisation model for MAAS (spec)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2362
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:16:26
:Modified: 2023-10-27 09:47:22
:END:
** Description
- */Please provide a concise description of the problem statement:/*

MAAS is currently supporting RBAC for authorisation, which presents several limitations. LXD, Jaas the contract server and the IAM platform are all moving to a ReBAC system based on Auth0 OpenFGA

- */Please provide an outline of the proposed solution and example use-case:/*

[[https://docs.google.com/presentation/d/1oVsBWWVwlyae82ctNBGoXO-PEPS5fgE88wS0rslJ9-Q/edit?usp=sharing|smart-link][https://docs.google.com/presentation/d/1oVsBWWVwlyae82ctNBGoXO-PEPS5fgE88wS0rslJ9-Q/edit?usp=sharing]]  → permission management presentation.

[[https://www.figma.com/proto/JLQXKieOXHMGvUkpaMSI11/Permission-management-UI?type=design&node-id=309-45462&t=RCT2aw5QlvwDB2sr-0&scaling=min-zoom&page-id=259%3A7205&starting-point-node-id=309%3A45462|smart-link][https://www.figma.com/proto/JLQXKieOXHMGvUkpaMSI11/Permission-management-UI?type=design&node-id=309-45462&t=RCT2aw5QlvwDB2sr-0&scaling=min-zoom&page-id=259%3A7205&starting-point-node-id=309%3A45462]]  → link to the common UI/UX we would like to use across Canonical products (currently being implemented for Jaas, LXD and the IAM platform)

[[https://docs.google.com/document/d/1_isbVngqXzNOFOPgnnBwqvognT2q1H_qoVwE1x4ttEY/edit?usp=sharing|smart-link][https://docs.google.com/document/d/1_isbVngqXzNOFOPgnnBwqvognT2q1H_qoVwE1x4ttEY/edit?usp=sharing]]  → example document to discuss juju permission model evolution

Updated LXD spec: [[https://docs.google.com/document/d/1KNd2TXiTuYfrFcq_LeqHMouu7reVOz5PMCJWZ9h77VA/edit|smart-link][https://docs.google.com/document/d/1KNd2TXiTuYfrFcq_LeqHMouu7reVOz5PMCJWZ9h77VA/edit]]

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

Administrators in larger companies or larger deployments who would like to implement fine grained authorisation on large scale deployments

- */What are the functional requirements and acceptance criteria of the requested solution?/*

OpenFGA backend implemented

Permission management UI implemented

- */What other considerations need to be factored in (eg security, compliance, stability)/*

Security - fine grained authorisation enable the implementation of the zero trust security model, where operators can get access only to the resources they need

Compliance - the current RBAC system is not designed to solve for access governance requirements that large organisations have for their critical system

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*



- */How critical is this idea to the success of the product?/*

This is important to improve MAAS security/compliance and to align the UX to the one of other Canonical products
** Comments
* TODO [#C] Enable SRIOV and Embedded Switch Mode Support during provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2361
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:16:11
:Modified: 2023-10-27 08:32:11
:END:
** Description
For SR-IOV Support, MAAS should:

- During commissioning - detect the capability (virtual functions).
- Allow to search & filter for machines with this capability
- During provisioning - give the option to enable SR-IOV (i.e. inject a couple of lines into cloud-init: virtual-function-count:4, delay-virtual-functions-rebind: true, following netplan-enforced rules)

For Embedded Switch Mode Support (NVIDIA Connect-X), MAAS should:

- During commissioning - detect the capability (ideally, using LXD library).
- Allow to search & filter for machines with this capability
- During provisioning - give the option to enable Embedded Switch Mode (cloud-init: embedded-switch-mode: switchdev, delay-virtual-functions-rebind: true)
** Comments
* TODO [#C] MAAS Site Manager: User management with IdM + SSO (spec)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2360
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:15:56
:Modified: 2023-10-27 08:31:45
:END:
** Description
*Attention: Make sure to think this through together with ReBAC and the ReBAC issue for MAAS proper*

In the following IdM is used as IdM + SSO.

- */Please provide a concise description of the problem statement:/*

MAAS Site Manager and MAAS are currently using their own user management. Site Manager has a local user model that distinguishes between Admin and User and so does MAAS.

Although MAAS is able to integrate with Candit and RBAC, Canonical is coming up with ReBAC which is based on

If both MAAS and Site Manager switch to the same solution the following scenarios are enabled

- Site Manager and MAAS can register with the same Identity Provider and thus have a seamless login experience
- Site Manager could be an Identity provider for MAAS so that Site Manager users can log in some/all MAAS installations
- Permissions for users on particular MAAS installations can centrally be managed in Site Manager (e.g. users vs. admins + everything we are not doing with RBAC).

- */Please provide an outline of the proposed solution and example use-case:/*

A user logs in to Site Manager, sees that some machines are in broken state in a MAAS installation and wants to inspect those in detail. The user clicks on the link to MAAS and does not need to re-authenticate as the external IdM (or Site Manager as the IdM) is taking care of authenticating the user to MAAS.

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

All users of Site Manager benefit from this solution. Administrators would use the functionality and setup the roles and users would benefit from the experience.

- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - MAAS and MAAS Site Manager need to use the same technology for authentication and access management (see[[https://warthogs.atlassian.net/browse/PF-4171|smart-link][https://warthogs.atlassian.net/browse/PF-4171]] for more resources and details for MAAS)
    - An external IdM (such as Auth0, Microsoft, or  Octa) can be used in both MAAS Site Manager and MAAS
    - [optional/stretch] MAAS Site Manager should be able to instruct MAAS to connect to a particular IdM
    - [optional/stretch] MAAS Site Manager should be able to represent an IdM for the MAAS installations connected to it
- */What other considerations need to be factored in (eg security, compliance, stability)/*

Most details are described in [[https://warthogs.atlassian.net/browse/PF-4171|smart-link][https://warthogs.atlassian.net/browse/PF-4171]] already. We should check how other

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

N/A

- */How critical is this idea to the success of the product?/*

Site manager would not integrate well, if at all with MAAS if it does not provide a seamless login and access management experience. Thus this is super important for both products to be perceived together well by users.
** Comments
* TODO [#C] MAAS Security Roadmap (Specification)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2359
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:15:37
:Modified: 2023-10-27 08:31:11
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - MAAS currently has several construction sites to make image handling and booting more secure, e.g.
        - secure boot
        - full disk encryption
        - FIPS
        - UEFI/HTTPs image downloads
        - Secure communication between MAAS components (e.g. MTLS)
        - ReBAC (switch to OpenFGA, enable external IDPs)
        - brainstorm about the threats that might enable hijacking MAAS in general
            - config files
            - firewalling
            - DNS spoofing
            - tool injection
            - SBOM
            - Logging audit trail / logging with security in mind
            - …
    - The idea of this item is to create a specification/roadmap to gather these issues and find a particular order to tackle them
- */Please provide an outline of the proposed solution and example use-case:/*
    - MAAS stakeholders (e.g. customers, product management, …) want to know how we want to make MAAS secure in the long run. This document should describe the way and raise awareness/brainstorm other attack scenarios.
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - First MAAS stakeholders, later MAAS devs

- */How critical is this idea to the success of the product?/*
    - Critical if customers need to do security audits
** Comments
* TODO [#C] Temporal Workflows: deployment, power checks, DNS config
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2358
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:15:23
:Modified: 2023-10-27 08:30:54
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - We embedded temporal in MAAS during the last cycle, now we want to translate the most important communication between rackd and regiond into workflows, especially
        - deployment
        - power checks and power cycling
        - configuring DNS



- */Please provide an outline of the proposed solution and example use-case:/*
    - Take the RPC calls, make them workflows



- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - RPC communication can be deleted, the entire communication is based on temporal and possible calls to the HTTP API (which should be created using SQLAlchemy already)



- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - As for every temporal workflow secrets need to be passed around in a secure way



- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - This is a refactoring item



- */How critical is this idea to the success of the product?/*
    - Without fully embracing temporal and removing legacy RPC calls, the MAAS source code will be a mess. We have to finish what we started.
** Comments
* TODO [#C] Temporal Workflows: DHCP config (depends on Kea migration)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2357
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:15:11
:Modified: 2023-10-27 08:30:17
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - After (or while) we migrate from DHCPd to KEA we also need to migrate the necessary regiond and rackd communication to become a temporal workflow



- */Please provide an outline of the proposed solution and example use-case:/*
    - Take the RPC calls, make them workflows, make sure to remove all RPC calls related to the old DHCPd implementation



- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - RPC communication can be deleted, the entire communication is based on temporal and possible calls to the HTTP API (which should be created using SQLAlchemy already)
    - KEA integration works



- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - As for every temporal workflow secrets need to be passed around in a secure way



- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - This is a refactoring item



- */How critical is this idea to the success of the product?/*
    - Without fully embracing temporal and removing legacy RPC calls, the MAAS source code will be a mess. We have to finish what we started.
** Comments
* TODO [#C] Temporal Workflows: inventorise remaining rack/region RPC to remove them next cycle
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2356
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:14:53
:Modified: 2023-10-27 08:29:01
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - After Temporal workflows for the most important rackd/regiond activities have been created, we need to check which other RPC calls are still left and remove those. Examples for these are small RPC calls that could be transferred to HTTP calls to our new API (those should be implemented using FastAPI/SQLAlchemy) or minor workflows that we could not convert yet.



- */Please provide an outline of the proposed solution and example use-case:/*
    - Take the RPC calls, make them workflows or API calls



- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - RPC communication can be deleted, the entire communication is based on temporal and calls to the HTTP API (which should be created using SQLAlchemy already)



- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - As for every temporal workflow and HTTP call secrets need to be passed around in a secure way



- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - This is a refactoring item



- */How critical is this idea to the success of the product?/*
    - Without fully embracing temporal and removing legacy RPC calls, the MAAS source code will be a mess. We have to finish what we started.
** Comments
* TODO [#C] Site Manager: image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2355
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:14:39
:Modified: 2023-10-27 08:28:41
:END:
** Description
- */Please provide a concise description of the problem statement:/*
    - In the last cycle we created two specs:
        - [[https://docs.google.com/document/d/1lZaHeTMoRglN2sP3XjGxYu-zU9r0aku8oTI5lL2arpg/edit][MA141: MAAS Site Manager: Image provisioning in the UI]]
        - [[https://docs.google.com/document/d/1lhv2UgRYkhPTjaMWptIMX9aarTeIhoJrQAtyLTb6Q0s/edit][MA137: MAAS Site Manager: Image repository]]
    - We want to implement those in this cycle



- */Please provide an outline of the proposed solution and example use-case:/*
    - See specs



- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - See specs



- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - See specs



- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - See specs



- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - N/A



- */How critical is this idea to the success of the product?/*
    - This is the first real value creating feature of Site Manager besides showing Sites in a list and on a map. It is our first take to convince people to use Site Manager.
** Comments
* TODO [#C] Site Manager: database migrations and release readiness
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2354
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:14:22
:Modified: 2023-10-27 08:28:23
:END:
** Description
- */Please provide a concise description of the problem statement:/*

We are close to finish a preview version of MAAS Site Manager. All we need to release is create the MAAS Site Manager Connector and finish implementing the UX and design QA suggestions.

However, we still need to update documentation so that others can deploy MAAS Site Manager and add database migrations to the product so people can also install the next version and or point releases.

- */Please provide an outline of the proposed solution and example use-case:/*
    - Create docs how to install MAAS Site Manager for production
    - Possibly update docs for dev setups
    - Create docs how to install MAAS Site Manager Connector
    - Update the instructions in the UI to reflect the latest development in the Connector (e.g. update to JWT tokens instead of UUID tokens)
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - All of them
- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - MAAS Site Manager is connected to MAAS and this can be done by our colleagues and friendly customers using a production setup (i.e. HA, Load balancing, proper SSL termination)
- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - See above
- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - N/A
- */How critical is this idea to the success of the product?/*
    - Without this nobody will be able to run Site Manager
** Comments
* TODO [#C] Reusable UI components for Site Manager and MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2353
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:14:06
:Modified: 2023-10-27 08:28:10
:END:
** Description
- */Please provide a concise description of the problem statement:/*

As we are now maintaining two projects (MAAS and MAAS Site Manager), we already identified the first UI components that are on the one hand still MAAS specific and on the other hand re-usable between MAAS and MAAS Site Manager.

In addition we think that some components we develop for MAAS are good candidates to be promoted to Vanilla.

We need a place to store all these components, mark them in case they are ready for promotion to Vanilla so we can work towards this and also document how to use them.

- */Please provide an outline of the proposed solution and example use-case:/*

We spiked a repository with a [[https://storybook.js.org/tutorials/intro-to-storybook/react/en/get-started/][storybook]] already. Now we need to start transitioning components and improve this solution and the docs around it.

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

Frontend devs

- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - Make it easy for devs to do updates of components in the repo and seeing the impact of these updates in MAAS and MAAS Site Manager (pretty much in the same way as if they were developing with local components)
    - Have storybook configured in a way that devs understand how to use components
    - Have storybook configured in a way that it shows the API (props/events) of components and devs can play with them in an isolated way
    - Make sure that examples for every component exist so that we get rendering tests for free
- */What other considerations need to be factored in (eg security, compliance, stability)/*

N/A

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

N/A

- */How critical is this idea to the success of the product?/*

This helps maintaining the UI for both products.
** Comments
* TODO [#C] Pre-HAP: dynamic grouping of machines based on their specs for outlier identification (spec)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2352
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:13:47
:Modified: 2023-11-14 12:54:56
:END:
** Description
- */Please provide a concise description of the problem statement:/*

(see also [[https://warthogs.atlassian.net/browse/FEPF-129|smart-link][https://warthogs.atlassian.net/browse/FEPF-129]] )

As part of any deployment using bare-metal such as for OpenStack or Kubernetes on bare-metal, Canonical usually runs the HAP (hardware automation package) process. This essentially requires the engineer deploying the solution to validate that the server and network configuration matches the design which has been agreed between Canonical and the customer. The idea of the Pre-HAP tasks is to utilize MAAS for theses tasks.

This particular issue is about grouping machines based on their specs (e.g. RAM/CPU count/GPU/DPU/…) so that field engineers can easily find outliers.

- */Please provide an outline of the proposed solution and example use-case:/*
    - This is TPD by the spec. This could e.g. be achieved by sorting/filtering in MAAS, outputting to a CSV file or any other format that field can use to find outliers in an automatic or manual way.
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - Field
- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - It should not define MAAS and no special screens should be created in MAAS for this functionality, it should more be an addon to MAAS that field can use to achieve their goals
- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - TBD
- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - N/A
- */How critical is this idea to the success of the product?/*
    - Existing solutions are being deprecated and thus this is critical to check bare metal
** Comments
* TODO [#C] Pre-HAP: MTU testing and validation (spike + spec)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2351
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:13:30
:Modified: 2023-11-14 12:55:13
:END:
** Description
- */Please provide a concise description of the problem statement:/*

(see also [[https://warthogs.atlassian.net/browse/FEPF-129|smart-link][https://warthogs.atlassian.net/browse/FEPF-129]] )

As part of any deployment using bare-metal such as for OpenStack or Kubernetes on bare-metal, Canonical usually runs the HAP (hardware automation package) process. This essentially requires the engineer deploying the solution to validate that the server and network configuration matches the design which has been agreed between Canonical and the customer. The idea of the Pre-HAP tasks is to utilize MAAS for theses tasks.

This particular issue is about testing the MTU on the wiring.

- */Please provide an outline of the proposed solution and example use-case:/*
    - This is TPD by the spec.
- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - Field
- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - It should not define MAAS and no special screens should be created in MAAS for this functionality, it should more be an addon to MAAS that field can use to achieve their goals
- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - TBD
- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - N/A
- */How critical is this idea to the success of the product?/*
    - Existing solutions are being deprecated and thus this is critical to check bare metal
** Comments
* TODO [#C] Site Manager: Deployment documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2350
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:13:16
:Modified: 2023-10-27 08:27:04
:END:
** Description
- */Please provide a concise description of the problem statement:/*

Users will want to setup MAAS Site Manager in production mode, i.e.

- HA (Load Balancer & > 1 backend)
    - Possibly point to different instances for ingestion and user facing backend/URIs
- SSL/TLS termination
    - Certificate
    - Make sure connector respects certificate and displays fingerprint



- */Please provide an outline of the proposed solution and example use-case:/*
    - See [[https://warthogs.atlassian.net/browse/PF-4456|smart-link][https://warthogs.atlassian.net/browse/PF-4456]]



- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*
    - Field and customers setting up Site Manager



- */What are the functional requirements and acceptance criteria of the requested solution?/*
    - Someone not from the MAAS team should be able to do it



- */What other considerations need to be factored in (eg security, compliance, stability)/*
    - N/A



- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*
    - N/A



- */How critical is this idea to the success of the product?/*
    - Needed to install/set up the product
** Comments
* TODO [#C] Community Engagement
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2349
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:13:06
:Modified: 2023-10-27 10:10:33
:END:
** Description
See [[https://docs.google.com/document/d/1UeI__XK-UvnRNzwUjSSgQSW9XzN7hnV1Q-7fekHVllw/edit#bookmark=kix.8kv8sc1ue8aj][MAAS - documentation content objectives]] (2023-10-26) for the scope of 24.04.
** Comments
* TODO [#C] Temporal Workflows: operator documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2348
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Automation for Jira
:Assignee:
:Issuetype: Epic
:Created:  2023-10-27 08:11:20
:Modified: 2023-10-27 08:26:11
:END:
** Description
- */Please provide a concise description of the problem statement:/*

In the last cycle we embedded temporal in MAAS. This cycle we will implement way more mission critical workflows to temporal.

Although our intend is that temporal should be pretty transparent to MAAS users and admins we need to add documentation on how to operate (set up and run) temporal in MAAS.

In addition we will need more detailed internal documentation (public or internal for our field colleagues) how to troubleshoot temporal, restart workflows etc.

- */Please provide an outline of the proposed solution and example use-case:/*

TODO

- */Who is the user of this idea (or is experiencing this problem)? Developer? Administrator?/*

MAAS operators and field

- */What are the functional requirements and acceptance criteria of the requested solution?/*

TODO

- */What other considerations need to be factored in (eg security, compliance, stability)/*

N/A

- */Please provide links to the salesforce opportunities, LP bugs or other references to help demonstrate the impact of this issue/*

N/A

- */How critical is this idea to the success of the product?/*

When we distribute MAAS with temporal included this needs to be documented, otherwise we will have a lot of requests from users.
** Comments
* TODO [#C] Marker click persist size increase
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2344
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:40:25
:Modified: 2023-11-22 15:53:18
:END:
** Description
** Comments
* TODO [#D] Map min zoom
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2342
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:38:57
:Modified: 2023-11-22 15:53:12
:END:
** Description
** Comments
* DONE [#A] Warning for sites that cannot be shown on the map (no coordinates)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2341
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-10-25 07:38:28
:Modified: 2023-10-30 10:40:12
:END:
** Description
** Comments
*** [2023-10-25 Wed 08:06] Peter Makowski
:PROPERTIES:
:CommId:   330678
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-25 08:06:56
:END:
[~accountid:633d97f7140ba0bf651dee6a] I think we might’ve missed this?

[~accountid:70121:01ef6e96-df1a-4807-b371-05fe067d0f61] [~accountid:712020:d243d261-496e-4ab8-bbd8-a41f94bfab6f] we might need to add an ability to filter sites by coordinates so that we can retrieve those which coordinates are null.

Alternatively we could use the coordinates endpoint provided it returns all sites including those which coordinates are null?
* TODO [#C] Quick info box hover state
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2336
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:33:20
:Modified: 2023-10-25 14:17:05
:END:
** Description
** Comments
* TODO [#C] Upper half quick info box
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2335
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-10-25 07:32:03
:Modified: 2023-11-21 14:59:10
:END:
** Description
** Comments
*** [2023-11-21 Tue 14:59] Jones Ogolo
:PROPERTIES:
:CommId:   342706
:TYPE:     ejira-comment
:Author:   Jones Ogolo
:Created:  2023-11-21 14:59:06
:END:
MP: [[https://code.launchpad.net/~jonesogolo/maas-site-manager/+git/maas-site-manager/+merge/455982|smart-link][https://code.launchpad.net/~jonesogolo/maas-site-manager/+git/maas-site-manager/+merge/455982]]
* TODO [#D] Quick info box position
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2333
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-10-25 07:31:02
:Modified: 2023-11-02 11:03:03
:END:
** Description
** Comments
* TODO [#C] Button transparent
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2330
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-10-25 07:29:20
:Modified: 2023-11-20 08:28:02
:END:
** Description
** Comments
*** [2023-11-20 Mon 08:28] Jones Ogolo
:PROPERTIES:
:CommId:   341669
:TYPE:     ejira-comment
:Author:   Jones Ogolo
:Created:  2023-11-20 08:28:02
:END:
MP: [[https://code.launchpad.net/~jonesogolo/maas-site-manager/+git/maas-site-manager/+merge/454798][https://code.launchpad.net/~jonesogolo/maas-site-manager/+git/maas-site-manager/+merge/454798]]
* TODO [#C] Title outline
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2329
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:27:59
:Modified: 2023-10-25 07:27:59
:END:
** Description
** Comments
* TODO [#D] Map position/zoom is not remembered
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2327
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:26:42
:Modified: 2023-10-25 07:26:42
:END:
** Description
** Comments
* TODO [#C] Default view bounding box
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2326
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:25:38
:Modified: 2023-10-25 07:25:38
:END:
** Description
** Comments
* TODO [#E] Tooltip
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2325
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-25 07:24:26
:Modified: 2023-10-25 07:24:27
:END:
** Description
** Comments
* TODO [#C] MAAS Site Manager UI QA
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2322
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Epic
:Created:  2023-10-25 07:19:56
:Modified: 2023-11-09 13:30:42
:END:
** Description
** Comments
* TODO [#C] Display vector tiles
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2321
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-10-24 14:42:41
:Modified: 2023-11-22 15:52:32
:END:
** Description
** Comments
* DONE [#C] Investigate current systemtests failures
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2317
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-10-24 07:44:38
:Modified: 2023-11-20 16:42:38
:END:
** Description
System tests  have been failing for about 3 weeks already. What’s wrong?
** Comments
*** [2023-10-24 Tue 09:27] Bjorn Tillenius
:PROPERTIES:
:CommId:   330103
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-24 09:27:28
:END:
On labmaas I tried to manually commission, deploy, enter/exit rescue mode and finally release the machines that tend to fail in tests: arm64, natasha, opelt, stunky, ppc64el

No problems there.
*** [2023-10-25 Wed 12:08] Bjorn Tillenius
:PROPERTIES:
:CommId:   330793
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-25 12:08:14
:END:
I’ve set up systemtests locally and tried running them against a physical host of mine. I’ve ran them twice. Once it failed entering  rescue mode, and the other time it succeeded.

I’m going to try having it create a vm as well, to see if i can replicate the errors related to “vm1”.
*** [2023-10-25 Wed 15:17] Bjorn Tillenius
:PROPERTIES:
:CommId:   330916
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-25 15:17:56
:END:
I looked at the logs for run #2005, which showed failures for natasha and vm1. It looks like we have a problem when downloading tftp files now and then. The logs show what natasha is spending around 20 minutes retrying the download of lpxelinux.0. After around 20 minutes it does succeed, and start deploying the machine, but the test times out before the deploy is finished.

For VMs, it seems like the problem is more severe, since they don’t seem to retry the download on failures.
*** [2023-10-25 Wed 15:27] Bjorn Tillenius
:PROPERTIES:
:CommId:   330929
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-25 15:27:48
:END:
Looking further in the logs, I can see the request to lpxelinux.0, and they all have this after them:

  tftp.session: [debug] Final ACK received, transfer successful

Both the successful ones, and the failures.
*** [2023-10-26 Thu 13:03] Bjorn Tillenius
:PROPERTIES:
:CommId:   331698
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-26 13:03:15
:END:
It turned out that the VM we got for the BF-3 DPU got assigned IP 10.245.136.20, which is the same IP that systemtests uses. I’ve change the BF-3 VM to  10.245.136.30 and have started a new test run:

[[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1553/][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1553/]]

I’ve also added the maas-system-maas IP to the [[https://docs.google.com/document/d/1f3uEUaLs0Dn6FeT5-mK_Muo-iLvT6VtuW-hnc7kLd8M/edit#heading=h.waxgqgsr897f|smart-link][https://docs.google.com/document/d/1f3uEUaLs0Dn6FeT5-mK_Muo-iLvT6VtuW-hnc7kLd8M/edit#heading=h.waxgqgsr897f]]  doc, since that’s the most complete IP registry we have
*** [2023-10-26 Thu 13:27] Bjorn Tillenius
:PROPERTIES:
:CommId:   331712
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-26 13:27:27
:END:
I also reserved the IPs in labmaas.

I find it odd, though, that the subnet page is missing a lot of IPs that actually are in use on the network: [[http://10.245.136.7:5240/MAAS/r/subnet/2][http://10.245.136.7:5240/MAAS/r/subnet/2]]

They do show up as network discoveries here: [[http://10.245.136.7:5240/MAAS/r/dashboard][http://10.245.136.7:5240/MAAS/r/dashboard]]
*** [2023-10-26 Thu 15:18] Bjorn Tillenius
:PROPERTIES:
:CommId:   331805
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-26 15:18:43
:Modified: 2023-10-26 15:23:52
:END:
The snap test finallly passed: [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1553/][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1553/]]

The deb test failed due to a package issue: [[http://maas-integration-ci.internal:8080/job/maas-system-tests/2012/][http://maas-integration-ci.internal:8080/job/maas-system-tests/2012/]]

=chrony : Conflicts: time-daemon=

We’ve seen that before, but I can’t remember what the exact problem was. Will look into this tomorrow.

Last time it was around the time when systemd got new packages published. And that seems to be the situation now as well. New systemd packages were published to jammy-updates 20 hours ago: [[https://launchpad.net/ubuntu/+source/systemd/249.11-0ubuntu3.11|smart-link][https://launchpad.net/ubuntu/+source/systemd/249.11-0ubuntu3.11]]
*** [2023-10-27 Fri 06:52] Bjorn Tillenius
:PROPERTIES:
:CommId:   332092
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-27 06:52:24
:END:
The time-daemon issue seems to have resolved itself.

A new error popped up, though: Unexpected machine status: opelt didn't become Deployed

[[http://maas-integration-ci.internal:8080//job/maas-system-tests-snap/1555/consoleFull#-8772751298d199e30-38ff-4c27-814d-546d734f6f5c][http://maas-integration-ci.internal:8080//job/maas-system-tests-snap/1555/consoleFull#-8772751298d199e30-38ff-4c27-814d-546d734f6f5c]]
*** [2023-10-27 Fri 13:31] Bjorn Tillenius
:PROPERTIES:
:CommId:   332649
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-27 13:31:48
:END:
I’m currently investigating a new error:

natasha transitions to Ready when deploying: natasha machine goes to Ready

[[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1556/][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1556/]]

From the logs, at 08:43:16, you can see that the status gets updated to DEPLOYING, but then, also at 08:43:16 it gets set back to READY. There’s a ‘ROLLBACK TO SAVEPOINT "s140340727260736_x221"; args=None' message that looks suspicious, but I haven’t looked into it yet. Need to investigate in what cases the machine can go from DEPLOYING to READY, without updating the event log.
*** [2023-10-27 Fri 14:13] Bjorn Tillenius
:PROPERTIES:
:CommId:   332717
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-27 14:13:40
:END:
Looking further at the logs, looking at the UPDATE statements. There’s a INSERT with status=DEPLOYING, previous_status=ALLOCATED. After that, there is an INSERT statement with status=READY, previous_status=COMMISSIONING.
*** [2023-10-31 Tue 08:13] Bjorn Tillenius
:PROPERTIES:
:CommId:   333524
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-31 08:13:12
:END:
We had some green runs, but now we’re back to red runs again. I’ve identified the following failures so far:

- [[https://bugs.launchpad.net/maas/+bug/2041854][+Region didn’t restart for Vault migration+]]
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests/2021][http://maas-integration-ci.internal:8080/job/maas-system-tests/2021]]
- Natasha IPMI error
    - Natasha’s BMC was unvailable. I’ve power cycled it using the PDUs and it seems to be working again.
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1558][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1558]]
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1559][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1559]]
- Couldn’t connect to MAAS - pebble bug?
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1557][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1557]]
- Natasha transitions to ready when deploying
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1556/][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1556/]]
    - See previous comments
- Opelt didn’t get deployed
    - [[http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1555][http://maas-integration-ci.internal:8080/job/maas-system-tests-snap/1555]]
*** [2023-10-31 Tue 08:25] Bjorn Tillenius
:PROPERTIES:
:CommId:   333530
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-31 08:25:34
:END:
I’ve created an MP to bump the timeout during the vault migration: [[https://code.launchpad.net/~bjornt/maas/+git/maas/+merge/454850|smart-link][https://code.launchpad.net/~bjornt/maas/+git/maas/+merge/454850]]

It should hopefully be enough to get systemtests passing. Although we should probably put in a check to make sure that MAAS has properly started before doing the migration.
*** [2023-10-31 Tue 10:28] Bjorn Tillenius
:PROPERTIES:
:CommId:   333583
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-31 10:28:06
:END:
Natasha’s BMC is acting up again. Now it reports that the username is invalid, and a power cycle doesn’t seem to fix it. Will try to deploy the machine in labmaas and see if I can poke around in the BMC from the host. If not,  I’ll file an RT.
*** [2023-10-31 Tue 15:27] Bjorn Tillenius
:PROPERTIES:
:CommId:   333697
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-31 15:27:28
:END:
I filed an RT to investigate what’s wrong with natasha. RT #160623.

I also disabled natasha in systemtests.

But now it seems like master is broken, at least for snaps:

Oct 31 15:16:09 maas-system-maas maas-agent[10460]: 3:16PM ERR error looking up MAAS power CLI executable error="exec: cevethqwhqipucufgsveybdrtrkwrejm"maas.powercevethqwhqipucufgsveybdrtrkwrejm": executable file not found in $PATH" ActivityID=5 ActivityType=power Attempt=2 Namespace=default RunID=4fd7c193-6f9d-4315-bb11-f995b7bdb081 TaskQueue=vlan-2 WorkerID=g766ke:10460:vlan-2 WorkflowID=power:power_cycle:cahs3r:451969.700570853 WorkflowType=power_cycle

I’ve notified ~maas-temporal about the problem.
*** [2023-11-01 Wed 15:16] Bjorn Tillenius
:PROPERTIES:
:CommId:   334192
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-01 15:16:50
:END:
I got a successful run with 3.4/edge, and I saw that Jack got a succesful run with 3.3/stable. So the infrastructure seems to be in a better situation now.

Tests against latest/edge still fail, though, but that’s due to bugs in MAAS. Power control is currently broken, since it was re-implemented as a temporal workflow.

I’ve landed a patch to allow maas-power to accept multi-choice options, like workaround-flags for IPMI. Anton is working to make the agent pass the right parameters to maas-power.

[[https://bugs.launchpad.net/maas/+bug/2042429|smart-link][https://bugs.launchpad.net/maas/+bug/2042429]]
*** [2023-11-02 Thu 12:19] Bjorn Tillenius
:PROPERTIES:
:CommId:   334737
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-02 12:19:45
:END:
After the fixes to the power workflow, we had one systemtests run pass, and one fail. the one failed, was the VM going from RELEASING to DEPLOYING. We had similar cases where machines would go from DEPLOYING to READY.

I filed a bug and proposed an MP to fix it: [[https://bugs.launchpad.net/maas/+bug/2042540|smart-link][https://bugs.launchpad.net/maas/+bug/2042540]]
*** [2023-11-13 Mon 09:05] Bjorn Tillenius
:PROPERTIES:
:CommId:   338314
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-13 09:05:49
:Modified: 2023-11-13 13:33:16
:END:
All the test runs now fail existing rescue mode. I can reproduce this locally.

The first commit with this failure is b3dae13ec

There’s one passing run for commit c95585200, but that’s for 3.4.

All other test runs failed with other failures, before reaching the exit rescue mode test.
*** [2023-11-13 Mon 16:16] Bjorn Tillenius
:PROPERTIES:
:CommId:   338614
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-13 16:16:41
:END:
i installed MAAS 3.4 and observed how things worked there. The logic there is that the status is set to EXITING_RESCUE_MODE, the machine power cycled, and then update_power_state is called, which updates the status to DEPLOYED. After that, the machine boots up and when grub requests its config, the status of the machine is DEPLOYED already.

I haven’t been able to debug how this work in latest master yet. The UI got broken by commit  900e0f12fa125079457599e393a33d5bb1b7d30e. Using the API also doesn’t work: [[https://bugs.launchpad.net/maas/+bug/2043397|smart-link][https://bugs.launchpad.net/maas/+bug/2043397]]



The UI has been fixed, so a new snap should be available soon. I’m not sure whether the API breakage is a new bug, or whether it was like that for a while already.
*** [2023-11-14 Tue 08:40] Bjorn Tillenius
:PROPERTIES:
:CommId:   338820
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-14 08:40:00
:END:
Had a meet with Anton about this issue this morning. We concluded that the problem is that the logic to transition to the right status is in Node.update_power_state(), which doesn’t seem to be called for some reason. This most likely cause other issues as well, like releasing a machine takes a very long time.

Ideally we would rewrite this logic using workflows. But it’s not trivial, since currently it’s not possible to use the database from within workflows/activities.

Anton is going to look at the power workflow to ensure that update_power_state gets called, and I’m going to take a quick look at how we can use the database from within workflows/activities.
*** [2023-11-14 Tue 16:11] Bjorn Tillenius
:PROPERTIES:
:CommId:   339034
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-14 16:11:18
:END:
I created a branch for the spike to allow db access in temporal activities:

  [[https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/temporal-sqlalchemy-spike|smart-link][https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/temporal-sqlalchemy-spike]]

Currently I have registered a worker that is running in a separate process that handles all the region-wide workflows.

The next step is to hook sqlalchemy into it, and try to create an activity that modifies the db.
*** [2023-11-20 Mon 11:00] Bjorn Tillenius
:PROPERTIES:
:CommId:   341790
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-20 11:00:15
:END:
We still have a couple of errors occurring in systemtests

There are at least two different errors.

One is that the ppc64 machine fails to exit rescue mode. The log shows that the machine exits rescue mode, but after that systemtests can’t connect to the machine via ssh, since the machine doesn’t have an IP.

However, I watched a run of systemtests while this was happening, and I could see that the ppc64 machine first went to and “Failed to enter rescue mode” status (at this point, the IP seemed to disappear), and then a second, or so, later, it went to a DEPLOYED status, still missing the IP.

The other issue is that vm1 fails to either deploy, or to redeploy. I haven’t debugged that issue much yet. One odd thing I noticed, though, is that before the vm is being rebooted into the local system, the hardware-sync script is being run. This causes the machine to go to DEPLOYED before the reboot happens, since hardware-sync requests the metadata.
*** [2023-11-20 Mon 16:42] Bjorn Tillenius
:PROPERTIES:
:CommId:   342116
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-11-20 16:42:38
:END:
I didn’t pin-point the rescue mode failure, but I did spot an issue that might be causing a problem: [[https://code.launchpad.net/~bjornt/maas/+git/maas/+merge/455901|smart-link][https://code.launchpad.net/~bjornt/maas/+git/maas/+merge/455901]]
* TODO [#C] Replace processingComplete with actionStatus
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2312
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-10-23 10:25:04
:Modified: 2023-10-23 10:25:04
:END:
** Description
[[https://github.com/canonical/maas-ui/pull/4436/files#diff-a1ffb6cc018548decaa9501b7129b0d15318027085554b8d24e79a2b59d5ddeeR111|smart-link][https://github.com/canonical/maas-ui/pull/4436/files#diff-a1ffb6cc018548decaa9501b7129b0d15318027085554b8d24e79a2b59d5ddeeR111]]

[[https://github.com/canonical/app-tribe/issues/1289|smart-link][https://github.com/canonical/app-tribe/issues/1289]]
** Comments
* TODO [#C] As a MAAS user, I want to be able to inspect failed release scripts for the machine
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2307
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-10-18 21:45:43
:Modified: 2023-10-18 21:45:43
:END:
** Description
** Comments
* TODO [#C] As a MAAS developer, I want release scripts to be executed during the machine release life cycle
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2305
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-10-18 21:45:14
:Modified: 2023-10-18 21:45:14
:END:
** Description
** Comments
* TODO [#C] As a MAAS developer, I want “Erase disk” activity to be implemented as a release script
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2303
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-10-18 21:44:53
:Modified: 2023-10-18 21:44:53
:END:
** Description
** Comments
* TODO [#C] MA146 Machine release scripts
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2293
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Epic
:Created:  2023-10-18 21:42:12
:Modified: 2023-11-27 07:14:41
:END:
** Description
Provide ability to execute custom scripts during machine release life cycle.

[[https://specs.canonical.com/spec/MA146][https://specs.canonical.com/spec/MA146]]
** Comments
* DONE [#C] Run PR demos using our demos.haus server
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2280
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Nick De Villiers
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-10-17 08:01:14
:Modified: 2023-10-19 08:24:04
:END:
** Description
Having PR demos on maas-ui has made QA a lot easier, since we do not have to clone and run a branch locally to review it. We should use the demo server for this to run demos on maas-react-components.
** Comments
* TODO [#C] Investigate whether client certificates can be used to make the boot process more secure
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2277
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Spike
:Created:  2023-10-13 07:50:28
:Modified: 2023-10-13 07:50:34
:END:
** Description
** Comments
* TODO [#C] Connector - http(s) transport
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2270
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Christian Grabowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-11 13:46:15
:Modified: 2023-10-11 13:46:20
:END:
** Description
** Comments
* TODO [#C] [Dev] Update disk erase settings
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2269
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-10-11 10:29:21
:Modified: 2023-10-11 10:34:40
:END:
** Description
UX Specification: [[https://app.zeplin.io/project/651e6ff64ba65a2dba226be4/screen/651e701e4a425a2cb6917ab6|smart-link][https://app.zeplin.io/project/651e6ff64ba65a2dba226be4/screen/651e701e4a425a2cb6917ab6]]

Currently, the outcome of selecting different disk erasure options is unclear. This needs to be updated so that the result of the user’s choice is clearly communicated.
** Comments
* DONE [#C] [Dev] Add conditional reveal to maas-react-components
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2268
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-10-11 10:26:31
:Modified: 2023-10-16 08:55:59
:END:
** Description
[[https://design-system.service.gov.uk/components/radios/#:~:text=Conditionally%20revealing%20a%20related%20question|smart-link][https://design-system.service.gov.uk/components/radios/#:~:text=Conditionally%20revealing%20a%20related%20question]]

-  [[https://app.zeplin.io/project/651e6ff64ba65a2dba226be4/screen/651e701e4a425a2cb6917ab6|smart-link][https://app.zeplin.io/project/651e6ff64ba65a2dba226be4/screen/651e701e4a425a2cb6917ab6]]
** Comments
*** [2023-10-13 Fri 08:48] Peter Makowski
:PROPERTIES:
:CommId:   325456
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-13 08:48:13
:END:
Vanilla proposal: [[https://github.com/canonical/vanilla-framework/issues/4893|smart-link][https://github.com/canonical/vanilla-framework/issues/4893]]
* TODO [#C] Write spec
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2267
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-10-11 09:09:59
:Modified: 2023-10-24 07:43:24
:END:
** Description
** Comments
*** [2023-10-18 Wed 15:40] Bjorn Tillenius
:PROPERTIES:
:CommId:   327581
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-18 15:40:19
:END:
I’ve created the initial stories, as well as starting to document the boot process: [[https://docs.google.com/document/d/16mn4sX9zxI2jQOThA1937GEuLQVQy-5TtVWtmLoLB0k/edit|smart-link][https://docs.google.com/document/d/16mn4sX9zxI2jQOThA1937GEuLQVQy-5TtVWtmLoLB0k/edit]]
* TODO [#C] How can we get initramfs to download the image over https?
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2265
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Spike
:Created:  2023-10-11 08:58:48
:Modified: 2023-10-24 07:43:21
:END:
** Description
UEFI downloaded the bootloaders over https, and grub also downloaded the kernel and initramfs over https.

The next step is that initramfs needs to download the image over https. It’s no longer in the EFI environment, so it doesn’t know which certificates to trust.

How can we get initramfs to trust the certificates that MAAS uses?

- Can we somehow use the UEFI library/environment to either get the certificate to trust, or use it to download the file?
- Can we send the certificate, or a hash, via kernel parameters?
    - Keep in mind that there’s a limit on the size of the kernel parameters, and we’re already close to the limit

Given that we get this to work, how do we get cloud-init to use the same mechanism when it downloads the cloud-config-url?
** Comments
*** [2023-10-12 Thu 15:27] Bjorn Tillenius
:PROPERTIES:
:CommId:   325181
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-12 15:27:46
:END:
Spent most of the day setting things up to have a working https booting setup. I’ve made suggestions to [[https://docs.google.com/document/d/1Td6W6TOb5W5dcaffMzRut4m85rUOP_SlzQsRQxpMrrw/edit|smart-link][https://docs.google.com/document/d/1Td6W6TOb5W5dcaffMzRut4m85rUOP_SlzQsRQxpMrrw/edit]] , in order to have a setup where the bootloaders (+grub config and kernel) are downloaded over https, while the image and cloud-init still uses http. With the original setup, the deploy would fail, since the image couldn’t be downloaded.
*** [2023-10-18 Wed 15:42] Bjorn Tillenius
:PROPERTIES:
:CommId:   327584
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-18 15:42:30
:END:
I haven’t done any testing, but I’ve documented the HTTP calls we do during the boot process, and added a comment on various options we can consider: [[https://docs.google.com/document/d/16mn4sX9zxI2jQOThA1937GEuLQVQy-5TtVWtmLoLB0k/edit#heading=h.12s84cvk9u3u|smart-link][https://docs.google.com/document/d/16mn4sX9zxI2jQOThA1937GEuLQVQy-5TtVWtmLoLB0k/edit#heading=h.12s84cvk9u3u]]

We should talk to foundations to see if they have any suggestions. Whatever we do, most likely will result in a change to the initramfs scripts.
* TODO [#C] [Dev] OpenStreetMap configuration API integration
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2264
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-10-11 08:58:18
:Modified: 2023-10-11 09:03:18
:END:
** Description
** Comments
* TODO [#C] Ingestor - Heartbeat
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2258
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-10-10 15:10:53
:Modified: 2023-10-13 06:58:01
:END:
** Description
Site Manager requires a heartbeat endpoint that SMC can use to send heartbeats to,

In future, this will return information about backoffs. The initial implementation should return a simple =reponse received= status code.



Heartbeat times should be persisted to the Site Manager database to be shown in the UI as a =last seen= time for a Site.

Heartbeats should require the JWT token of a site to verify which site the information refers to. As this is an authentication layer, this should additionally return http codes for unauthorized access.
** Comments
*** [2023-10-13 Fri 06:58] Alberto Donato
:PROPERTIES:
:CommId:   325364
:TYPE:     ejira-comment
:Author:   Alberto Donato
:Created:  2023-10-13 06:58:01
:END:
Why do we need a specific endpoint for this?

 The =last_seen= attribute should be updated every time a site makes a request to site manager.

Given that sites will report periodically, an additional heartbeat shouldn’t be really needed to determine the site status.
* TODO [#C] Connector - Data
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2255
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-10-10 14:37:20
:Modified: 2023-10-10 14:57:20
:END:
** Description
Site Manager connector will need to send Data about it’s connected MAAS to Site Manager.
This data should be queried from the MAAS API and MAAS DB, before being sent as a JSON data payload to the corresponding Data endpoint of Site Manager.

This data could include, but not be limited to:

- Number of Machines
    - Available
    - Utilized
    - Broken
- Available resources
    - Cores
    - RAM
    - Disk
- URL
- Name
- Aggregated status
** Comments
* TODO [#C] Connector - Heartbeats
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2253
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-10-10 14:19:10
:Modified: 2023-10-10 14:24:03
:END:
** Description
Site Manager connector needs to periodically check in with Site Manager to tell it that the MAAS Site Manager Connector is attached to is still operational.

This heartbeat should be a JSON payload containing the time of the payload being sent. The heartbeat should be easily extendible to include other data in future.

The heartbeat will need to be sent to a corresponding API endpoint in Site Manager, and authenticated with the JWT token assigned.
** Comments
* TODO [#C] Connector - JWT Tokens
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2252
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-10-10 14:14:51
:Modified: 2023-10-10 14:14:51
:END:
** Description
To secure connections between site manager connector and Site Manager, JWT tokens will be used. This duplicates the work already done in the user facing back-end with authenticated users.

Site Manager connection will need to have a secure storage location for it’s authentication token, and should supply it in the header of any data it sends to Site Manager Connector
** Comments
* TODO [#C] Write spec for service layer
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2246
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-10-10 10:21:25
:Modified: 2023-11-28 07:16:40
:END:
** Description
** Comments
* TODO [#C] MAAS Service layer
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2245
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Epic
:Created:  2023-10-10 10:21:02
:Modified: 2023-11-28 07:16:35
:END:
** Description
** Comments
* TODO [#C] Connector - Info CLI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2244
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Task
:Created:  2023-10-09 16:42:23
:Modified: 2023-10-09 16:42:24
:END:
** Description
Site Manager Connector should have a notion of it’s connection state to Site Manager.
this should be user accessible via a CLI command:
=info=
Initially, this should display whether an enrollment request is currently open, and when it was opened.
** Comments
* TODO [#C] Make sure that successfully deployed machines are no longer selected in case of backend errors
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2240
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-10-06 12:07:26
:Modified: 2023-10-06 12:10:59
:END:
** Description
For example: If a user selects 10 machines and 4 of which have an error, make sure that we keep those 4 selected and remove the selection for the successful ones, so the user knows which ones did not work
** Comments
* TODO [#C] MAAS failed to start. Pebble hangs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2236
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Bug
:Created:  2023-10-06 06:27:36
:Modified: 2023-11-27 10:12:09
:END:
** Description
** Comments
*** [2023-11-27 Mon 10:12] Anton Troyanov
:PROPERTIES:
:CommId:   346351
:TYPE:     ejira-comment
:Author:   Anton Troyanov
:Created:  2023-11-27 10:12:09
:END:
Switched to Pebble fork from [[https://github.com/maas/pebble/tree/1.5.0-pprof|smart-link][https://github.com/maas/pebble/tree/1.5.0-pprof]]

This is a temporary solution, should allow us to collect more data [[https://git.launchpad.net/maas/commit/?id=0abeefe30e48abe9a030c9669a330629a2ebca45|smart-link][https://git.launchpad.net/maas/commit/?id=0abeefe30e48abe9a030c9669a330629a2ebca45]]
* TODO [#C] [Dev] implement bounding box filtering for GET /sites/coordinates
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2226
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Jacopo Rota
:Assignee: Jacopo Rota
:Issuetype: Task
:Created:  2023-10-03 08:11:13
:Modified: 2023-10-03 12:56:48
:END:
** Description
Implement the filtering strategy according to [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2003|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2003]]
** Comments
* DONE [#C] LP-1846457: Composing a VM with a static IP changes to Auto Assign after commissioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2221
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Stamatis Katsaounis
:Assignee: Stamatis Katsaounis
:Issuetype: Bug
:Created:  2023-10-02 10:11:30
:Modified: 2023-10-02 10:11:39
:END:
** Description
** Comments
* TODO [#C] [Dev] Integrate refresh tokens
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2213
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-28 09:55:32
:Modified: 2023-09-28 09:56:07
:END:
** Description
Implement refresh token logic following best practices: https://auth0.com/blog/refresh-tokens-what-are-they-and-when-to-use-them/
** Comments
* DONE [#C] Publish the linting rules in an npm package
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2207
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-09-28 09:06:06
:Modified: 2023-10-03 08:52:27
:END:
** Description
** Comments
* TODO [#C] [Dev] Custom Leaflet Elements
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2203
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-09-28 07:03:21
:Modified: 2023-10-24 14:42:50
:END:
** Description
*Background*

Leaflet only accepts an HTML string (innerHTML) for custom elements. Because of this, we chose to use =flushSync= to render the innerHTML that we pass to leaflet.

Using =flushSync= can cause some performance overhead, and we should use it with caution (ideally avoid).

It is a suggested way of rendering elements to string when the result is needed immediately. This is the case when passing custom elements to leaflet. You can read more on this in the documentation: [[https://react.dev/reference/react-dom/server/renderToString#removing-rendertostring-from-the-client-code|smart-link][https://react.dev/reference/react-dom/server/renderToString#removing-rendertostring-from-the-client-code]]

It was initially only used in a single other place (SiteMarker.tsx), but only called once when assigning the markerHtml which ensures it won't negatively affect performance.

SiteMarker.tsx:
=```=
=const getMarkerHtml = (appearance: MarkerApprearance): string => {=
=const div = document.createElement("div");=
=const root = createRoot(div);=

=flushSync(() => {=
=root.render(<SiteMarkerSvg appearance={appearance} />);=
=});=

=return div.innerHTML;=
=};=

=const markerHtml = {=
=base: getMarkerHtml("base"),=
=selected: getMarkerHtml("selected"),=
=} as const;=
=```=

As the need for the custom elements and their level of complexity will grow we may need investigate an alternative.

*Tasks*

- Investigate the impact of using flushSync on performance of the map
- investigate alternative implementation options for a custom leaflet element without the use of flushSync
** Comments
*** [2023-10-11 Wed 11:12] Peter Makowski
:PROPERTIES:
:CommId:   324323
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-11 11:12:06
:END:
One option would be to use React Portals. This would allow us to use regular react components (and take advantage of everything else that comes with react) for icons.
* TODO [#C] [Dev] Use Set for collections of unique ids
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2200
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-27 12:07:22
:Modified: 2023-10-23 07:27:31
:END:
** Description
*Problem*

Consider an edge case below:

*VLANs, Subnets and vlan.subnet_ids property*

Front-end fetches a VLAN soon after it’s been updated by adding a new subnet to it.
Front-end receives the VLAN with the new subnet before receiving subnet/createNotify.
As soon as we receive subnet update notification we end up with duplicate subnet ids.

which will become apparent when you follow the logic below:
[[https://github.com/canonical/maas-ui/blob/8dc9b0c6c623d1a8ec490a648a73ea2845f1154f/src/app/store/vlan/slice.ts#L174-L189][https://github.com/canonical/maas-ui/blob/8dc9b0c6c623d1a8ec490a648a73ea2845f1154f/src/app/store/vlan/slice.ts#L174-L189]]

This might cause non-obvious problems e.g. result in multiple items displayed to the user.

We could check if the item exists before pushing it to the array, but it’s not clean. It will make the code more difficult to read as it’ll result in additional if statements. It also doesn’t solve the problem in all related models that use arrays of ids.

*Solution*
Replace all Arrays with Set in all cases where it’s used to store a collection of unique IDs. This will - by design as Set doesn’t allow it - prevent potential duplicate items in the future.
Attempts to add the same id multiple times to a Set simply do not update the Set and do not throw errors which means this change should be fairly straight-forward to implement.
** Comments
*** [2023-09-27 Wed 12:09] Peter Makowski
:PROPERTIES:
:CommId:   318244
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-09-27 12:09:26
:END:
[~accountid:633d97f7140ba0bf651dee6a] [~accountid:63bbf101713349bea186c04c] [~accountid:62a75900bf7afc006f3aa340] would be good to hear your thoughts on this.
* TODO [#C] maas-release-tools: release from alternative branches
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2197
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Task
:Created:  2023-09-26 14:33:43
:Modified: 2023-09-26 14:33:43
:END:
** Description
** Comments
* DONE [#C] Release 3.4.0
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2196
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Task
:Created:  2023-09-26 14:32:51
:Modified: 2023-09-26 14:32:51
:END:
*** Description
*** Comments
* DONE [#C] Site Manager Ingestor and MAAS Connection
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2193
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Epic
:Created:  2023-09-26 12:13:28
:Modified: 2023-11-21 12:39:20
:END:
*** Description
- We removed the CLI only component from the scope (the component to retrofit existing MAAS versions)
- Instead we need to
    - Implement the connection in MAAS (either as another process or in the existing event loop)
        - Similar experience as planned for the connector CLI
        - Likely API necessary (for Juju)
        - Possibly (stretch) UI
    - Make sure the UI reflects whether MAAS is connected to a Site Manager
    - Disabling the image handling and custom images in MAAS (e.g. setting to read only mode so users can still explore the images inherited from Site Manager) for UI and CLI
    - Possibly make configurable whether we want to disable image handling in MAAS
        - at all (unlikely)
        - for everything but custom images or
        - strict and for everything
*** Comments
**** [2023-11-16 Thu 14:25] Thorsten Merten
:PROPERTIES:
:CommId:   340265
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-11-16 14:25:25
:END:
We should think about having this next to MAAS in a separate process still, so that it could monitor MAAS itself.
* TODO [#C] Enrich markers with additional info
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2189
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-09-25 12:10:58
:Modified: 2023-09-26 07:22:19
:END:
** Description
See [[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#bookmark=id.mcrtxjn96k5z][this story]].
** Comments
* TODO [#C] [Dev] Display a warning on unsaved changes
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2188
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-25 09:35:34
:Modified: 2023-10-23 07:27:31
:END:
** Description
We’ll need to investigate which interactions should be treated as “unsaved changes”.

Is active machine selection and an open machine action form an unsaved change or would it need more fields with fields that have changes to be treated as such?

One definition of “unsaved changes” could be any currently displayed form which submission updates entities on the back-end (machine action form, active machine selection).
** Comments
* TODO [#C] [Dev] Run MAAS CLI actions from E2E tests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2181
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-25 08:53:02
:Modified: 2023-10-23 07:27:31
:END:
** Description
- We have a number of setup steps in various e2e tests (e.g. creation of a new machine). They are currently done by repeating UI interactions which isn’t efficient and can lead to flaky tests.
- We should perform these tasks  using the CLI instead of the UI ((it’s how it should be done, but it’s not trivial as  requires in-depth knowledge about orchestration of GitHub actions and executing scripts with cypress and therefore would probably need to be investigated separately)
** Comments
* TODO [#C] [Dev] Capture analytics events
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2179
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-25 08:38:44
:Modified: 2023-11-22 15:51:06
:END:
*** Description
As part of this we’ll need to investigate whether the hook that exists in MAAS UI can be reused. We should raise this at one of the front-end standups.
*** Comments
* TODO [#C] [Dev] Define analytics events to collect
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2178
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-25 08:32:31
:Modified: 2023-10-06 11:50:00
:END:
*** Description
Some aspects of this task (like definition of user control) will require investigatory work and consultation with other stakeholders.
*** Comments
* TODO [#C] Enable terraform end 2 end tests of dns records
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2177
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Task
:Created:  2023-09-22 08:35:55
:Modified: 2023-09-22 08:35:56
:END:
*** Description
According to [[https://github.com/maas/maas-terraform-e2e-tests/pull/5#pullrequestreview-1639397863|smart-link][https://github.com/maas/maas-terraform-e2e-tests/pull/5#pullrequestreview-1639397863]]  , we have to enable the e2e tests of the dns records of the terraform provider when the needed utilities are implemented on python-libmaas
*** Comments
* TODO [#D] Write Documentation for Automated OS Image Testing
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2164
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters
:Issuetype: Task
:Created:  2023-09-13 14:37:42
:Modified: 2023-10-17 12:31:36
:END:
*** Description
*** Comments
* TODO [#C] [Dev] Improve e2e tests for maas.io API docs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2158
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-09-12 08:57:06
:Modified: 2023-10-23 07:30:00
:END:
*** Description
*Acceptance criteria*

- [[http://maas.io][maas.io]] e2e test suite fails if an issue such as below is detected in any section of the page



[[https://github.com/canonical/maas.io/issues/806|smart-link][https://github.com/canonical/maas.io/issues/806]]
*** Comments
**** [2023-09-12 Tue 08:57] Peter Makowski
:PROPERTIES:
:CommId:   310908
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-09-12 08:57:35
:END:
[~accountid:62a75900bf7afc006f3aa340] could you think of a simple way of detecting such issues?
* TODO [#C] Track image "staleness" on images.maas.io candidate and stable streams as a KPI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2157
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Task
:Created:  2023-09-12 08:43:26
:Modified: 2023-09-25 09:42:35
:END:
*** Description
Recently it was discovered that the candidate stream on [[http://images.maas.io][images.maas.io]] had not been updated since May (!) due to a bug in CPC pipelines. The immediate issue has been resolved, but that was several months with none of us noticing.

For both candidate and stable streams, If we capture, and plot the number of days since the latest image has been touched we expect to see a saw-tooth graph, a climbing one would be suspicious
*** Comments
* TODO [#C] MA136 - Ephemeral deployments in the UI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2146
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Epic
:Created:  2023-09-11 12:58:24
:Modified: 2023-10-06 12:07:26
:END:
*** Description
Spec link: [[https://docs.google.com/document/d/1A5LVr-Ijpv5EAP1VcJZp99pOb4r38yD9nhUyKY5vutE/edit|smart-link][https://docs.google.com/document/d/1A5LVr-Ijpv5EAP1VcJZp99pOb4r38yD9nhUyKY5vutE/edit]]

#+BEGIN_QUOTE
  MAAS UI users should have the option to choose to deploy a machine ephemerally without the need to remove disks from machines during commissioning. As well as this, existing disks can be used to preserve data on ephemeral deployments.

  Users need to know this, since if that machine is powered off, any data that is not persisted to disk will be lost (as with regular deployments), and the OS will need to be re-downloaded in order to boot into the ephemeral environment if the user reboots the machine.

  MAAS UI users need to know when machines are deployed ephemerally so that they know when they turn off a machine where the OS is deployed to RAM, there is a potential for data loss if any data on that machine hasn’t been persisted to a disk.
#+END_QUOTE


Feature requirements:

- Show an indicator on the machine list for ephemerally deployed machines
- Show an indicator in machine details for ephemerally deployed machines
- Expose an option in the deploy form to deploy machines ephemerally
- Let users know if a machine will be deployed ephemerally (condition: no disks in machine)
- Disable unsupported images in the dropdown in the deployment form
    - (if “Deploy in memory” is selected)
- Warn users when attempting to ephemerally deploy custom images
- Add column to storage list for ephemeral support
*** Comments
* TODO [#C] [Dev] Display multiple error messages for sites/tokens deletion
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2143
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-09-06 14:02:06
:Modified: 2023-09-06 14:03:23
:END:
*** Description
[[https://code.launchpad.net/~nickdv99/maas-site-manager/+git/site-manager/+merge/450562/comments/1203103|smart-link][https://code.launchpad.net/~nickdv99/maas-site-manager/+git/site-manager/+merge/450562/comments/1203103]]



For the sites and tokens delete endpoints, we iteratively call the endpoint for a single item deletion in order to handle bulk deletion. For this reason, we should display error messages from any of the failed requests.
*** Comments
* TODO [#C] [Dev] Use common absolute path import convention
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2141
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-09-05 11:16:27
:Modified: 2023-10-23 07:27:30
:END:
*** Description
*Acceptance Criteria*

- MAAS UI uses the same absolute paths import convention that’s used in MAAS Site Manager: =@/=
*** Comments
* TODO [#C] Investigate how we can remove the need for netplan to for configure networking for ephemeral deploys
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2140
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-09-04 14:34:10
:Modified: 2023-10-24 07:43:18
:END:
*** Description
We discovered that in order to configure the networking for ephemeral deployments, we currently write the netplan config directly and call netplan. Thus for deployments that don’t have netplan, like Ubuntu 16.04 and pretty much any non-Ubuntu OS, the network will not be configured, apart from having the PXE interface get an address via dhcp.

We should look into whether we can configure networking in some other way, for example using cloud-init.
*** Comments
**** [2023-09-04 Mon 14:46] Bjorn Tillenius
:PROPERTIES:
:CommId:   307135
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-04 14:46:50
:END:
I looked at this today, but so far I haven’t found any viable solution.

I’ve considered three different approaches:

  1) Having the MAAS datasource provide the network configuration.

      While this is technically possible, it most likely requires a change to cloud-init, which means that we would be blocked until the changes would be backported to Ubuntu 16.04 as well as the RPM archives, and any other non-Ubuntu cloud-init source.

  2) Providing the network configuration via kernel command line options.

      Doesn’t seem viable, since there’s a limit of how long the kernel command line parameter string can be. Using a simple config, I seem to have exceeded that limit on Ubuntu 20.04.

  3) Providing the network config in the initial cloud-config that gets sent to configure the MAAS datasource.

     I couldn’t get this to quite work, but I’ll investigate this further. I did manage to get the a =network= section written into a file in /etc/cloud.cfg.d/, but it seems that cloud-init finds the network configuration from initramfs and prefers that.

Maybe there’s a way to change that order, or disable the initramfs config entirely?

Another option would be to try to make use of cloud-init, either calling out to it, or as a library, and give the network config explicitly?
**** [2023-09-25 Mon 14:57] Bjorn Tillenius
:PROPERTIES:
:CommId:   317155
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-25 14:57:04
:END:
After the rhel machine had been deployed, I wrote a network config in /etc/cloud.cfg.d/ and run run the following:

{noformat}[cloud-user@vm1 ~]$ sudo python3
Python 3.9.10 (main, Feb  9 2022, 00:00:00)
[GCC 11.2.1 20220127 (Red Hat 11.2.1-9)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from cloudinit import stages
>>> init = stages.Init()
>>> stages.cmdline.read_initramfs_config = lambda: None
>>> init.apply_network_config(True)
finding networking config...
Processing config cmdline
 ncfg = None
Processing config initramfs
 ncfg = None
Processing config system_cfg
 ncfg = {'config': [{'id': 'enp6s0', 'mac_address': '00:16:3e:3a:4c:52', 'mtu': 1500, 'name': 'enp6s0', 'su
bnets': [{'type': 'manual'}], 'type': 'physical'}, {'bridge_interfaces': ['enp6s0'], 'id': 'br0', 'mac_addr
ess': '00:16:3e:3a:4c:52', 'mtu': 1500, 'name': 'br0', 'params': {'bridge_fd': 15, 'bridge_stp': 0}, 'subne
ts': [{'type': 'dhcp4'}], 'type': 'bridge'}, {'id': 'eth0', 'mac_address': '00:16:3e:30:87:ac', 'mtu': 1500
, 'name': 'eth0', 'subnets': [{'address': '10.5.32.27/20', 'dns_nameservers': ['10.5.32.99', '10.5.32.1'],
'dns_search': ['maas'], 'gateway': '10.5.32.1', 'type': 'static'}], 'type': 'physical'}, {'address': ['10.5
.32.99', '10.5.32.1'], 'search': ['maas'], 'type': 'nameserver'}], 'version': 1}
True                           {noformat}

I also added some debug prints to see what was going on. Now it found the correct config, but it didn’t actually configure the networking.
**** [2023-09-26 Tue 08:40] Bjorn Tillenius
:PROPERTIES:
:CommId:   317508
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-26 08:40:07
:END:
I’ve tried some variants of the python code below, and I get to the point where files are correctly written to /etc/sysconfig/network-scripts. But I can’t get it to reconfigure the networking. For example, this is the network configuration I’m working with:

{noformat}network:
  config:
  - id: enp6s0
    mac_address: 00:16:3e:3a:4c:52
    mtu: 1500
    name: enp6s0
    subnets:
    - type: manual
    type: physical
  - bridge_interfaces:
    - enp6s0
    id: br0
    mac_address: 00:16:3e:3a:4c:52
    mtu: 1500
    name: br0
    params:
      bridge_fd: 15
      bridge_stp: 0
    subnets:
    - type: dhcp4
    type: bridge
  - id: eth0
    mac_address: 00:16:3e:30:87:ac
    mtu: 1500
    name: eth0
    subnets:
    - address: 10.5.32.33/20
      dns_nameservers:
      - 10.5.32.99
      - 10.5.32.1
      dns_search: &id001
      - maas
      gateway: 10.5.32.1
      type: static
    type: physical
  - address:
    - 10.5.32.99
    - 10.5.32.1
    search: *id001
    type: nameserver
  version: 1
{noformat}

But it seems that at the point I’m executing the Python code, NetworkManager has already claimed enp6s0 and configured it to use dhcp.

If I manually call =systemctl restart network=, a =br0= interface gets created, but it’s down, with no IP. the IP is still assigned to =enp6s0=
**** [2023-09-26 Tue 10:40] Bjorn Tillenius
:PROPERTIES:
:CommId:   317629
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-26 10:40:19
:END:
I did manage to get it work, but it required a change in cloud-init. I modified cloud-init not to read the initramfs network config, as well as returning the network config in the cloud-config that maas serves.

So we know that we can get it to work if we fix cloud-init, but it would be good if we could find a solution that didn’t require fixing cloud-init.
**** [2023-09-26 Tue 19:30] Chad Smith
:PROPERTIES:
:CommId:   317957
:TYPE:     ejira-comment
:Author:   Chad Smith
:Created:  2023-09-26 19:30:15
:END:
Created [[https://warthogs.atlassian.net/browse/SC-1640|smart-link][https://warthogs.atlassian.net/browse/SC-1640]] for cloud-init features related to this need per our discussion today. Thanks for setting this up!
**** [2023-09-27 Wed 15:41] Bjorn Tillenius
:PROPERTIES:
:CommId:   318536
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-27 15:41:15
:END:
I did some testing the proposed solution of making MAAS a local data source. It worked well for the ephemeral deployments, where we boot over the network and initramfs brings up the initial networking.

However, when we deploy to disk, the deployed system still has the maas datasource configured. In the case where the system boots from disk, initramfs doesn’t bring up the networking, which means that cloud-init will try to get the metadata before network is actually up.

I added a comment in the [[https://warthogs.atlassian.net/browse/SC-1640|smart-link][https://warthogs.atlassian.net/browse/SC-1640]] spec.

I’m trying now with a different approach, to add a global option to control which network sources to consider: [[https://paste.ubuntu.com/p/HSG9MYDG2n/|smart-link][https://paste.ubuntu.com/p/HSG9MYDG2n/]]
**** [2023-10-03 Tue 08:33] Bjorn Tillenius
:PROPERTIES:
:CommId:   320721
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-03 08:33:00
:END:
I got a diff to try: [[https://dpaste.com/C7LLZ9G4J|smart-link][https://dpaste.com/C7LLZ9G4J]]
**** [2023-10-03 Tue 13:21] Bjorn Tillenius
:PROPERTIES:
:CommId:   320912
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-03 13:21:12
:END:
I tested the proposed diff with rhel9, using a slightly modified diff, since the cloud-init version there is older:  [[https://dpaste.com/DQMD5GPPH|smart-link][https://dpaste.com/DQMD5GPPH]]

This is the network configuration that I tested with: [[https://paste.ubuntu.com/p/66jvjyxv7M/|smart-link][https://paste.ubuntu.com/p/66jvjyxv7M/]]

The bridges get created, and the br2 and =enp6s0= interfaces get configured properly. The =br0= bridge gets created, and gets an IP, but it’s marked as down. At the same time, the =enp5s0= interface still has an IP (the same as =br0= in this case).

[[https://paste.ubuntu.com/p/fkjkPDNd8G/|smart-link][https://paste.ubuntu.com/p/fkjkPDNd8G/]]

Deployment of rhel9 to disk works without any problems.
**** [2023-10-17 Tue 19:30] Brett Holman
:PROPERTIES:
:CommId:   326881
:TYPE:     ejira-comment
:Author:   Brett Holman
:Created:  2023-10-17 19:30:17
:END:
[[https://github.com/canonical/cloud-init/pull/4520|smart-link][~accountid:616d3f3b892c420072dbea8e] Circling back to this now, see the PR against upstream cloud-init [https://github.com/canonical/cloud-init/pull/4520]]
* TODO [#C] [Dev] Create groups of e2e tests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2136
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-30 10:56:29
:Modified: 2023-11-22 15:51:04
:END:
*** Description
Acceptance criteria

- We have at least 2 groups of e2e tests that can be run individually at different point in the continuous integration pipeline

This can be done by grouping them by their importance (e.g. only running a11y tests for dark mode after merge to speed up merge proposal process).
*** Comments
* TODO [#C] As a MAAS user I want to deploy a custom, non-Ubuntu, tarball image to RAM
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2129
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Story
:Created:  2023-08-29 09:18:37
:Modified: 2023-08-29 09:18:43
:END:
*** Description
*** Comments
* DONE [#C] [Dev] Fix tag selector input attributes
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2126
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-08-25 08:21:11
:Modified: 2023-09-19 14:45:35
:END:
*** Description
*Acceptance criteria*

All warnings related to missing id or name for tag selector inputs are fixed

----

Example of an error thrown when running jest tests:

{noformat}Warning: Formik called `handleBlur`, but you forgot to pass an `id` or `name` attribute to your input:
          <input class="p-form-validation_/input tag-selector/_input" type="text" aria-describedby="" aria-invalid="false" aria-haspopup="listbox" aria-label="Search existing or add new tags" placeholder="" value="">
          Formik cannot determine which value to update. For more info see https://formik.org/docs/api/formik#handleblur-e-any--void{noformat}
*** Comments
* TODO [#C] [Dev] Power actions dropdown
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2125
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-08-24 14:07:50
:Modified: 2023-10-16 14:24:14
:END:
*** Description
*Acceptance Criteria*

-  “Power cycle” is renamed “Power”
- all power-related options  (including check power) are displayed in the power dropdown across all pages that use the action bar



----

*Background information*
Looks like the final wireframes don't have the little dropdown which is inconsistent with the design.
[[https://app.zeplin.io/project/63ca81b58cdf10309393a6cb/screen/63cebd4dea1c8010bb021d8d|smart-link][https://app.zeplin.io/project/63ca81b58cdf10309393a6cb/screen/63cebd4dea1c8010bb021d8d]]


Possible solutions:

1. Remove "Power cycle" from this bar and return the on/off actions to the little dropdown
2. Remove the little dropdown and move "Check power" to either "Power cycle" or "Troubleshoot"
3. Something else entirely (please respond lol)



[[https://chat.canonical.com/canonical/pl/5yt7f1wc7ig93khyth3pi8jufe][https://chat.canonical.com/canonical/pl/5yt7f1wc7ig93khyth3pi8jufe]]
*** Comments
**** [2023-08-24 Thu 14:21] Peter Makowski
:PROPERTIES:
:CommId:   302161
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-08-24 14:21:33
:END:
[~accountid:62a75900bf7afc006f3aa340] [~accountid:63b3c5e878aabbefa9d429f0] IMHO We should follow the original design unless there are strong opinions to do otherwise.
**** [2023-08-24 Thu 15:47] Maximilian Blazek
:PROPERTIES:
:CommId:   302223
:TYPE:     ejira-comment
:Author:   Maximilian Blazek
:Created:  2023-08-24 15:47:12
:END:
I am not sure what the context is, I can’t open the chat message.
**** [2023-08-25 Fri 11:22] Peter Makowski
:PROPERTIES:
:CommId:   302739
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-08-25 11:22:30
:END:
[~accountid:63b3c5e878aabbefa9d429f0] suggested to rename “Power cycle” to “Power” and move all power-related options to this dropdown.
**** [2023-08-25 Fri 11:25] Thorsten Merten
:PROPERTIES:
:CommId:   302740
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-08-25 11:25:40
:Modified: 2023-08-25 11:25:56
:END:
After a quick consultation with UX a quick fix is:
Rename power cycle to power, move check power in there, keep power indicator
* TODO [#C] [Dev] Investigate SSR / data endpoints
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2124
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-24 08:01:18
:Modified: 2023-11-22 15:51:02
:END:
*** Description
Investigate alternative implementation of data endpoints that would allow more elegant way of serving files such as tokens export CSV.

One solution would be the usage of server-side rendering (via vite ssr) or modifying the existing back-end endpoint to return a file.

More details below:

[[https://code.launchpad.net/~petermakowski/maas-site-manager/+git/site-manager/+merge/449602|smart-link][https://code.launchpad.net/~petermakowski/maas-site-manager/+git/site-manager/+merge/449602]]
*** Comments
* TODO [#C] [Dev] Tooltips on disabled inputs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2122
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-23 12:39:41
:Modified: 2023-10-23 07:27:30
:END:
*** Description
We’re using tooltips on disabled buttons which aren’t accessible.



*Acceptance criteria*

-  We need to provide an alternative button state where it’s focusable by either removing disabled attribute entirely and relying on validation to prevent submission.
- All TODO comments referring to this issue are removed and issues addressed
- usage of fireEvent is replaced with userEvent for a more realistic user interaction in tests
*** Comments
* TODO [#C] [Dev] Improve useSelectedMachinesActionsDispatch action type safety
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2121
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-08-23 11:55:35
:Modified: 2023-10-26 07:40:27
:END:
*** Description
For example, machineActions.checkPower cannot be dispatched using this hook - only actions that accept a filter
*** Comments
* TODO [#C] [Dev] Investigate ContextualMenu position on scroll
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2113
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-22 13:47:22
:Modified: 2023-10-23 07:27:30
:END:
*** Description
*Acceptance Criteria*

The root cause of the issue has been identified and a bug to a react-components or maas ui filed

----

ContextualMenu component used in maas-ui and maas-site-manager doesn’t update it’s children position on scroll. Not clear whether this is an issue with the ContextualMenu itself or how we’re using it in our codebase.


!Screen Recording 2023-08-21 at 17.29.51.gif|width=488,height=1052!




[[https://chat.canonical.com/canonical/pl/nq5k5e1ic3g5xftuj8tc88jezc][https://chat.canonical.com/canonical/pl/nq5k5e1ic3g5xftuj8tc88jezc]]
*** Comments
* TODO [#C] Fix sentry#10838 ResizeObserver loop limit exceeded
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2107
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-18 11:34:45
:Modified: 2023-10-23 07:27:30
:END:
*** Description
ResizeObserver loop limit exceeded

[[https://sentry.is.canonical.com/canonical/maas-ui/issues/10838/|smart-link][https://sentry.is.canonical.com/canonical/maas-ui/issues/10838/]]
*** Comments
* TODO [#C] Spike booting custom image with custom kernel
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2105
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Spike
:Created:  2023-08-17 14:18:25
:Modified: 2023-09-11 14:04:44
:END:
*** Description
*** Comments
**** [2023-09-05 Tue 07:04] Bjorn Tillenius
:PROPERTIES:
:CommId:   307326
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-05 07:04:14
:END:
I created a spike branch where I tried to make deploying a tgz image to RAM possible:

  [[https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/custom-image-diskless-spike|smart-link][https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/custom-image-diskless-spike]]

It doesn’t quite work yet, but it shows some of the places that we need to change.

Known issues is that it doesn’t make the tgz code conditional on ephemeral_deploy, so deploying a tgz to disk is currently broken.

It also requires the root-tgz file on disk to be renamed/copied to root-tgz.tgz. I didn’t get far enough so that I could confirm that the .tgz extension actually is needed. If it is, we need to change the image name to root.tgz instead of root-tgz.

I also need to check how the path to boot-kernel and boot-initrd are handled. I think that currently they need to be in the same directory as the tgz image.
**** [2023-09-05 Tue 07:54] Bjorn Tillenius
:PROPERTIES:
:CommId:   307347
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-05 07:54:38
:END:
I managed to deploy RHEL 9.0 to RAM using a tgz image. I had to do the following:

- cp /var/snap/maas/common/maas/boot-resources/current/ubuntu/amd64/generic/focal/stable/boot-* /var/snap/maas/common/maas/boot-resources/current/rhel/amd64/generic/9.0/uploaded/
- cp /var/snap/maas/common/maas/boot-resources/current/rhel/amd64/generic/9.0/uploaded/root-tgz /var/snap/maas/common/maas/boot-resources/current/rhel/amd64/generic/9.0/uploaded/root-tgz.tgz
- Disable allow_dns on the PXE subnet and set a DNS
    - If I didn’t do this, cloud-init fails since it can’t resolve the .internal dns name for the metadata url

I also fixed the spike branch so that it doesn’t set ‘ro’ for tgz images
**** [2023-09-05 Tue 08:00] Bjorn Tillenius
:PROPERTIES:
:CommId:   307352
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-05 08:00:40
:END:
I’ve confirmed that we need the =.tgz= extension for the served image. Without it, this happens:

{noformat}:: root=tar:http://10.5.32.99:5248/images/rhel/amd64/generic/9.0/uploaded/root-tgz
:: # [] http://10.5.32.99:5248/images/rhel/amd64/generic/9.0/uploaded/root-tgz
Connecting to 10.5.32.99:5248 (10.5.32.99:5248)
tar: Archive is compressed. Use -z option
tar: Error is not recoverable: exiting now
done.
{noformat}
**** [2023-09-05 Tue 09:50] Bjorn Tillenius
:PROPERTIES:
:CommId:   307408
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-09-05 09:50:24
:END:
I’ve updated the branch so that custom images automatically get name =root.tgz= instead of =root-tgz=, so no need to copy that file anymore.

I didn’t add any migration, so the image needs to be re-uploaded with the new code. We have to think about how to migrate this, but maybe we can do it as part of the image migration from db to disk.

what’s left now (apart from networking issues) is to make it select the right kernel to use, as well as making non-ephmeral deploys work again.
**** [2023-09-06 Wed 09:01] Jacopo Rota
:PROPERTIES:
:CommId:   308199
:TYPE:     ejira-comment
:Author:   Jacopo Rota
:Created:  2023-09-06 09:01:44
:END:
For the record It’s also possible to use symlinks (example on centos 8 image)

{noformat}sudo ln -s /var/snap/maas/common/maas/boot-resources/current/centos/amd64/generic/8/stable/root-tgz /var/snap/maas/common/maas/boot-resources/current/centos/amd64/generic/8/stable/root.tgz
sudo ln -s /var/snap/maas/common/maas/boot-resources/current/ubuntu/amd64/generic/focal/stable/boot-* /var/snap/maas/common/maas/boot-resources/current/centos/amd64/generic/8/stable/{noformat}
**** [2023-09-06 Wed 11:55] Jacopo Rota
:PROPERTIES:
:CommId:   308347
:TYPE:     ejira-comment
:Author:   Jacopo Rota
:Created:  2023-09-06 11:55:15
:END:
I’ve investigated the DNS issue: in the centos images the systemd-resolved service is inactive and not configured. For normal deployments we rely on curtin+cloud-init to configure the network.
I’m now checking how we do it for ephemeral ubuntu images where systemd-resolved is active and configured properly
* TODO [#C] Diskless booting of custom images
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2104
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Epic
:Created:  2023-08-17 14:17:34
:Modified: 2023-10-06 12:02:50
:END:
*** Description
*** Comments
* TODO [#C] [Dev] Nested side panel content handling
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2103
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-08-17 13:39:49
:Modified: 2023-08-17 13:39:50
:END:
*** Description
*Acceptance criteria*

We have a clean way of handling nested side panel content.

The current solution could prove problematic as the app grows.

Originally raised as a comment by [~accountid:618e26d4e1b3e00069718a8d]

#+BEGIN_QUOTE
  {{This introduces additional complexity and is a pattern that I haven't seen before anywhere else. I'd suggest to explicitly pass the arguments to setSidebar to trigger the correct sidebar. If we wanted to support navigation to previous/next sidebars, using a URL (e.g. param) and native browser history would be much better suited. Let's discuss, I'd like to understand better what you're trying to achieve here as I might be missing some context.}}
#+END_QUOTE

[[https://code.launchpad.net/~nickdv99/maas-site-manager/+git/site-manager/+merge/449099|smart-link][https://code.launchpad.net/~nickdv99/maas-site-manager/+git/site-manager/+merge/449099]]
*** Comments
* TODO [#C] [Dev] Fix tabs horizontal line
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2101
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-16 13:34:04
:Modified: 2023-08-18 09:22:19
:END:
*** Description
In Vanilla the thin gray line of the tabs component is usually at the bottom of the component, not at the top.

Refer to the original ticket for more information: [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2086|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-2086]]
*** Comments
**** [2023-08-18 Fri 09:22] Peter Makowski
:PROPERTIES:
:CommId:   297922
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-08-18 09:22:19
:END:
Marking as blocked, we need to decide how to proceed and triage with UX.
* TODO [#C] Site manager: Clean up spec and get it to be ready to review
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2092
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Thorsten Merten
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-08-14 15:15:34
:Modified: 2023-09-22 09:12:20
:END:
*** Description
- clean up the use cases
- remove any remaining template text
- add some technical details and decisions
- spec out offline map use case and rough process how to generate maps (see [~accountid:633d97f7140ba0bf651dee6a] 's initial bullet points)
*** Comments
**** [2023-08-15 Tue 11:14] Thorsten Merten
:PROPERTIES:
:CommId:   295469
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-08-15 11:14:11
:END:
Makes sense to focus first on tile generation:

- where to get the data from (likely OSM)
- how to “strip down” the data → Max defined which data makes sense to show and which does not make sense to show at all (e.g. stop signs, walking paths, …)
- how to package the data as =.mbtiles=
- how and when to style the data (in the build process vs. at runtime)

When this is fleshed out, clean up the spec and give it some flow 🙂
* TODO [#C] [Dev] Investigate scrollbar-gutter issues
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2088
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-08-11 14:44:18
:Modified: 2023-08-11 14:51:13
:END:
*** Description
Across all tables in MAAS Site Manager, the column headers will shift slightly to the left if a scroll bar is not present on the table (i.e. when there are not enough items to overflow beyond the page length). The easiest way to reproduce this is to switch between the real backend (7 regions) and mock data (155 regions).

!image-20230811-145003.png|width=1309,height=371!

Removing =scrollbar-gutter: stable= from =thead= inverts the issue - column headers will be properly aligned when there is no scrollbar, but will be shifted to the right when the scrollbar is present.

This issue also only seems to affect Chrome.
*** Comments
* TODO [#D] Move Rack Controller HTTP behind NGINX proxy
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2083
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Task
:Created:  2023-08-10 14:10:56
:Modified: 2023-08-10 14:10:56
:END:
*** Description
Documentation says nothing about port 5249 being exposed.

[[https://maas.io/docs/how-to-improve-maas-security#heading--firewalls|smart-link][https://maas.io/docs/how-to-improve-maas-security#heading--firewalls]]



We should listen 5249 on loopback interface only (or UNIX socket) and proxy_pass using NGINX as in rackd.nginx.conf
*** Comments
* TODO [#C] [Dev] Update API error response types
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2082
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-10 11:19:54
:Modified: 2023-11-22 15:51:00
:END:
*** Description
*** Comments
* TODO [#C] [Dev] Integrate supported /sites params
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2081
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-10 11:12:51
:Modified: 2023-08-16 13:07:28
:END:
*** Description
Pass down supported search text params (name) to /sites API endpoint using =getApiV1SitesGet= and params.
This will involve updating the file below
=frontend/src/api/handlers.ts=

Draft example of the implementation:

{noformat}apiClient.default.getApiV1SitesGet({
    page: Number(params.page),
    size: Number(params.size),
    sortBy: params.sortBy || null,
    // TODO: // parse the name from input field and pass as a query parameter
    // name:
  });{noformat}
*** Comments
**** [2023-08-16 Wed 12:11] Thorsten Merten
:PROPERTIES:
:CommId:   296472
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-08-16 12:11:19
:END:
Is that still valid?
**** [2023-08-16 Wed 13:00] Peter Makowski
:PROPERTIES:
:CommId:   296527
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-08-16 13:00:37
:END:
Yes. This relates to updating request handlers to pass the parameters using the new API client.
**** [2023-08-16 Wed 13:03] Peter Makowski
:PROPERTIES:
:CommId:   296529
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-08-16 13:03:31
:END:
I added more details to the description
* TODO [#C] Add /sites params to /sites/coordinates endpoint
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2080
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-10 11:00:47
:Modified: 2023-08-10 11:00:48
:END:
*** Description
/sites/coordinates endpoint’s parameters need to be the same as the /sites endpont in order for the front-end to be able to request and display the same list of sites for each view.
*** Comments
* TODO [#C] [Dev] Add e2e test for 401 redirect
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2078
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-10 10:32:38
:Modified: 2023-11-22 15:50:59
:END:
*** Description
*Acceptance criteria*

Test that a user is redirected to the login screen if an api responds with 401 status using playwright
*** Comments
* DONE [#C] Release 3.3.5
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2075
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Task
:Created:  2023-08-09 14:41:49
:Modified: 2023-08-11 16:42:00
:END:
*** Description
*** Comments
* TODO [#C] [Dev] Investigate column widths for variable columns
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2073
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-08-09 14:40:48
:Modified: 2023-08-09 14:42:46
:END:
*** Description
!image-20230809-144106.png|width=1914,height=1161!

On some of the tables in Site Manager, there is a lot of left-over space that could be used to allow other columns to expand, and not require wrapping. A key example of this is the “Time of request” column in the Requests table - there is clearly more than enough space to display this string on a single line, but the width of the column is forcing it to wrap.



This can be tricky as we cannot use an auto table layout (as it tends to be jumpy when there are content updates, like pagination), and will require further investigation.
*** Comments
* TODO [#C] Investigate why performance tests are failing
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2065
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2023-08-07 14:48:51
:Modified: 2023-08-07 14:49:44
:END:
*** Description
[[http://maas-ci.internal:8080/view/is-maas-fast-yet-tester/job/is-maas-fast-yet-tester-22.04-master-10/437/console][http://maas-ci.internal:8080/view/is-maas-fast-yet-tester/job/is-maas-fast-yet-tester-22.04-master-10/437/console]]
*** Comments
* TODO [#C] [Dev] Pinned side panels
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2064
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-03 08:59:47
:Modified: 2023-08-11 16:42:00
:END:
*** Description
*Acceptance criteria*

Any side panel can be opened or set to be displayed as “pinned”



Allow pinned side panels variant which pushes the content instead of sliding on top of it. This may involve updating application layout context to allow for a new variable.

[[https://vanillaframework.io/docs/layouts/application|smart-link][https://vanillaframework.io/docs/layouts/application]]

This is required for implemenation of map site selection side panel:
[[https://www.figma.com/file/EXkySo5BqSr7lMDGnwCuAD/MSM-map?node-id=80%3A36482&mode=dev|smart-link][https://www.figma.com/file/EXkySo5BqSr7lMDGnwCuAD/MSM-map?node-id=80%3A36482&mode=dev]]
*** Comments
* TODO [#C] [Dev] site patch endpoint back-end integration
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2059
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-08-02 10:20:55
:Modified: 2023-08-02 10:30:42
:END:
*** Description
Integrate edit site action with the API endpoint.



Blocked until implemented on the backend
*** Comments
* TODO [#C] [Dev] Investigate Markers implementation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2043
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-08-01 08:17:04
:Modified: 2023-10-09 11:57:05
:END:
*** Description
*Acceptance criteria*

- Markers implementation (and or library) has been defined
- each marker has an accessible label

Investigate markers implementation in more depth, didn't realise =react-leaflet= doesn't have a comprehensive support for them built in. I'll create a new issue for this.

MarkerLayer from react-leaflet-marker seems to support everything that we need but the library isn’t very popular and there are some concerns about adding it as a dependency to the project[[https://www.npmjs.com/package/react-leaflet-marker|smart-link][https://www.npmjs.com/package/react-leaflet-marker]]


[[https://github.com/holytrips/react-leaflet-marker/blob/master/src/MarkerLayer.tsx|smart-link][https://github.com/holytrips/react-leaflet-marker/blob/master/src/MarkerLayer.tsx]]

Potential solutions as suggested by [~accountid:62a75900bf7afc006f3aa340] :

1. Use =react-leaflet-marker=
2. Reverse-engineer =react-leaflet-marker= in a way that we're happy with
3. Something completely different (e.g. switching out SVGs based on state)


We also need to take into account displaying of clusters, for which there is a number of libraries that could simplify it. On the other hand we don’t know for sure how clusters are going to be handled (whether we’ll cluster sites on the client or server).
*** Comments
* TODO [#C] investigate temporal codec server for data encryption
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2040
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Spike
:Created:  2023-07-28 18:20:48
:Modified: 2023-11-21 15:34:51
:END:
*** Description
*** Comments
* TODO [#C] Calculate permissions and actions in maasapiserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2034
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Story
:Created:  2023-07-28 14:37:49
:Modified: 2023-07-28 14:41:16
:END:
*** Description
At the moment, the permissions and the actions are computed on django side and attached to the /machines request to the maasapiserver. This story aims to compute such properties directly in maasapiserver
*** Comments
*** TODO [#C] Calculate actions in maasapiserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2038
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-07-28 14:43:57
:Modified: 2023-07-28 14:43:57
:END:
**** Description
**** Comments
*** TODO [#C] Calculate permissions in maasapiserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2037
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-07-28 14:43:48
:Modified: 2023-07-28 14:44:01
:END:
**** Description
**** Comments
*** TODO [#C] Implement LocalSecretService and VaultService
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2036
:TYPE:     ejira-subtask
:Status:   In Review
:Reporter: Jacopo Rota
:Assignee: Jacopo Rota
:Issuetype: Sub-task
:Created:  2023-07-28 14:42:20
:Modified: 2023-08-02 08:20:04
:END:
**** Description
**** Comments
* TODO [#C] [Dev] Expand map to width of browser window
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2032
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-07-27 15:11:46
:Modified: 2023-07-27 15:14:15
:END:
*** Description
!image-20230727-151159.png|width=1920,height=804!

Currently, on large screens, the map does not expand to the edges of the screen, leaving a large amount of whitespace on either side. This is due to every page being rendered within a row/col combo with a maximum width of 120rem, at the top level.

The buttons for zooming in/out of the map and the warning icon should expand with the map, but the controls bar at the top should remain within the constraints of the 120rem column.
*** Comments
* TODO [#C] [Dev] Integrate "Create sites with missing data" component with the map
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2030
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:42:19
:Modified: 2023-09-26 07:34:31
:END:
*** Description
The component and it’s entry point is shown [[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#bookmark=id.q8ki9zd10ndu][In the map spec under: “Warning, missing regions“]]

*Acceptance criteria*

All interactions of the component including such that require integration with the map have been implemented as per design

- Add warning triangle to map, show only if there are regions without lat/lon
    - We might want to add a new back-end endpoint for this info, as it can be super cheap to query on the DB but could be hard to compute in the frontend → please discuss pro/cons of this
- Add component listing the impacted regions as shown in the spec
*** Comments
**** [2023-09-25 Mon 12:47] Thorsten Merten
:PROPERTIES:
:CommId:   317012
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-09-25 12:47:02
:END:
[~accountid:63b3c5e878aabbefa9d429f0] : Do you think we need to display a list of those sites in the map’s side bar? Or would a link to the filtered table be enough?
**** [2023-09-26 Tue 07:34] Maximilian Blazek
:PROPERTIES:
:CommId:   317456
:TYPE:     ejira-comment
:Author:   Maximilian Blazek
:Created:  2023-09-26 07:34:31
:END:
In a previous design iteration I had it like that, that we just redirect to a filtered table.
On those wireframes Jack gave feedback that it might be better UX to set the missing lat/long data as a marker directly on the map, because in a lot of cases you will know /where/ a data centre is, but you will not know the lat/long data by heart. Since I agreed with this feedback, I had designed this userflow. And to facilitate that userflow we would need to stay on the map view rather than forwarding to a filtered table view.
* TODO [#C] [Dev] "Create sites with missing data" component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2029
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:40:36
:Modified: 2023-07-26 15:40:38
:END:
*** Description
*Acceptance criteria*

- Sites with missing data component is created as per design

Note that this does not include integration with the map (including any interaction that requires such integration).



!Google Chrome screenshot 000491@2x-20230726-153910.png|width=256,height=422!
*** Comments
* TODO [#C] [Dev] Implement site clusters selection
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2028
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:34:46
:Modified: 2023-09-25 12:15:47
:END:
*** Description
!Mattermost screenshot 000488@2x-20230726-153255.png|width=137,height=171!

*Acceptance criteria*

- Clusters can be selected by drag and drop
- selected state is persisted across views
*** Comments
* TODO [#C] [Dev] Integrate Selection panel with the map
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2027
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:26:26
:Modified: 2023-08-02 14:26:18
:END:
*** Description
*Acceptance Criteria*

- When there are active sites in the selection in the map view, a selection panel is displayed
- Remove from selection is integrated
- Necessary additional data for each site displayed on the list is fetched from the API using one of the existing endpoints

!Google Chrome screenshot 000486@2x-20230726-152732.png|width=346,height=257!



----

******** Notes on API integration

[[https://chat.canonical.com/canonical/pl/7duz4i4dk7y59ghg9e9d9b86wa][https://chat.canonical.com/canonical/pl/7duz4i4dk7y59ghg9e9d9b86wa]]

[~accountid:62a75900bf7afc006f3aa340] and [~accountid:63bbf101713349bea186c04c] were ideating possible ways to get the selected site data displayed on the sidepanel, given that we would have a list of selected site IDs, requesting for each site detail looks like a lot of back and forth request work, we can't also use hooks to call individually because it'll go in a callback. Here are possible options:

1. Have a list of ids sent to the backend to get sites info, but this would still send a new request for everytime a new site is selected.
2. Query the sites cache for each selected id.

Could there be a better or less expensive way to achieve this?

Regarding point 1. - we have some options of mitigating this with react query and manipulating staleTime option - it will not refetch sites data unnecessarily. [[https://tanstack.com/query/v4/docs/react/guides/initial-query-data#staletime-and-initialdataupdatedat|smart-link][https://tanstack.com/query/v4/docs/react/guides/initial-query-data#staletime-and-initialdataupdatedat]]
*** Comments
* TODO [#C] [Dev] Marker selection on drag and drop
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2025
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:24:26
:Modified: 2023-07-31 13:59:33
:END:
*** Description
(blocked until markers on the map are displayed)


*Acceptance criteria*

In map view drag and drop allows to select multiple sites

Sites added to the selection have an updated style as per design



!Google Chrome screenshot 000478@2x-20230726-152304.png|width=535,height=308!
*** Comments
* TODO [#C] [Dev] Enlarge markers selected for removal
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2024
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:22:52
:Modified: 2023-08-01 08:20:12
:END:
*** Description
*Acceptance criteria*

In map view, with active side delete side panel all sites selected for removal are displayed with enlarged markers
*** Comments
* TODO [#C] [Dev] Implement drag and drop for markers in site edit mode
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2023
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-26 15:21:30
:Modified: 2023-07-26 15:21:31
:END:
*** Description
!Google Chrome screenshot 000472@2x-20230726-151832.png|width=415,height=383!

*Acceptance criteria*

- when in site edit mode marker position updates on update using the edit form field
- when in site edit mode clicking and dragging the marker when in edit mode
- drag to  change position tooltip is displayed on marker hover
*** Comments
* TODO [#C] [Dev] Set zoom level according to existing sites selection
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2019
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-26 15:10:23
:Modified: 2023-07-26 15:28:46
:END:
*** Description
*Acceptance criteria (draft)*

As a user, having selected a number of sites on the sites list, the map zoom level and position when you switch over to map view should be adjusted so that all sites are visible (to their bounding box)
*** Comments
* TODO [#C] [Dev] Create timezone search component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2018
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-26 15:07:06
:Modified: 2023-08-03 07:27:24
:END:
*** Description
*Acceptance criteria (draft)*

- Create the timezone search component
- Listed standardised timezones are the same across all browsers
- Make sure all states are implemented as per design

!Google Meet screenshot 000468@2x-20230726-150411.png|width=212,height=366!
*** Comments
* TODO [#C] Temporal observability
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2005
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2023-07-24 22:28:21
:Modified: 2023-10-04 14:22:35
:END:
*** Description
*** Comments
*** DONE [#C] Expose Temporal SDK metrics (rackd)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2008
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2023-07-24 22:30:01
:Modified: 2023-07-26 21:59:39
:END:
**** Description
SDK metrics setup

[[https://docs.temporal.io/kb/prometheus-grafana-setup#sdk-metrics-setup|smart-link][https://docs.temporal.io/kb/prometheus-grafana-setup#sdk-metrics-setup]]
**** Comments
* TODO [#C] Set machine results keyed by params as partial
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2002
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-24 09:36:56
:Modified: 2023-10-23 07:27:29
:END:
*** Description
Acceptance Criteria

- accessing machine.lists[key] or machine.counts[key] without checking if such key exists triggers a TypeScript error

----

We know for a fact that not all possible keys will have a value - as this could lead to a runtime error =cannot read property of undefined= such as: [[https://github.com/canonical/maas-ui/issues/5072|smart-link][https://github.com/canonical/maas-ui/issues/5072]]

Endpoint results keyed by params should be marked as partial (this includes machine.counts, machine.lists).

*example implementation below*
export type MachineStateCounts = Partial<Record<string, MachineStateCount>>; MachineStateLists

export type MachineStatuses = Record<Machine[[http://MachineMeta.PK][[MachineMeta.PK]]], MachineStatus>;
*** Comments
* TODO [#C] Add caching for HTTP requests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1996
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-21 11:43:19
:Modified: 2023-07-21 12:05:12
:END:
*** Description
{noformat}type Endpoint = string;
type EndpointState = { fetchedAt: number };

const MAX_CACHE_TIME = 1000 * 5; // 5 seconds
export const isStale = (endpoint: Endpoint): boolean => {
  if (loadedEndpoints.has(endpoint)) {
    const { fetchedAt } = loadedEndpoints.get(endpoint)!;
    const now = Date.now();
    return now - fetchedAt < MAX_CACHE_TIME;
  } else {
    return false;
  }
};{noformat}

- Add caching for all HTTP requests, not just zones
- Add tests
*** Comments
* TODO [#C] [Dev] Improve components organisation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1993
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-21 08:20:32
:Modified: 2023-07-21 08:20:33
:END:
*** Description
*Acceptance criteria*

- Components are organised by feature, e.g. into general, pages, and layouts folders
- Page-specific components are placed in a page directory
- General use components are placed in shared components directory, e.g. “components/common”
*** Comments
* DONE [#C] [Dev] Integrate machine.list_ids
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1989
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-07-20 09:49:29
:Modified: 2023-07-20 09:53:08
:END:
*** Description
- check if we can drop the requirement of passing actions/permissions, since =machine.list_ids= returns it, and have the REST endpoint just return the list of machines
    - UI would need to:
        - call =machine.list_ids= on the WS, getting a structure similar to the current =machine.list= one, but with only IDs, permissions and actions
        - call =/machines= on the apiserver with the list of IDs, get a list of machines (without permissions and actions)
- add =machine.list_ids =websocket method
*** Comments
* TODO [#C] [Dev] MSM investigate alternative vitest-environment
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1988
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-19 12:56:37
:Modified: 2023-11-22 15:50:57
:END:
*** Description
Acceptance criteria

- verify which vitest environment is most suitable for all integration tests : =jsdom= , =happy-dom = or browser mode
- there’s no overwrite for a single file such as the one in =frontend/src/components/Navigation/Navigation.test.tsx=via =@vitest-environment happy-dom=


[[https://vitest.dev/config/#environment|smart-link][https://vitest.dev/config/#environment]]
*** Comments
* TODO [#C] [Dev] Add map regions selection
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1983
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-18 14:18:44
:Modified: 2023-09-25 08:44:24
:END:
*** Description
The selection process is defined in [[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#bookmark=id.h5gf3i6ewrig][the map spec under: “Selection”]]

*Acceptance criteria*

- user can switch between selection modes using a mouse or holding a certain key on a keyboard
- when in selection mode, dragging the cursor on the map adds items to selection
- when in unselect mode, dragging the cursor on the map removes items from the selection
*** Comments
* TODO [#C] [Dev] Add MapSelectionControl component and selection stat
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1980
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-18 14:13:04
:Modified: 2023-09-25 09:12:52
:END:
*** Description
The selection process is defined in [[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#bookmark=id.h5gf3i6ewrig][the map spec under: “Selection”]]

*Acceptance Criteria*

- MapSelectionControl component has been created
- MapSelectionControl has been added to SitesTableControls and toggles between map selection modes state
- map selection mode state has been added and can be accessed by the sites list (table), map and sidebar components

*MapSelectionControl*

!Google Chrome screenshot 000858-20230925-091122.png|width=217,height=147!
*** Comments
* DONE [#C] [Dev] Adjust map granularity per zoom level - add styling
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1973
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Peter Makowski
:Assignee: Jacopo Rota
:Issuetype: Task
:Created:  2023-07-18 13:40:21
:Modified: 2023-10-11 11:16:15
:END:
*** Description
******** Acceptance criteria

- Show the map data according to the zoom level constraints listed below
- Show the map as per the style defined by Max

Make sure that the rendered =.mbtiles= do not contain any additional/unnecessary information and do contain the styling.

The following list should be understood as the minimal zoom level at which that data should be shown on the map. Note however, that each of those data categories (like water for example) could have different rendering rules, depending on the zoom level. For example not every small river will be displayed at zoom level 1. For those data category level settings we can rely on the sensible defaults of most tilesets.

*Zoom level 1:*

- Water
- Country borders
- Country labels

*Zoom level 2:*

- City labels

*Zoom level 4:*

- State borders

*Zoom level 7:*

- Roads

*Zoom level 12:*

- Buildings
- Labels for primary, secondary and tertiary roads

*Zoom level 15:*

- Labels for unclassified roads

*Zoom level 16:*

- Housenumbers


Refer to the specification for most up-to-date information
[[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#heading=h.w2vmzn8bi46t|smart-link][https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#heading=h.w2vmzn8bi46t]]
*** Comments
**** [2023-07-26 Wed 08:13] Jones Ogolo
:PROPERTIES:
:CommId:   283952
:TYPE:     ejira-comment
:Author:   Jones Ogolo
:Created:  2023-07-26 08:13:25
:END:
Regarding the specifications above for granularity, Leaflet at this time does not support granularity specifications for different zoom levels, and some of the details as requested in the spec are already consistent with OpenStreetMap’s tiles which are in use. The map tiles provided by OSM is not detailed enough to view house numbers at this time.
**** [2023-08-16 Wed 12:30] Thorsten Merten
:PROPERTIES:
:CommId:   296481
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-08-16 12:30:30
:END:
This closely relates to the issue above and I think it should be part of that pipeline.
**** [2023-09-25 Mon 08:36] Thorsten Merten
:PROPERTIES:
:CommId:   316836
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-09-25 08:36:54
:END:
Note: This and the design can both be done by configuring =tilemaker= properly
**** [2023-10-11 Wed 11:16] Peter Makowski
:PROPERTIES:
:CommId:   324325
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-11 11:16:15
:END:
Both me and [~accountid:63b3c5e878aabbefa9d429f0] spent some time investigating vector tiles which are significantly smaller (~15MB).

I focused on the front-end integration and made some good progress on rendering static tiles (using pbf files). Some early results:  - it (surprise, surprise!) doesn't play nicely with leaflet.

I have a local spike where I use maplibre-gl for rendering instead. We might chose to use it for rendering the entire map including markers or tiles only. There are libraries trying to integrate maplibre-gl with react, but they have similar problems to leaflet counterparts.
* TODO [#C] [Dev] Add support for air-gapped environment
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1968
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-07-18 13:08:09
:Modified: 2023-07-18 13:08:09
:END:
*** Description
Add and setup the following dependencies in order to support air-gapped environment:

- Leaflet offline (tile images)
- Natural Earth (JSON files with country boundaries etc.)
*** Comments
* TODO [#C] Bug #1930001
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1956
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2023-07-06 18:20:50
:Modified: 2023-10-02 15:16:45
:END:
*** Description
[[https://bugs.launchpad.net/maas/+bug/1930001|smart-link][https://bugs.launchpad.net/maas/+bug/1930001]]
*** Comments
* TODO [#C] Multipath JBOD storage devices are not shown via /dev/mapper but each path as a single device. Edit
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1913
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee: Alexsander Silva de Souza
:Issuetype: Bug
:Created:  2023-06-28 15:33:08
:Modified: 2023-07-18 14:30:00
:END:
*** Description
[[https://bugs.launchpad.net/maas/+bug/1887558|smart-link][https://bugs.launchpad.net/maas/+bug/1887558]]
*** Comments
* TODO [#C] Add machine details requests cache keys
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1909
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-06-28 11:54:54
:Modified: 2023-10-23 07:27:29
:END:
*** Description
Similar to [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1905|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1905]]

Ensure we’re not calling machine.get unnecessarily in quick succession by adding callId as JSON.stringify of request parameters and disregarding the fetch if fetchedAt was higher than a set value.
*** Comments
* TODO [#C] Research tile servers and see if lightweight approaches are available
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1896
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Thorsten Merten
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-06-26 12:25:27
:Modified: 2023-09-22 09:12:29
:END:
*** Description
We need to know which (vector) tile server approaches are out there and if there is something that can be used in a lightweight fashion.

This could result in a table in the spec, e.g.

| *Tile server* | *Link*                           | *Uses DB* | *Type of server*                                                   | *Needs additional setup*                        |
|---------------+----------------------------------+-----------+--------------------------------------------------------------------+-------------------------------------------------|
| pg_tileserv   | [[https://github.com/CrunchyData/pg_tileserv|smart-link][https://github.com/CrunchyData/pg_tileserv]] | Postgres  | A go binary that, that connects to postgres and acts as tileserver | Likely some proxy/certificate setup to be HTTPS |
|               |                                  |           |                                                                    |                                                 |

Here is a list of “not lightweight” tileservers from OSM: [[https://wiki.openstreetmap.org/wiki/Tile_servers|smart-link][https://wiki.openstreetmap.org/wiki/Tile_servers]]
Here is a more comprehensive list of tile servers: [[https://github.com/mapbox/awesome-vector-tiles#servers|smart-link][https://github.com/mapbox/awesome-vector-tiles#servers]]
*** Comments
**** [2023-06-26 Mon 12:35] Thorsten Merten
:PROPERTIES:
:CommId:   266722
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-06-26 12:35:10
:END:
I found this blog entry where somebody explains how to create vector tiles and serves them as static content without a database. They also link to some code for generating this setup: [[https://robertodip.com/blog/building-interactive-maps-with-statically-generated-vector-tiles/|smart-link][https://robertodip.com/blog/building-interactive-maps-with-statically-generated-vector-tiles/]] . Might be worth trying.
This way we could serve the tiles


- as static assets of the frontend (although this might be a lot of data)
- at some place in the backend that can deliver static data
- at some nginx proxy/reverse proxy that is yet to be determined in the overall setup (see [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1649|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1649]] )
* TODO [#C] Add a table of hosted tile servers / providers to the spec
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1895
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Thorsten Merten
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-06-26 08:54:42
:Modified: 2023-09-22 09:12:33
:END:
*** Description
Something to compare the license models, e.g.

| *Provider name* | *Personal use* | *Open Source* | *Commercial use* |
|-----------------+----------------+---------------+------------------|
| max box         | +              | -             | -                |
| open street map | +              |               |                  |
| …               |                |               |                  |
*** Comments
* TODO [#C] Replace machine Node enums with constants
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1894
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-06-23 08:55:29
:Modified: 2023-07-18 14:30:11
:END:
*** Description
Refactor the following enums to constants:

=FetchGroupKey=

=FetchGroupByKey=

=NodeStatus=

=FetchNodeStatus=
*** Comments
* TODO [#C] As a MAAS developer, I want Temporal to take care of all retries when trying  to deploy N machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1893
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-06-22 15:54:00
:Modified: 2023-06-22 15:54:00
:END:
*** Description
*** Comments
* TODO [#C] As a MAAS developer, I want to be able to execute a workflow to commission N machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1889
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-06-22 15:52:05
:Modified: 2023-06-22 15:52:05
:END:
*** Description
*** Comments
* DONE [#C] As a MAAS developer, I want to be able to execute a workflow to manage power of N machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1887
:TYPE:     ejira-story
:Status:   In Progress
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2023-06-22 15:51:36
:Modified: 2023-09-27 12:06:31
:END:
*** Description
*** Comments
* TODO [#C] As a MAAS developer, I want to have certain workflow coding guidelines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1886
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-06-22 15:51:10
:Modified: 2023-06-22 15:51:10
:END:
*** Description
*** Comments
* TODO [#C] Create msw integrations for deleting a user
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1876
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jones Ogolo
:Assignee:
:Issuetype: Task
:Created:  2023-06-20 10:22:19
:Modified: 2023-07-18 14:30:11
:END:
*** Description
Data needs and API routes can be found in the EPIC ticket
*** Comments
* TODO [#C] Create MSW implelemtation for updating user password on MSM
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1864
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Jones Ogolo
:Assignee:
:Issuetype: Task
:Created:  2023-06-20 08:51:18
:Modified: 2023-07-18 14:30:12
:END:
*** Description
Data needs and contract can be found in the Epic
*** Comments
* TODO [#C] Update e2e tests to use 3.4/edge
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1853
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-06-14 09:14:58
:Modified: 2023-07-18 14:30:12
:END:
*** Description
- Update maas-ui cypress tests to use maas 3.4/edge once available
- Fix any failing tests in [[https://github.com/canonical/maas-ui/issues/4995|smart-link][https://github.com/canonical/maas-ui/issues/4995]]
*** Comments
* TODO [#C] Enable table sort for remaining fields
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1844
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-06-07 14:34:24
:Modified: 2023-07-18 14:30:12
:END:
*** Description
*** Comments
* TODO [#C] Update discourse.maas.io navigation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1843
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-06-07 08:55:37
:Modified: 2023-07-18 14:30:12
:END:
*** Description
*** Comments
**** [2023-06-07 Wed 09:02] Peter Makowski
:PROPERTIES:
:CommId:   254014
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-06-07 09:02:57
:END:
This review is based on [[https://discourse.maas.io/?preview_theme_id=19|smart-link][https://discourse.maas.io/?preview_theme_id=19]]

[~accountid:63bbf101713349bea186c04c]  Alignement of the logo and items is incorrect.

*Expected*

!image-20230607-090144.png|width=1920,height=486!

*Actual*

!image-20230607-090150.png|width=1920,height=576!

take a look at the spacing in the logo and discourse heading which is not centered vertically:

!image-20230607-090135.png|width=978,height=486!
* TODO [#C] Server side machine listing cleanup
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1839
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Epic
:Created:  2023-06-06 08:47:50
:Modified: 2023-06-30 13:53:24
:END:
*** Description
*** Comments
* TODO [#C] Implement actionStatus across all forms
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1838
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-06-05 11:48:56
:Modified: 2023-10-23 07:27:29
:END:
*** Description
[[https://github.com/canonical/app-tribe/issues/1289|smart-link][https://github.com/canonical/app-tribe/issues/1289]]



The idea of =actionStatus= is to encode all possible states (loading, success, …) in a single variable instead of using multiple =bool=eans.

Search for things such as

- =processingComplete=
- =processingStarted=

to find states that need harmonising.
*** Comments
**** [2023-06-30 Fri 13:49] Peter Makowski
:PROPERTIES:
:CommId:   270342
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-06-30 13:49:11
:END:
This item was optional and deprioritised as we focused on machine list / count requests caching where we spent the majority of the time in this epic: [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1834][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1834]] [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1905|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1905]]
* TODO [#D] Update documentation to include operational management of DB (see below)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1796
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: David Desrosiers
:Assignee:
:Issuetype: Task
:Created:  2023-05-31 22:10:15
:Modified: 2023-06-01 07:28:34
:END:
*** Description
There’s a bit of sparse information on deploying MAAS and initially connecting it to a database (external or internal), but what’s missing, is the operational management of the DB itself, covering topics such as “How do I reconfigure MAAS to point to a new DB DSN/IP address?”, and “How do I perform DB maintenance, while bringing up a secondary/failover/DR site?” and similar.
*** Comments
* TODO [#C] Design integration testing strategy
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1795
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Task
:Created:  2023-05-31 14:24:56
:Modified: 2023-05-31 14:25:19
:END:
*** Description
TO be discussed
*** Comments
* TODO [#C] Add system test for websocket
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1794
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Task
:Created:  2023-05-31 14:18:06
:Modified: 2023-05-31 14:18:07
:END:
*** Description
*** Comments
* TODO [#C] Implement the HTTP handlers for the zones in maasfastserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1787
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Story
:Created:  2023-05-31 12:34:04
:Modified: 2023-05-31 12:34:04
:END:
*** Description
*** Comments
*** TODO [#C] Implement PUT zone update and plug it in the websocket handler in maasserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1791
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-05-31 12:35:31
:Modified: 2023-05-31 12:36:25
:END:
**** Description
**** Comments
*** TODO [#C] Implement DELETE zone delete and plug it in the websocket handler in maasserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1790
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-05-31 12:35:22
:Modified: 2023-05-31 12:36:20
:END:
**** Description
**** Comments
* TODO [#C] LP#1953049: Error while calling ScanNetworks
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1780
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Bug
:Created:  2023-05-30 15:54:03
:Modified: 2023-07-18 14:29:45
:END:
*** Description
[[https://bugs.launchpad.net/maas/+bug/1953049][https://bugs.launchpad.net/maas/+bug/1953049]]
*** Comments
* TODO [#C] User management has been updated in Site Manager
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1761
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee:
:Issuetype: Task
:Created:  2023-05-23 11:24:03
:Modified: 2023-10-31 15:24:42
:END:
*** Description
Site Manager has introduced user management and slightly changed the user flows to adhere to the latest best practices of the application layout. So Site Manager is ahead of MAAS in this regard.
*** Comments
**** [2023-10-31 Tue 15:22] Peter Makowski
:PROPERTIES:
:CommId:   333692
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-31 15:22:55
:END:
Note to self: This is in regards to edit, delete, and add user forms being opened in a side panel in site manager vs inline form in MAAS UI.
**** [2023-10-31 Tue 15:23] Peter Makowski
:PROPERTIES:
:CommId:   333693
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-10-31 15:23:45
:END:
We’ll need to look into reuse of the application layout structure across maas-ui and maas-site-manager that will enable sharing such patterns as described in this issue.
* TODO [#C] MAAS UI Components
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1760
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Epic
:Created:  2023-05-23 11:18:24
:Modified: 2023-10-31 15:24:12
:END:
*** Description
This epic is to track progress of keeping the components of maas-ui and maas-site-manager in sync.
*** Comments
* DONE [#B] Automated OS Image Testing
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1717
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters
:Issuetype: Epic
:Created:  2023-05-19 15:18:12
:Modified: 2023-11-21 15:35:09
:END:
*** Description
What this should look like

1. A temporal workflow to build images
    1. Utilising the instructions in packerMAAS
    2. Verifying the image is complete
    3. Storing the built images in an easy to access location
    4. populating an image mapping with the details of the image required to upload to MAAS as a custom boot-resource
2. A temporal workflow to run systemtests
    5. download images to test from central location
    6. upload to MAAS
    7. overwrite deployment image in =test_full_circle=
    8. test custom deployment options (ie: storage, networking)
3. A temporal workflow to collect results
    9. See MA100
    10. collect details from image, and tests
    11. store somewhere accessible to doc frontend to be converted into human readable information



Modifications needed (Non-exhaustive):

1. systemtests
    1. create the image mapping yaml
    2. teach =gen_config= how to read the image map, and write a config.yaml from it
    3. teach system tests how to download an image and upload to MAAS
2. temporal
    4. create all the workflows (obviously!)
    5.
3. packerMAAS
*** Comments
* TODO [#C] Auto-update time distance strings
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1692
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-05-17 07:36:48
:Modified: 2023-07-18 14:29:45
:END:
*** Description
Times in the status column do not appear to change when new data is received from the back-end, nor when the relative time distance has changed based on the local time. They should re-render and display updated time distance string once per minute.
e.g. in =ConnectionInfo.tsx=
=<time dateTime={lastSeen}>{getLastSeenText({ connection, lastSeen })}</time>=
*** Comments
* TODO [#C] Use side navigation from react-components
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1691
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-17 07:33:29
:Modified: 2023-05-17 07:33:30
:END:
*** Description
Use a single consistent side navigation component once an agreement has been reached in the UX team and a new side navigation component added to @canonical/react-components.
*** Comments
* TODO [#C] Sites list collapsible header
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1690
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-17 07:31:42
:Modified: 2023-07-18 14:29:45
:END:
*** Description
Followup on table header on sites as it now takes a lot of space (bring back accordion).

Discuss with UX how exactly it’s supposed to look like.

This might require changes to DynamicTable component so that it detects changes to its position and fires on resize (unless we’re okay with the table body being pushed down if the accordion is expanded).
*** Comments
* TODO [#C] Create map specification
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1684
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Peter Makowski
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-05-16 12:40:22
:Modified: 2023-09-22 09:12:42
:END:
*** Description
****** Guidelines for MAAS Site Manager map front-end specification

********* Intro to specifications

- Read [[https://docs.google.com/document/d/1lStJjBGW7lyojgBhxGLUNnliUocYWjAZ1VEbbVduX54/edit#][Specifications - Purpose and Guidance]]
- Familiarise yourself with specs website [[https://specs.canonical.com/][https://specs.canonical.com/]]

********* Site Manager Map Specification

- familiarise yourself with the [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1645][Site manager: Add map to frontend]] epic
- translate the acceptance criteria below into technical requirements that will inform your research
- investigate and list the potential tools that might help us build a map considering the specified acceptance criteria
- select the most suitable solution for our specific needs and provide the reasoning behind your choice. You might want to include a comparison of features included in each library that are crucial for our map.
- having chosen the library (or a set of libraries), provide a high-level overview of the implementation that will meet the specified acceptance criteria.
- You should include details on implementation of features that are not built-in your chosen library. This should include estimates for the effort required. Some examples:
    - state management and integration with the existing Site Manager front-end architecture
    - how will we convert coordinates lat/lang data and display it on the map
    - displaying additional information for each site on hover/focus
    - how offline tiles/vector data will be stored and accessed

----

********* Acceptance criteria

- The map should be usable in an air-gapped environment (no internet connection)
- The map should be able to display 10.000s/100.000s of markers
- The map should display all locations that have lat/lon information
- Hovering over a site should give additional information
- Show connection state (e.g. using colors)
- Clicking on a site might redirect to a detail view

********* Some examples of libraries to help you get started

[[https://openmaptiles.org/|smart-link][https://openmaptiles.org/]]
[[https://github.com/maplibre/maplibre-gl-js|smart-link][https://github.com/maplibre/maplibre-gl-js]]
[[https://allartk.github.io/leaflet.offline/|smart-link][https://allartk.github.io/leaflet.offline/]]
[[https://www.naturalearthdata.com/|smart-link][https://www.naturalearthdata.com/]]
*** Comments
**** [2023-05-19 Fri 08:21] Peter Makowski
:PROPERTIES:
:CommId:   242595
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-05-19 08:21:56
:END:
[~accountid:63bbf101713349bea186c04c] I added detailed guidelines for MAAS Site Manager map front-end specification to the description. Please familiarise yourself with them before you get started.
**** [2023-05-19 Fri 08:51] Peter Makowski
:PROPERTIES:
:CommId:   242618
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-05-19 08:51:42
:END:
[[https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#|smart-link][https://docs.google.com/document/d/1chJgGPWxY0tG5E78sUUfVkzuv1ZUh_OeAdyY4IIcb9U/edit#]]
* TODO [#C] [UXR] Share research findings
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1668
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:23:38
:Modified: 2023-05-10 10:23:45
:END:
*** Description
*** Comments
* TODO [#C] [UXR] Analyse research findings
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1667
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:23:25
:Modified: 2023-05-10 10:23:43
:END:
*** Description
*** Comments
* DONE [#C] [UXR] Conduct the research
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1666
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:22:44
:Modified: 2023-06-21 13:12:32
:END:
*** Description
*** Comments
* DONE [#C] [UXR] Recruit participants
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1664
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:19:07
:Modified: 2023-06-14 14:33:54
:END:
*** Description
*** Comments
* TODO [#C] [UX] High definition 2: Image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1661
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:11:02
:Modified: 2023-05-10 10:11:07
:END:
*** Description
*** Comments
* TODO [#C] [UX] High definition 1: Image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1660
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:10:53
:Modified: 2023-05-10 10:11:05
:END:
*** Description
*** Comments
* DONE [#C] [UX] Wireframe: Image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1659
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:10:40
:Modified: 2023-09-29 12:49:13
:END:
*** Description
*** Comments
* TODO [#C] [UX] Definition: Image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1658
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Maximilian Blazek
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-05-10 10:10:12
:Modified: 2023-09-29 12:49:11
:END:
*** Description
*** Comments
* TODO [#C] Explore geolocation data needs for Site Manager [Spike]
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1652
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Maximilian Blazek
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:20:34
:Modified: 2023-05-10 10:31:12
:Effort:   00:00
:Left:     00:00
:END:
*** Description
In the first MVP of Site Manager we only have very basic geolocation data: /Country, City, Street/. In our user testing, we got feedback that this geolocation data might not be granular enough for certain use cases and would not encompass all the possibilities of address resolution in different countries. The [[https://nominatim.org/release-docs/latest/api/Output/#addressdetails][Open Street Maps Nominatim API data model for address resolution]] has a relatively complete list of ways an address can be resolved. We could use this data model as inspiration, but we need to confirm that these additional geolocation data types are actually useful to our users and if so, which ones we should include.

We also need to ensure that addresses can be set correctly with our geolocation data model, as one user mentioned in our user testing sessions that they would be unable to set the geolocation data of one of their data centres correctly because they span multiple streets, which would not be possible in the current geolocation data model of Site Manager.

Expected outcome:

- We have found a geolocation data model that meets the needs of our users.
- Add this feature to the next MVP.
*** Comments
* TODO [#C] Site manager: Image provisioning
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1651
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:20:19
:Modified: 2023-08-21 07:08:52
:Effort:   00:00
:Left:     00:00
:END:
*** Description
MAAS Site Manager should be able to instruct MAAS wrt. image provisioning.

Customers would like to have a single place to store MAAS images and make multiple instances point to that place.

We would configure images in MAAS Site Manager and MAAS regions would fetch the images from Site Manager and make it available for their deployments (similar to central user configuration).

- Central image management (likely pointing to images not necessarily distributing images). E.g. making sure that sites sync with a central packer server
- A Site Manager user wants to tell one or more MAASes to update images (not the hosts themselves that are running images)
    - Selecting the sites for this would be the most likely first use case for the map (not only for the map!)



User journey:

- User created a nice new image with packer or finds an awesome image in the web somewhere
- Uploads it to Site manager
- Site manager would either
    - drop the image to some repo that it is connected to itself
    - have its own repo that regions can access
- MAAS Sites pick up that image and make it available



(also see related issue remove image storage from db)
*** Comments
* DONE [#B] Site manager: User Management
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1650
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:19:47
:Modified: 2023-08-16 08:37:53
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Local user management :

- Expose user table to API
- Create user management frontend (CRUD for users)
- Make sure that only admin users can add/delete/manage other users

Here are the latest screens for user management: [[https://app.zeplin.io/project/6462417916233d24e570b33e|smart-link][https://app.zeplin.io/project/6462417916233d24e570b33e]]

Here is the original spec for the frontend contract (which has been superseded by the screens above) [[https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit#heading=h.ced5lgleq0tq|smart-link][https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit#heading=h.ced5lgleq0tq]]

For the back-end we need to expose:

********** HTTP GET */users?page=1&size=20*

*Response*

{noformat}{  items: [
  {
    name: <sortable, string>,
    username: <sortable, string>,
    email: <sortable, string>,
    is_admin: <boolean>,
  }, ... ],
  total: 42, page: 1, size: 20
}{noformat}

********** HTTP POST */users/*

*Body*

{noformat}{
  name: string,
  username: string,
  email: string,
  password: string,
  is_admin: <boolean>,
}{noformat}

*Errors*

=400 if username taken, email taken, missing fields=

********** HTTP POST */users/password*

Change the password

*Body*

{noformat}{
  current_password: string,
  password: string,
}{noformat}

*Errors*

=400 if current password wrong or missing=

********** HTTP PATCH */users/<id>/*

*Body*

{noformat}{
  name: string,
  username: string,
  email: string,
  password: string
  is_admin: boolean,
}{noformat}

should only update the fields given with the request and leave others alone

*Errors*

=400 if current password wrong or missing=

********** HTTP DELETE */users/<id>/*

*Errors*

=400 if trying to delete current user=
*** Comments
**** [2023-06-27 Tue 23:11] Bill Wear
:PROPERTIES:
:CommId:   268205
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-06-27 23:11:52
:END:
preliminary documentation can be found in the following:

- [[https://discourse.maas.io/t/0-5-msm-user-management-gui-based/7197][{color:#ffffff}+How to manage users via GUI+{color}]]
- [[https://discourse.maas.io/t/0-5-msm-user-management-api/7198][{color:#ffffff}How to manage users via API{color}]]
- [[https://discourse.maas.io/t/0-5-msm-user-management-internal-technical-explanation/7199][{color:#ffffff}Internal technical explanation of MSM user management{color}]]

the GUI doc was done by reviewing the [[https://app.zeplin.io/project/6462417916233d24e570b33e][Zeplin screens]] that are under development, so YMMV over time.
* TODO [#B] Site manager: Deployment architecture and Documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1649
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:17:46
:Modified: 2023-06-26 12:39:08
:Effort:   00:00
:Left:     00:00
:END:
*** Description
A spec and a setup to deploy MAAS Site Manager in production. This includes:

- Packaging/Deploying the MAAS Site Manager Connector
    - Should be deployed with snaps and debs (could be a dep wrapping a snap)
- Deploying the MAAS Site Manager Ingestion Backend
- Deploying the MAAS Site Manager user facing backend (including TLS, etc.)
- Deploying the MAAS Site Manager frontend and wiring it to the user facing backend
*** Comments
**** [2023-06-26 Mon 12:39] Thorsten Merten
:PROPERTIES:
:CommId:   266727
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-06-26 12:39:07
:END:
Please note that we discussed how we can serve map tiles in [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1645|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1645]] . However there are tons of other possibilities to make this clean(er), e.g. [[https://github.com/durkie/ngx_http_mbtiles_module|smart-link][https://github.com/durkie/ngx_http_mbtiles_module]]  via [[https://github.com/mapbox/awesome-vector-tiles#servers][awesome-vector-tiles]]
* TODO [#B] Site manager: Ingestion Backend and Connector
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1648
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:17:34
:Modified: 2023-11-21 12:39:20
:Effort:   00:00
:Left:     00:00
:END:
*** Description
After discussing the site manager requirements and architecture across the company we revisited our current approach.
We created another spec to discuss the architecture here: [[https://docs.google.com/document/d/11BhPpJfucmSwVVvDg6GFxGQiBAPAvH7D1ReqK9Gk8xg/edit#|smart-link][https://docs.google.com/document/d/11BhPpJfucmSwVVvDg6GFxGQiBAPAvH7D1ReqK9Gk8xg/edit#]]

This issue includes:

- Picking the approach discussed in the specification above
- Implementing the ingestion backend including
    - A setup for TLS/HTTPS/Production
    - All needed components (e.g. configuring nginx as a reverse proxy)
    - Using the database coming from site managers user facing backend and the tokens created there for authentication
    - Making sure that clients that are onboarded from the client site but not yet authenticated/accepted by MAAS Site maanger admins are not producing too much traffic
    - Making sure that clients that are disconnected/deleted stop sending traffic
- Implementing/updating the MAAS Site Manager Connector
    - Possibly exchanging the way the Connector sends its data (depending on the architecture)
    - Implementing a backoff solution
    - Making sure that the Connector knows when it is disconnected and stops sending traffic or even shuts down by itself
    - Making sure that MAAS is notified that it has been disconnected from MAAS Site Manager
*** Comments
* TODO [#C] Diskless booting of custom images in MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1647
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Cedric Gegout
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:16:58
:Modified: 2023-07-27 22:56:51
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Many large computational clusters use diskless booting.

This allows them to boot whole clusters from a single custom image which is then updated centrally and then rolled out again as needed.

MAAS should support the deployment of custom images to disk less servers.

We need to clearly handle the nodes reboot cycle, i.e. serve the image again if node get’s rebooted.

We need to handle the image update cycle, probably a release redeploy on a new custom image might be fine to begin with.
*** Comments
* DONE [#C] Site manager: Add map to frontend
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1645
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Thorsten Merten
:Assignee: Thorsten Merten
:Issuetype: Epic
:Created:  2023-05-10 08:14:17
:Modified: 2023-10-24 14:42:41
:Effort:   00:00
:Left:     00:00
:END:
*** Description
One use case of Site Manager is to manage sites by region. To do this in a visual way, a map should be added to the Site Manager Frontend.

- The map should be usable in an airgapped environment
    - The quality of the map may degrade but it should still be usable (e.g. showing only rudimentary country information instead of the whole OpenStreetMap zoom levels)
- The map should display all locations that have lat/lon information
    - The map should tell the user how many sites are lacking this information and direct the user how to add it
    - This may include making Sites editable
- Hovering over a site should give additional information
- Show connection state (e.g. using colors)
- Clicking on a site might redirect to a detail view
- (Bonus) There should be way to select one or many sites in the map (e.g. by “lasso”)
    - Sites could be be managed in the map (see related image provisioning issue) OR the map could redirect to a pre-filtered list view showing a list of the visual selection

******* front-end implementation

General not on the front-end implementation

Prefer bottoms-up approach and pick tasks in that order (start with small “dumb” individual components, and move up to containers and data integration last).
*** Comments
**** [2023-07-26 Wed 14:37] Peter Makowski
:PROPERTIES:
:CommId:   284195
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-07-26 14:37:21
:END:
[~accountid:63bbf101713349bea186c04c] [~accountid:62a75900bf7afc006f3aa340] [~accountid:633d97f7140ba0bf651dee6a]  added a general note on front-end implementation of map for clarity - prefer bottoms-up approach and pick tasks in that order (start with small “dumb” individual components, and move up to containers and data integration last).
* DONE [#C] UEFI HTTP/s boot - design
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1644
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Jerzy Husakowski
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:13:49
:Modified: 2023-10-13 07:50:28
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Design related to [[https://warthogs.atlassian.net/browse/PF-3169|smart-link][https://warthogs.atlassian.net/browse/PF-3169]]

The scope of this item is to create the specification for UEFI HTTP/s secure boot and break this feature down into phases and components. It does not include implementation, which is handled in the linked ticket.
*** Comments
* TODO [#C] Migrate MAAS snap services from Supervisor to pebble
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1643
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:13:41
:Modified: 2023-05-10 08:13:41
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Historically the MAAS snap used =supervisor= to allow multiple processes to be managed in the snap (prior to snapd support for multiple services). This has long been fixed by =snapd= and we should migrate to support that model.

- Move process management to snap managed pebble services
- Update documentation and debugging / troubleshooting guides
*** Comments
* TODO [#C] Faster DB queries by using SQL Alchemy Core
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1642
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Jerzy Husakowski
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:11:40
:Modified: 2023-07-28 14:37:49
:Effort:   00:00
:Left:     00:00
:END:
*** Description
This is the continuation of query performance work done in the linked spike. The scope of this item is migration to SQL Alchemy Core for MAAS data model queries with the goal of improving overall query performance to millisecond range, and improving data model consistency.
*** Comments
* TODO [#C] Rack controller in golang - Phase 2
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1641
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Jerzy Husakowski
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:11:31
:Modified: 2023-05-10 08:11:32
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Rewrite the rack controller in golang. Use MA011 as the starting point.

Goals:

- Disentangle rack & region controller. Make rack controller stateless.
- Reduce the resource footprint of the rack controller, making it possible to have it run on a ToR switch in the future. Aim to be able to run on a machine with 4GB of RAM, with a capability to deploy a hundred machines, assuming that the region controller needs to be able to deal with a scale of a ten thousand machine data centre
- Progressively transfer functionality from the current rack controller to the golang one, running both in parallel during the transition period.
- Power management: re-design in line with the points above
- Assume that scaling of the infrastructure to distribute the images is achieved elsewhere (e.g. by moving to an independently-scalable object store) and we can rely on it.
*** Comments
* TODO [#C] Set DPU to a known state between provisionings (ConnectX NIC mode)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1640
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Jerzy Husakowski
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:10:57
:Modified: 2023-05-10 08:10:57
:Effort:   00:00
:Left:     00:00
:END:
*** Description
“ConnectX NIC” mode allows the host to see the DPU like a normal network card. The host is in full control of the NIC functionality, and the ARM core is disconnected from the eswitch. This could be an option for MAAS to simplify provisioning. DPUs come in “embedded mode” from the factory, and can be switched to “ConnectX NIC” mode with a manual action.

There are four commands that switch a DPU from the embedded to NIC mode. Needs mstflint 4.20+ and DPU FW 24.33.1048+ Older FW would first need to be upgraded, which may require an extra reboot cycle. This could happen during commissioning. These commands don’t work in embedded/restricted mode, when the DPU is “locked down”. By default, the factory mode is embedded/unrestricted.

!image-20230331-101402.png|width=558,height=169!

The state change needs to be followed by a firmware reset command (no need for power cycle, but it’s necessary to soft-reboot the card).



Additional details:

- [[https://docs.google.com/document/d/1qRH_NNE_TSMET5UrtWGjf8fbzajy1L_Zk9G5OW8IDjc/edit#bookmark=id.xhuayqwfg9gk|smart-link][https://docs.google.com/document/d/1qRH_NNE_TSMET5UrtWGjf8fbzajy1L_Zk9G5OW8IDjc/edit#bookmark=id.xhuayqwfg9gk]]
- [[https://docs.nvidia.com/networking/display/BlueFieldDPUOSLatest/Modes+of+Operation|smart-link][https://docs.nvidia.com/networking/display/BlueFieldDPUOSLatest/Modes+of+Operation]]
- [[https://paste.ubuntu.com/p/5SfrFXNrBd/|smart-link][https://paste.ubuntu.com/p/5SfrFXNrBd/]]
*** Comments
* TODO [#C] MAAS O11y: Charm
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1639
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Cedric Gegout
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:10:53
:Modified: 2023-07-27 22:56:54
:Effort:   00:00
:Left:     00:00
:END:
*** Description
following on from our work on O11y with the COS team in 3.2, we should continue expanding the coverage of MAAS O11y with more failure modes, metrics, etc. Scope tbd.


DoD:

To be negotiated with the COS team:
-Charmed operator-
-Integrated and tested with COS-

- Docs that describe which metrics MAAS exposes for o11y - add human readable descriptions to [[https://maas.io/docs/how-to-monitor-maas|smart-link][https://maas.io/docs/how-to-monitor-maas]]
- Design of the next step of MAAS-COS integration: integrator operator charm that makes it easy for operator to integrate MAAS with an existing observability stack.
    - We’d need help from Simon’s team on making such an operator charm and setting up a CI pipeline for it. The O11y team has most building blocks in place, but will need to see if they have the capacity to support the MAAS team.
    - We should prepare for a push model
    - This requires documentation & development effort from the MAAS team.
*** Comments
* TODO [#C] MAAS deploy API should allow distro_series to be a number
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1637
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:09:52
:Modified: 2023-05-10 08:09:52
:Effort:   00:00
:Left:     00:00
:END:
*** Description
A request from Juju, that we allow =distro_series=22.04= instead of =distro_series=jammy= in the Machine.deploy API.

This eases Juju’s side of (not) doing translation from charmhub, and further allows Juju users to request deploys of e.g. Ubuntu that weren’t known about at the time of the Juju release.

MAAS should additionally advertise this capability in the =get_capabilities= API call such that Juju can see if the MAAS they’re talking to allows this request
*** Comments
* TODO [#C] Diskless booting of custom images in MAAS - spike
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1636
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Cedric Gegout
:Assignee:
:Issuetype: Epic
:Created:  2023-05-10 08:09:34
:Modified: 2023-09-14 12:40:31
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Many large computational clusters use diskless booting.

This allows them to boot whole clusters from a single custom image which is then updated centrally and then rolled out again as needed.

MAAS should support the deployment of custom images to disk less servers.

We need to clearly handle the nodes reboot cycle, i.e. serve the image again if node get’s rebooted.

We need to handle the image update cycle, probably a release redeploy on a new custom image might be fine to begin with.
*** Comments
* DONE [#A] Temporal in MAAS for workflows - no Twisted between rack & region
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1635
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Jerzy Husakowski
:Assignee: Anton Troyanov
:Issuetype: Epic
:Created:  2023-05-10 08:05:10
:Modified: 2023-10-30 10:44:59
:Effort:   00:00
:Left:     00:00
:END:
*** Description
Temporal is the future of how MAAS operations should be orchestrated.

For 23.10 we should start by modelling the *deployment of a machine* as a Temporal workflow

- Add Temporal API services as a child process of the Region Controller.
- Add Temporal workers to the Rack Controller.
    - Each Temporal worker on the Rack Controller will be subscribed to a queue for a VLAN that it is on.
    - There will be an additional Temporal Worker on the Rack Controller that will control the VLAN workers (e.g. subscribed to a queue telling it VLANs that a given Rack Controller can address).
    - Use the Golang SDK for implementing Temporal activities on the Rack Controller.
- The Temporal Workflow for deployment should be started /early/ in the processing of the deployment request.
    - if multiple machines are to be deployed simultaneously, a single workflow will be started which in turn spawns child workflows, one per machine.
- We will measure the amount of RPC calls that occur over [[https://docs.twisted.org/en/stable/api/twisted.protocols.amp.html][AMP]] between Region and Rack during a deployment with a goal of reducing it


By tackling deployment workflow we aim to dive in to Temporal, and identify where all the sharp edges are and have a robust understanding of the pros and cons.
*** Comments
**** [2023-05-23 Tue 13:28] Adam Collard
:PROPERTIES:
:CommId:   244294
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-05-23 13:28:30
:END:
[~accountid:62134148ba649b006aab7dfa] [~accountid:606c651e4532c90069697f10] please review the design described above
* TODO [#C] Refactor to use test util functions for immutable state
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1634
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-09 15:47:35
:Modified: 2023-11-22 15:52:06
:END:
*** Description
Ideally this should be done in the end in bulk (this should be easy to automate).

Add utility functions using immer under the hood making the state immutable and simplifying tests and reducing the number of imports.


{noformat}  const store = produceMockStore((stateDraft) => {
    stateDraft.controller.items = [controller];
  });{noformat}
*** Comments
* TODO [#C] Refactor pagination component
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1631
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-09 14:33:00
:Modified: 2023-05-09 14:33:01
:END:
*** Description
*Acceptance criteria*

- Pagination component error does not use relative/absolute position but is displayed in another row instead
*** Comments
* TODO [#C] Update documentation links
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1630
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-09 14:09:45
:Modified: 2023-05-09 14:14:14
:END:
*** Description
*Acceptance criteria*

- all instances of documentation links across MAAS Site Manager point to correct URLs
*** Comments
* TODO [#B] [Dev] Update react-router-dom to v6
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1606
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-05-02 07:22:01
:Modified: 2023-10-23 07:39:29
:END:
*** Description
[[https://github.com/canonical/maas-ui/pull/3445|smart-link][https://github.com/canonical/maas-ui/pull/3445]]
*** Comments
* TODO [#C] [Dev] Run e2e tests against maas-ui built from HEAD
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1605
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-05-01 12:20:43
:Modified: 2023-10-23 07:38:44
:END:
*** Description
playwright and cypress tests are currently running against [[https://github.com/canonical/maas-ui/blob/main/.github/workflows/playwright.yml#L23][full latest MAAS from snap]].

To get accurate e2e test results and catch issues before offending code gets merged we need to run e2e tests against MAAS UI built from a latest commit on the current branch

This will involve editing github workflow actions in the following way:

- starting a new dev server from a current branch and using it as a base url for e2e test runners
*** Comments
* TODO [#C] [Dev] maas-ui - Replace instances of react-portal with react-useportal
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1599
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-04-25 07:12:56
:Modified: 2023-04-25 07:12:56
:END:
*** Description
- Replace instances of react-portal with react-useportal
- Remove react-portal from dependencies
*** Comments
* TODO [#C] Test bootloaders and shim from Jammy
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1591
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Task
:Created:  2023-04-20 08:40:46
:Modified: 2023-04-20 08:41:50
:END:
*** Description
[[https://bugs.launchpad.net/maas/+bug/1865515][https://bugs.launchpad.net/maas/+bug/1865515]]

[[https://bugs.launchpad.net/maas/+bug/1879012][https://bugs.launchpad.net/maas/+bug/1879012]]
*** Comments
* TODO [#C] [Dev] Display machine actions failure details
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1589
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-04-20 06:55:01
:Modified: 2023-04-20 06:55:02
:END:
*** Description
The error message for bulk machine actions on the machine listing page does not currently provide the reason for the failure when a machine action is unsuccessful. We only display a list of failed machine names.

A reason for failure can be added for each machine in UI due to the changes made on the backend: [[https://bugs.launchpad.net/maas/+bug/2009045|smart-link][https://bugs.launchpad.net/maas/+bug/2009045]]

This may require some UX work to decide how we want to display that.
*** Comments
* DONE [#C] Site Manager: User facing backend MVPv1
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1290
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Thorsten Merten
:Assignee: Thorsten Merten
:Issuetype: Task
:Created:  2023-02-06 08:29:22
:Modified: 2023-05-10 06:39:54
:END:
*** Description
FastAPI!

Should this drive the data model generation or should we make this a different task?

- site, site data, users CRUD (possibly soft delete)
*** Comments
**** [2023-02-23 Thu 09:22] Thorsten Merten
:PROPERTIES:
:CommId:   192072
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-02-23 09:22:46
:END:
For now the data model is generated on application startup until we switch to albemic
*** TODO [#C] Add validation to fields
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1709
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-05-17 11:31:26
:Modified: 2023-05-31 08:53:55
:END:
**** Description
The frontend spec (see linked doc) adds some validation and lengths to fields. We should add those to the pydantic models as well
**** Comments
***** [2023-05-19 Fri 09:28] Jacopo Rota
:PROPERTIES:
:CommId:   242645
:TYPE:     ejira-comment
:Author:   Jacopo Rota
:Created:  2023-05-19 09:28:41
:Modified: 2023-05-19 09:39:11
:END:
Speaking about data integrity, should we set the lengths of fields at database level and some other validations - for example the check that the =country= is compliant with =ISO 3166 Alpha2= - at pydantic level?

Otherwise we would have =Text= columns and validators at pydantic level, but this would be suboptimal in terms of performances given that a search over =Varchar= is faster than over =Text=
***** [2023-05-31 Wed 08:53] Thorsten Merten
:PROPERTIES:
:CommId:   248768
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-05-31 08:53:55
:END:
[~accountid:712020:d243d261-496e-4ab8-bbd8-a41f94bfab6f] , yes we could change this.
IMO there is no holy grail. I remember in our Django Rest project that we had validations all over the place as some can be done on the DB and others don’t and so you end up with a mix of both, trying to keep them consistent in various ways.
That said from a performance perspective changing this makes sense and from a maintainability perspective it is a little harder.
I remember that [~accountid:70121:01ef6e96-df1a-4807-b371-05fe067d0f61] did refactor to =text=. What was the reason for that and do you have any thoughts on this?
*** TODO [#C] Add certificate information endpoint
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1674
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-05-11 07:29:06
:Modified: 2023-05-17 11:50:17
:END:
**** Description
The token view in the frontend currently shows information about the server certificate. We need to create an endpoint that provides this information.

- We can start with an endpoint that delivers some mock data for development setups (e.g. when connecting via =http=)
- However, we need to find a way to provide information about the certificate (which is usually not handled by the backend but by some kind of nginx/LB/… in front of the backend)

This might be related to the production setup instructions and we might need to be opinionated about some things.
**** Comments
***** [2023-05-17 Wed 11:50] Thorsten Merten
:PROPERTIES:
:CommId:   241455
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-05-17 11:50:17
:END:
TDB if this can be more easily grabbed from the browser/connection on the frontend side
** [#C] As a MAAS user, I want to be able to upload scripts that will be executed during the machine release life cycle
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2294
:TYPE:     ejira-story
:Status:   Done
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Story
:Created:  2023-10-18 21:43:08
:Modified: 2023-10-31 14:47:20
:END:
*** Description
*** Comments
** [#A] Promote Images to stable
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2283
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters
:Issuetype: Task
:Created:  2023-10-17 12:30:27
:Modified: 2023-11-28 16:33:14
:END:
*** Description
It’s been a while since the last round of image promotion, and customers are getting antsy. We need to promote some more ASAP
*** Comments
** [#C] [Dev] Side navigation - add bottom link items
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1544
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Peter Makowski
:Assignee: Nick De Villiers
:Issuetype: Task
:Created:  2023-04-12 08:56:01
:Modified: 2023-04-20 14:10:31
:END:
*** Description
- Add links to the bottom section of the side navigation.
- Add keys to docsUrls.ts file and use them as values for the links.
- Use actual links where there are known, and empty string otherwise (you may need to ask people around to figure out what should be used)

!Screenshot 2023-04-12 at 10.52.40-20230412-085317.png|width=140,height=650!
*** Comments
** [#C] MAAS Site Manager Initial QA
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1543
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Peter Makowski
:Assignee: Maximilian Blazek
:Issuetype: Task
:Created:  2023-04-11 11:11:43
:Modified: 2023-05-10 11:49:37
:END:
*** Description
MAAS Site Manager Initial QA using mock data

1. Pull and setup the repository using instructions in [[https://code.launchpad.net/maas-site-manager][https://code.launchpad.net/maas-site-manager]]
2. Run =cd frontend= and =yarn dev=to start the front-end
3. Open your browser and navigate to [[http://localhost:8405/][http://localhost:8405/]]
4. Login using credentials: =admin= =test= or (if using real back-end) =admin@example.com= =admin=
*** Comments
** [#C] FOCUS-3.4 : Feature Overiews, Comp User Supt for MAAS 3.4 :ejira_assigned:
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1321
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Bill Wear
:Assignee: Bill Wear
:Issuetype: Task
:Created:  2023-02-08 00:09:48
:Modified: 2023-07-17 15:36:24
:Left:     00:00
:END:
*** Description
FOCUS-3.4: Feature Overview and Comprehensive User Support for MAAS 3.4 Documentation

This MAAS 3.4 feature documentation task aims to deliver comprehensive documentation for both internal and external features. It provides technical descriptions, configuration instructions, and examples to assist users and internal developers.
*** Comments
**** [2023-03-16 Thu 23:10] Bill Wear
:PROPERTIES:
:CommId:   204073
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-03-16 23:10:51
:END:
Began adding new 3.4 layout how-to instructions in “How to connect MAAS networks” (separate tab, commented out for now)
**** [2023-07-05 Wed 17:38] Bill Wear
:PROPERTIES:
:CommId:   273220
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 17:38:43
:END:
****** Rough acceptance criteria

1. *Feature Overview*: The feature is clearly explained at a high level, including its purpose, importance, and the context in which it fits in the software. The description provides enough information for users to understand why this feature matters.
2. *Identify Audience*: The primary audience for the feature is correctly identified and documented, influencing the depth and complexity of the documentation content.
3. *Technical Specifications*: The feature's technical specifications, including system requirements, dependencies, and any limitations, are fully detailed and easy to understand.
4. *Usage Instructions*: Step-by-step instructions on how to use the feature are provided and are clear and easy to follow. All crucial aspects of feature usage are covered.
5. *Configuration Instructions*: Clear instructions on how to configure or customize the feature are provided. The instructions should be sufficient for users to tailor the feature to their needs.
6. *Provide Examples*: Real-world examples of the feature's usage are provided, based on common user scenarios. The examples should be practical and help users understand how to use the feature effectively.
7. *Troubleshooting Guide*: A troubleshooting guide is included that covers common issues or problems users might encounter when using the feature. The guide is comprehensive and provides practical solutions to problems.
8. *Internal Documentation*: For internal developers, detailed technical documentation is provided that explains the architecture, data flow, and codebase associated with the feature.
9. *Integration Information*: The documentation details how the feature integrates with other features or services. It includes clear explanations of how users can leverage the feature in conjunction with others for enhanced functionality.
10. *Version Management*: Clear information on how updates and changes to the feature will be managed is provided, including details on accessing and installing updates, the schedule for new releases, and maintaining compatibility with other features or services.
**** [2023-07-05 Wed 18:14] Bill Wear
:PROPERTIES:
:CommId:   273249
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:14:10
:END:
****** Plan for checklist step 1:

********* Feature Overview: Start with a high-level overview of the features, highlighting its purpose and importance. This helps users understand why this feature matters and how it fits into the broader context of the software.

1. *Redesigned UI*:
    - *Feature Overview*: Begin by describing the changes to the UI, including the navigation shift from the top to the left side of the screen, and the introduction of discreet pop-up boxes for navigation within panels. Highlight the benefits of these changes, such as improved compactness and comprehensiveness, as well as user orientation preservation.
    - *Importance*: Explain why these changes matter by showing how they enhance user experience and make it easier for users to navigate the software.
2. *Configurable Session Timeout*:
    - *Feature Overview*: Describe the ability for users to fully configure their session timeouts. Discuss the details of this feature and its settings.
    - *Importance*: Discuss the flexibility this gives users and how it can improve their interaction with the software, such as not having to log in repeatedly within short time spans or the ability to ensure security by setting short session times.
3. *Ansible HA PostgreSQL Playbook Enhancements*:
    - *Feature Overview*: Explain the enhancement to the Ansible playbook, allowing a full HA setup for PostgreSQL. Provide technical details to demonstrate its implementation.
    - *Importance*: Elaborate on the significance of this feature, such as improved system resilience, less downtime, and the ability to manage heavy traffic.
4. *Ansible Observability Playbook*:
    - *Feature Overview*: Talk about the introduction of the Ansible observability playbook that allows users to configure O11y with Ansible. Describe the process and the steps involved.
    - *Importance*: Stress the advantage of this feature by showing how it simplifies observability configuration and the benefits that brings to users and developers.
5. *Allow Sorting Images by Last Deployed*:
    - *Feature Overview*: Describe this new feature, explaining that users can now sort their images based on when they were last deployed. Give a brief walkthrough on how to use this feature.
    - *Importance*: Discuss how this feature can help users quickly access and manage recently used images, improving workflow efficiency.
6. *Packer MAAS - SLES*:
    - *Feature Overview*: Introduce the new support for SLES in Packer. Mention any notable details or procedures related to this addition. Also, include the improvements made on RHEL.
    - *Importance*: Highlight the benefits of this expanded support, such as broadening the capabilities of MAAS and offering users more options.
**** [2023-07-05 Wed 18:14] Bill Wear
:PROPERTIES:
:CommId:   273250
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:14:53
:Modified: 2023-07-05 19:04:54
:END:
****** Draft for “Redesigned UI”

With the new MAAS 3.4 release, we've made some significant  user-interface changes to improve user experience. A key transformation? We’ve shifted navigation from the top to the left side of the screen. This placement better uses space and presents a more logical workflow, making it easy for users to find and access the features they need. We've also introduced discreet pop-up boxes that manage panel navigation. These boxes emerge only when needed to maintain focus, creating a more compact and comprehensive interface. Revamping the UI should make MAAS 3.4 more user-friendly and intuitive. Shifting navigation to the left matches a common user-design pattern. Likewise, the introduction of discreet pop-up boxes maintains your orientation and minimizes clutter making it easier to navigate the software.
**** [2023-07-05 Wed 18:16] Bill Wear
:PROPERTIES:
:CommId:   273251
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:16:19
:Modified: 2023-07-05 19:06:36
:END:
****** Draft for “Configurable session timeout”

In MAAS 3.4, we've introduced the Configurable Session Timeout feature, offering better control over session length. This feature allows you to set a personalized duration for your sessions, hopefully avoiding abrupt disconnections or lingering sessions.  If you're a user who has login repeatedly, due to short session defaults, or you're concerned about leaving your session accessible for too long, setting a custom timeout is useful and potentially more secure.
**** [2023-07-05 Wed 18:19] Bill Wear
:PROPERTIES:
:CommId:   273253
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:19:06
:Modified: 2023-07-05 19:09:09
:END:
****** Draft for “*Ansible HA PostgreSQL Playbook Enhancements*”

With the latest iteration of MAAS 3.4, we have made significant enhancements to the Ansible playbook, enabling a full High Availability (HA) setup for PostgreSQL. Users can now configure a PostgreSQL cluster with failover and redundancy capabilities directly through the Ansible playbook. This streamlined method incorporates tools such as PAF, corosync, and pacemaker.  With PostgreSQL HA enabled, traffic will automatically redirect to a standby database. This can significantly improve system load balancing.
**** [2023-07-05 Wed 18:23] Bill Wear
:PROPERTIES:
:CommId:   273257
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:23:41
:Modified: 2023-07-05 19:14:38
:END:
****** Draft for “*Ansible Observability Playbook*”

In MAAS 3.4, we've introduced an Ansible Observability (O11y) playbook, allowing users to configure O11y using Ansible. This playbook configures metrics collection, log management, and other key O11y features. Users can easily deploy and manage observability.  Ansible also enables version control for configurations, making it easier to track changes and roll back if necessary.
**** [2023-07-05 Wed 18:25] Bill Wear
:PROPERTIES:
:CommId:   273259
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:25:57
:Modified: 2023-07-05 19:18:50
:END:
****** Draft for “*Allow Sorting Images by Last Deployed*”

The MAAS 3.4 release introduces the feature of sorting images by deployment time.  Users can now view their images in a sorted order, with the most recently deployed images appearing at the top of the list. To utilize this feature, users simply need to navigate to the 'Images' section of the software, where they will find a new sorting option - 'Last Deployed'. Selecting this option rearranges the list of images, placing those most recently deployed at the top.  This feature allows users to quickly identify recently deployed images, and to sort and prioritize images based on deployment.
**** [2023-07-05 Wed 18:27] Bill Wear
:PROPERTIES:
:CommId:   273260
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-05 18:27:23
:Modified: 2023-07-05 19:43:31
:END:
****** Draft for “Packer MAAS - SLES”

The MAAS 3.4 release expands Packer support to include SUSE Linux Enterprise Server (SLES), expanding the the list of deployable Linux distributions.  We also support openSUSE and openSUSE Tumbleweed. And we’ve added a template for Red Hat Enterprise Linux (RHEL) version 9.
**** [2023-07-06 Thu 13:37] Bill Wear
:PROPERTIES:
:CommId:   273751
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-06 13:37:21
:Modified: 2023-07-06 17:10:44
:END:
****** Plan for checklist step 2

Identify Audience: Identify the primary audience for this feature. This could include internal developers, external users, or both. This will guide the depth and complexity of the content that needs to be included in the documentation.

1. ✅ Gather information about the feature: Gain a comprehensive understanding of the feature being documented. Review technical specifications, design documents, or any other relevant resources that provide insights into the purpose, functionality, and intended use of the feature.
2. ✅ Consult with stakeholders: Engage in discussions with project managers, product owners, developers, and other stakeholders involved in the development and implementation of the feature. Gather their perspectives on the target audience and their expectations regarding the documentation. Identify any specific requirements or considerations that need to be addressed.
3. ✅ Analyze user personas: Create or review existing user personas, which represent typical users or user groups for the feature. User personas help in identifying the characteristics, goals, and needs of the audience. Consider factors such as their technical expertise, familiarity with the product or domain, and their specific roles or responsibilities.
4. ✅ Analyze user support data: Review discourse inquiries related to similar features or functionalities. Look for recurring themes or common questions that indicate the information users frequently seek when using such features. This can give us insights into the pain points and knowledge gaps experienced by the target audience.
5. ❌ Consider internal developer needs: If the feature is primarily aimed at internal developers, collaborate with the development team to understand their requirements. Identify the specific technical information, code examples, or integration details that are relevant to their work. Assess their level of familiarity with the technology stack, frameworks, or programming languages involved.
6. ✅ Define the primary audience: Based on the gathered information, define the primary audience for the feature documentation. This could be internal developers, external users, or a combination of both. Consider any subgroups or personas within the primary audience that may have distinct requirements or expertise levels.
7. ✅ Document audience characteristics: Create a profile or summary that outlines the primary audience characteristics. This should include information such as their technical proficiency, familiarity with the product, domain knowledge, and any specific roles or responsibilities relevant to using the feature.
8. ✅ Determine documentation depth and complexity: Based on the identified audience, determine the appropriate level of depth and complexity for the documentation content. Consider the audience's technical expertise, prior knowledge of the product, and the scope of information required to effectively understand and utilize the feature. This will guide decisions regarding the level of detail, terminology, code examples, and any prerequisite knowledge assumed in the documentation.
9. ✅ Document audience requirements: Document the specific requirements and expectations of the identified audience regarding the feature documentation. This will serve as a reference point for content creation and ensure that the documentation addresses their needs effectively.
**** [2023-07-06 Thu 13:40] Bill Wear
:PROPERTIES:
:CommId:   273753
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-06 13:40:41
:Modified: 2023-07-06 17:10:14
:END:
****** Technical info re: features

******* Redesigned UI

/(Primary audience: MAAS users and operators who primarily use the UI)/

******** Internal features (targeted at 3.5)

The redesigned UI aims to restructure the MAAS UI App to eliminate the need for a temporary workaround using React Portal. The current structure of the application involves rendering the Sidebar within the 'l-aside' element, which is nested within a legacy header component tree and rendered outside it using React Portal. The goal is to restructure the React component tree to eliminate the need for React Portal while maintaining existing functionality. Hence the primary purpose of this activity is internal to the engineering team.

The proposed solution refactors the MainContentSection into a new component called PageContent. The PageContent component renders the main and side panel elements, replacing the existing structure. The side panel props have been moved from the ComponentHeader (e.g., MachineListHeader) to the main page component (e.g., Machines), ensuring better component organization.

Overall, the proposed solution provides a clear plan for restructuring the MAAS UI App and removing the need for the temporary React Portal workaround. It aims to enhance the component organization and maintain compatibility with the existing functionality. The proposed solution appears feasible and is likely to improve the code structure and maintainability of the application.

******** External features

The MAAS UI New Layout brings several user benefits and improvements to the MAAS UI App, centered around the following enhancements:

1. Hide/Show Columns on the Machine List: With the refactored layout, users now have the ability to customize the visibility of columns on the machine list. This allows them to focus on the specific information they need and hide irrelevant columns, improving readability and reducing clutter.
2. Move Action Forms from Header to Side Panel: Previously, the action forms were located in the header section, making it less intuitive for users to access and interact with them. With the new layout, the action forms have been moved to the side panel, providing a more logical placement and easy access to perform actions on machines.
3. New Action Button Group for Machines: The introduction of a new action button group eliminates the need for the previous "Take action" menu. Users can now directly access commonly used actions for machines, both in the details view and the machine list. This streamlines the workflow and simplifies the process of performing actions on machines.
4. New Side Navigation and Secondary Side Navigation for Settings and Account: The refactoring effort includes the implementation of a new side navigation system. Users can navigate through different sections of the app, including the settings and account pages, using the side panel. The addition of a secondary side navigation specifically for settings and account pages further enhances the organization and accessibility of these sections.

These improvements contribute to a more efficient and user-friendly interface in the MAAS UI App. Users can easily customize their view, access action forms conveniently, and navigate through the application seamlessly. The refactoring effort also improves the maintainability and extensibility of the codebase, ensuring smoother updates and faster delivery of new features. Overall, the MAAS UI New Layout Side Panels Refactoring feature enhances the user experience and empowers users to accomplish their tasks effectively within the MAAS UI App.

******** User stories considered

Table interaction: One of the biggest problems when users are interacting with the table component is that we fixed the number of columns on the table. When interacting with MAAS UI, the users don’t always use the standard screen size that we design. They sometimes have a tiling management tool to set their views and some columns our users care more about than the other. So we introduce the modular table into this specification to allow users to customise their views to things that they really care about.

Form interaction: The current way we interact with forms in MAAS is to have a slide down panel from the header component. Over time, the form grows and it leaves very little space to see e.g. the machine list as a reference. Creating a very uncomfortable interaction, especially when scrolling down. Therefore, we need a way to redesign our forms to scale as the content scales. With that said, our Vanilla design library has proposed a panel component to solve this problem. Instead of focusing on the middle aligned slide down form, we will migrate all forms into panels.

Efficient navigation: The current navigation interaction in MAAS is designed to be on the top part of the page. This is not easy to scale when there are more items in the navigation. Plus, when there are multiple levels, the navigation can be somewhat hard to scale and understand how to go from one place to another.  From our previous research we’ve also discovered that the Subnets tab and DNS tabs are not as informative in regards to why they are split into two tabs. In our users’ understanding, functionalities that involve subnets or DNS are constituted as Networking functionalities because our documentation also explains this concept as a whole concept.

Efficient search: The current “take action” icon is placed really far away from the interaction point. This can cause delay and disengagement in the interaction. We discovered that our users with huge MAAS environments would not really remember their machine name but they would name their machines with a convention coupled with tags. This is so they can search for the list of machines they are looking for and take actions.  There are 2 problems in this scenario. The search that we offer is not efficient enough for our users because our compound search language is hard to understand and it is hard to put together a query that makes sense. Secondly, when nothing is selected in the table, the “take action” button is disabled without feedback. This is not a very good experience considering the interaction point and the feedback that the UI provides.

******** User feedback in Discourse

********* Australian National Supercomputer Center

Example of a filter workflow, waiting >5 seconds after each change (which used to be instantaneous so I guess <0.1s or so):

type ‘compute’ in the search field, intending to display all machines containing the name compute.

Add -r6 so it shows ‘compute-r6’.

Click Filters, Status, Deployed, click off the menu.

Further filtering gives slightly different behaviour

Filtering by network fabric seems a bit quicker (perhaps 3 seconds), but only on adding it, not removing it which makes me think it’s related to the number of machines in the filter result.

Filtering by KVM (host) is similar to the above, although I think I’ve found another bug (able-sheep, able-toad, able-yak, above-insect… showing instead of our hypervisors) - would you like details of that here, another Discourse post, or Launchpad?

Machine creation is via CLI in a script.

maas "$MAAS_USER" pod compose "$POD_ID" cores="$CORES" nivrxmqbdbwuryfdebnzkxouuhepiqwo

      memory="$MEMORY" storage=local:"$STORAGE" hostname="$HOSTNAME"

1 - Filter doesn’t see new machine

In web UI, type ‘test-vm’ in Search filter field, see machines named test-vm-0{1…4} all in Deployed state

In shell, create VM as above, called test-vm-05

Web UI does not show the machine, nor the Commissioning category header

2 - Filter doesn’t quite properly see a machine deleted

********* Latitude.sh, bare-metal provisioning service company

I’m having a slow to open the machine’s information on MaaS 2.8. It is getting around 50 seconds to open the machine page.

I did create another region to check if the issue is in the UI, but I got the same issue with another region.

These stats after upgrade from 2.7 to 2.8, I"m not sure if the issue is in the database, or maybe due to the number of servers that I’m managing with maas (2k).

The dashboard looks good to load the server numbers, but when I click to open a server it delays around 50 seconds to open.

I would like to know if someone has the same issue. I’m looking to upgrade to version 2.9 but I"m not sure if it will fix this slow.

******** Longitude Engineering, mid-size engineering services firm

I am having an issue whereby the Web UI hangs on loading indefinatly.

It was working fine a couple of days ago, but no does not. Last thing i tried succsesfully was to deploy a machine. I have tried removing the snap package and reinstalling with the same result.

Any help on troubleshooting would be most appreciated.

******* Configurable session timeout

/(Primary audience: MAAS users and operators who primarily use the UI)/

The Configurable Session Timeout feature brings several user benefits that enhance security and flexibility within the MAAS UI.  Admins now have the ability to configure user session expiration time, providing them with greater control over their login sessions. By allowing customization of the session timeout, MAAS UI admin users can comply with security requirements specific to their environment.

The flexibility of the Configurable Session Timeout feature caters to diverse scenarios. Users no longer need to worry about losing unsaved data due to excessively short timeouts, as admins can adjust the session expiration time to meet their needs. Additionally, longer timeouts can be chosen in low-risk environments where prolonged sessions are acceptable.

The enhanced security aspect of this feature is also crucial. Admins can set shorter timeouts to act as a safety net against unauthorized access when leaving their workstation unattended. By providing the ability to define session expiration times, the MAAS UI empowers users to adapt the product to their specific security needs, striking a balance between usability and protecting sensitive data.

The inclusion of a default session timeout of two weeks ensures a reasonable level of convenience for users while maintaining a secure environment. Administrators can easily configure the session timeout via the Settings page, while the option to modify the timeout through the CLI adds flexibility and accessibility for advanced users.

Overall, the Configurable Session Timeout feature enhances control, security, and convenience within the MAAS UI. Admins can tailor user session expiration time to match their specific requirements, ensuring a productive and secure experience while using the platform.

******** User story considered

As a MAAS UI admin user, I want to configure the UI session expiration timeout, so I can comply with security requirements.

******* Ansible HA PostgreSQL Playbook Enhancements

/(Primary audience: MAAS admins who monitor and configure MAAS via the command line.)/

******** Spec insights

The Ansible Playbooks Automated HA Failover for Postgres feature spec outlines the need to automate the failover process for Postgres within the MAAS Ansible Playbooks. Currently, failover is done manually, and this specification aims to replace it with automated mechanisms for improved availability.

The proposed solution involves utilizing Corosync and Pacemaker to manage failure detection and election. The Postgres Ansible roles will be refactored to remove the distinction between "primary" and "secondary" roles, instead using an Ansible Fact to track the primary status. The HAProxy Postgres proxy will be split into its own role to provide flexibility in managing the cluster topology and ensure continuous connectivity for region controllers.

By automating the failover process using Corosync and Pacemaker, MAAS operators will experience reduced operational overhead and increased availability of MAAS deployments. The ability to automatically failover to a secondary Postgres instance ensures continuous operation in the event of a primary failure. The refactoring of roles and utilization of Ansible Facts improves the flexibility and scalability of the deployment.

The work items for this feature include creating roles for Corosync and Pacemaker, refactoring the Postgres roles, adding the PAF resource agent, and modifying the region controller playbook. Additionally, the HAProxy role will be split to accommodate Postgres proxying and detect primary changes.

The feature enables MAAS operators to deploy HA configurations with automated failover for Postgres through Ansible Playbooks. The playbooks ensure that Postgres instances are installed in standby mode, and Pacemaker and Corosync handle the clustering and failover processes. In scenarios where only a single Postgres instance is deployed, it functions as the primary without the need for Pacemaker and Corosync.

The proposed changes to the Ansible Playbooks and the addition of the HAProxy Postgres proxy role contribute to a more robust and highly available MAAS stack. The feature spec includes testing scenarios to validate failover functionality and emphasizes the importance of documentation to guide users in implementing automated HA failover for PostgreSQL using Ansible playbooks.

Overall, the Ansible Playbooks Automated HA Failover for Postgres feature enhances the reliability and availability of MAAS deployments. It streamlines the failover process, improves flexibility, and provides a solid foundation for building high-performance and resilient infrastructures using MAAS.

******** Functional details

Pacemaker and Corosync play key roles in fulfilling the specification for automated HA failover for Postgres within the MAAS Ansible Playbooks. These two components work together to provide the necessary mechanisms for detecting failures and electing a new primary instance.

Corosync acts as the messaging layer that enables communication among the nodes in the cluster. It establishes a reliable and fault-tolerant network connection, allowing the nodes to exchange heartbeat messages and monitor each other's health. Corosync is responsible for detecting failures, such as when the primary Postgres instance goes down, and notifying Pacemaker to initiate the failover process.

Pacemaker, on the other hand, serves as the cluster resource manager. It makes use of the information received from Corosync to determine the state of the cluster and manage the failover of resources, including the primary role for Postgres. When Pacemaker detects a failure or a change in the cluster's status, it coordinates the election of a new primary instance based on predefined rules and policies. This ensures that the cluster can continue functioning seamlessly even in the event of a primary failure.

In the context of the MAAS Ansible Playbooks, the roles for Corosync and Pacemaker will be created to enable their deployment and configuration. These roles will be responsible for setting up and maintaining the Corosync and Pacemaker infrastructure, respectively. They will ensure that the necessary configurations and dependencies are in place to support the automated failover process.

By leveraging Corosync and Pacemaker, the Ansible Playbooks will be able to automate the failover of Postgres within the MAAS stack. This means that when a primary Postgres instance fails, Pacemaker will detect the failure through Corosync and initiate the election of a new primary. The Ansible Playbooks, utilizing the refactored Postgres roles, will be aware of the primary status based on the Ansible Fact and adjust their operations accordingly.

Overall, the combination of Pacemaker and Corosync provides the foundation for implementing automated failover for Postgres. They ensure that the cluster remains highly available, continuously monitoring the health of the nodes and orchestrating the failover process to maintain uninterrupted service.

******** User view & benefits

The automated HA failover for Postgres feature brings several user benefits and improves the overall experience and reliability of the MAAS platform.

First and foremost, users can rely on the automated failover mechanism to ensure continuous availability of their Postgres database. In the event of a primary instance failure, the feature seamlessly transitions to a secondary instance, minimizing downtime and avoiding disruptions to critical operations. This ensures that users can access their data and continue their work without any interruptions caused by database failures.

The automated failover feature also enhances the reliability and stability of the MAAS platform. By leveraging Pacemaker and Corosync, the failover process is orchestrated in a controlled and efficient manner. Users no longer need to manually intervene or perform complex recovery procedures when a primary instance goes down. The system takes care of the failover process transparently, allowing users to focus on their tasks without worrying about the underlying infrastructure.

Furthermore, the feature contributes to improved data integrity and consistency. The automated failover mechanism ensures that data remains accessible and up-to-date, even in the face of primary instance failures. Users can be confident that their data is replicated and synchronized between primary and secondary instances, minimizing the risk of data loss and maintaining data consistency across the cluster.

The automated failover for Postgres also simplifies administration and reduces operational overhead. With the failover process automated, system administrators can allocate their time and resources to other critical tasks, rather than manually managing and recovering from database failures. This streamlines maintenance operations, enhances efficiency, and allows administrators to focus on strategic activities that drive the success of the MAAS platform.

Overall, the user view of this feature is highly positive. Users benefit from enhanced availability, improved reliability, and simplified administration. The automated failover for Postgres ensures uninterrupted access to data, minimizes downtime, and contributes to a seamless and resilient user experience within the MAAS platform.

******** User stories considered

As a MAAS operator, I want PostgreSQL deployed such that it will automatically fail over to a secondary in the event of a failure on the primary. When deploying MAAS via Ansible, the PostgreSQL role should be able to automatically failover to a secondary. This will be accomplished by having Corosync and Pacemaker manage the clustering of PostgreSQL. When a primary fails Pacemaker detects this and Corosync will elect a new primary. From an Ansible perspective, there can no longer be a static role for primary or secondary due to the possibility of a primary no longer being a primary after failover. Instead, which host is primary and which hosts are secondary will be tracked as an Ansible fact.

As a MAAS operator, I want my region controllers to remain connected to the primary at all times, regardless of failover. When a failover occurs, a new primary Postgres is elected. This would mean when connecting directly from a region controller to a Postgres, the connection would be terminated.  There already exists a HAProxy role for proxying multiple controllers and optionally proxying Postgres. This role can be modified such that the Postgres proxying is split out into its own role, allowing users to easily control the topology of the cluster while ensuring the region controllers remain connected.

******* Ansible Observability Playbook

/(Primary audience: MAAS admins who monitor and configure MAAS via the command line.)/

The Ansible playbooks for MAAS O11y (Observability) introduce several user-centric features that enhance the monitoring capabilities of the MAAS platform, ensuring its efficient and reliable operation.

One key user benefit is the ability to run a single grafana-agent per host managed with Ansible. The grafana-agent facilitates the collection and transmission of metrics and logs to the Prometheus and Loki services, respectively. By using a single agent per host, users can simplify their configuration management, reducing the complexity of managing multiple agents. This approach also improves security by minimizing inbound connections. The Ansible playbooks provide a flexible template that combines all metric and log sources into a single agent configuration file, simplifying administration and promoting consistency across hosts.

The O11y playbooks also enable the export of metrics from MAAS Region and Rack controllers. By setting the Prometheus endpoint and running the playbooks, hosts running Region and Rack controllers install and configure the grafana agent accordingly. This allows users to monitor server metrics from all MAAS controllers, including both process metrics (e.g., CPU and memory usage) and cluster metrics derived from the database. The ability to export these metrics ensures users have visibility into the performance and health of their MAAS controllers, enabling proactive monitoring and troubleshooting.

In addition to metrics, the playbooks facilitate the export of logs from MAAS controllers. By setting the Loki endpoint and running the playbooks, hosts running Region and Rack controllers install and configure the grafana agent to export logs to Loki. This feature provides users with centralized access to logs from multiple sources, such as audit logs, console logs, and various MAAS component logs. Having logs in a unified location simplifies troubleshooting and analysis, allowing operators to quickly identify and resolve issues.

Furthermore, the playbooks support the export of metrics and logs from the PostgreSQL database installed by Ansible. By setting the Prometheus and Loki endpoints, users can export PostgreSQL metrics to Prometheus and logs to Loki. This feature enables monitoring and analysis of database performance, ensuring optimal operation and timely detection of potential issues.

Overall, the O11y playbooks significantly enhance the monitoring and observability capabilities of the MAAS platform. Users can leverage the power of Grafana, Prometheus, and Loki to gain insights into the performance, availability, and health of their MAAS controllers and PostgreSQL database. These features empower operators to proactively manage and optimize their MAAS deployments, enabling efficient troubleshooting, capacity planning, and performance tuning.

******** User stories considered

As an operator, I want to run a single grafana-agent per host managed with Ansible. The grafana-agent is a service that pushes metrics and logs to Prometheus and Loki services respectively. Prometheus is a pull-service, so this agent is specially useful when inbound connections are a security issue. It also simplifies the configuration management by creating a single point where the remote endpoints need to be set.

As an operator, I want to export metrics from all MAAS Region controllers installed by Ansible. MAAS region controllers expose two types of metrics: process and cluster. Process metrics are performance metrics (e.g. CPU and memory usage), and are individual to each instance. Cluster metrics are derived from the data stored in the database, so all controllers should report the same data.

As an operator, I want to export metrics from all MAAS Rack controllers installed by Ansible. By setting the Prometheus endpoint and running this playbook, all hosts running Rack controllers (maas_rack_controller) should install and configure a grafana agent as described in MAAS docs.

As an operator, I want to export logs from all MAAS Region controllers installed by Ansible. By setting the Loki endpoint and running this playbook, all hosts running Region controllers should install and configure a grafana agent to export logs to Loki, as described in MAAS docs.

As an operator, I want to export logs from all MAAS Rack controllers installed by Ansible. By setting the Loki endpoint and running this playbook, all hosts running Rack controllers should install and configure a grafana agent to export logs to Loki, as described in MAAS docs.

As an operator, I want to export metrics from the PostgreSQL database installed by Ansible. By setting the Prometheus endpoint and running this playbook, PostgreSQL metrics should be exported to Prometheus.

As an operator, I want to export logs from the PostgreSQL database installed by Ansible. By setting the Loki endpoint and running this playbook, PostgreSQL logs should be exported to Loki.

As an operator, I want to install alert rules in my existing observability stack. In scenarios where the organisation already has an observability stack running, the operator should be able to configure their Prometheus and Loki instances to fire alerts on MAAS events. As the stack is not managed by this Ansible playbook, we cannot do this automatically but we should facilitate doing it.

As an operator, I want to export metrics from the Pacemaker and Corosync services installed by Ansible. By setting the Prometheus endpoint and running this playbook, the HA Cluster exporter [9] should be installed and configured to collect Pacemaker and Corosync metrics. A grafana-agent should be used to send metrics to Prometheus.

As an operator, I want to export logs from the PAF, Pacemaker and Corosync services installed by Ansible. By setting the Loki endpoint and running this playbook, a grafana-agent should be installed and configured in this node to send PAF, Pacemaker and Corosync logs to Loki.

******** Associated technical specs

There are some tables of metrics that must be prepared for this documentation; these are addressed in [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1942|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1942]] .

******* Allow Sorting Images by Last Deployed

/(Primary audience: MAAS users and operators who primarily use the UI)/

This feature is currently not working and will be commented out until such time as it is functional.

******* Packer MAAS - SLES

/(Primary audience: MAAS admins who monitor and configure MAAS via the command line.)/

The MAAS 3.4 release expands Packer support to include SUSE Linux Enterprise Server (SLES), expanding the the list of deployable Linux distributions. We also support openSUSE and openSUSE Tumbleweed. And we’ve added a template for Red Hat Enterprise Linux (RHEL) version 9.

******** Associated technical specifications

[~accountid:6090064f70d1d1006f5a8dbd] is working on documenting these as part of the repository.

****** Primary audience

The primary audiences / beneficiaries for the features in this release are:

- MAAS users and operators who primarily use the UI.
    - These individuals interact with MAAS through the user interface (UI) to perform various tasks and operations.
    - They rely on the UI for managing and provisioning resources, monitoring system status, and accessing essential features and functionalities.
    - The features introduced in this release aim to enhance the usability, efficiency, and overall user experience for this audience.
    - By improving the UI layout, navigation, and task-specific tools, MAAS users and operators can easily navigate the interface, access relevant information, and perform their tasks more effectively.
- MAAS admins who monitor and configure MAAS peripheral elements via the command line.
    - These admins are responsible for managing and configuring peripheral elements of the MAAS infrastructure using the command-line interface (CLI).
    - They utilize the CLI for tasks such as configuring network settings, managing storage, setting up DHCP, and performing other administrative functions.
    - While the primary focus of this release may be on UI enhancements, it is important to consider the needs of CLI users as well.
    - The features introduced in this release should maintain CLI compatibility and ensure that admins can continue to monitor and configure peripheral elements effectively through the command line.

****** Documentation depth and complexity

For MAAS users and operators who primarily use the UI:

- Documentation Level: The documentation for this audience should aim for a user-friendly and accessible approach. It should provide clear step-by-step instructions, intuitive explanations, and visual aids to help users understand and utilize the features effectively.
- Complexity: Since this audience relies on the UI for their tasks, the documentation should focus on practical guidance rather than technical intricacies. It should avoid excessive technical jargon and assume limited prior knowledge of the product. However, it should cover all the necessary information required to perform tasks successfully, including relevant UI elements, button labels, and navigation instructions.
- Detail: The documentation should provide sufficient detail to guide users through each feature's usage, emphasizing common use cases and best practices. It should include screenshots or illustrations to visually assist users in understanding the UI elements and workflows.
- Terminology: Use terminology that aligns with the language and concepts familiar to the UI users. Avoid excessive technical terms or provide clear definitions when using specialized terminology.
- Code Examples: Since UI users may not engage directly with code, code examples may not be as relevant for this audience. However, if any custom configurations or advanced settings require code modifications, provide simplified snippets with clear instructions.

For MAAS admins who use the command line:

- Documentation Level: The documentation for this audience should cater to their technical expertise and prior knowledge of the product. It should provide more in-depth explanations, technical details, and advanced configuration options specific to the command-line interface (CLI).
- Complexity: As CLI users are typically more technically proficient, the documentation can delve into more advanced concepts and assume a certain level of familiarity with the product. It should cover the intricacies of peripheral configurations, command syntax, and provide troubleshooting guidance.
- Detail: The documentation should include comprehensive command references, covering all available options and parameters. It should provide examples of complex command sequences and workflows, addressing specific scenarios that CLI users may encounter.
- Terminology: Use industry-standard terminology and command-line conventions familiar to CLI users. Provide explanations of any specialized terminology specific to MAAS or the CLI, ensuring clarity and understanding.
- Code Examples: CLI users often rely on code examples to understand configuration files, command sequences, or automation scripts. Include relevant code snippets, configuration file templates, and examples that demonstrate advanced CLI usage.

*****
**** [2023-07-06 Thu 16:45] Bill Wear
:PROPERTIES:
:CommId:   273887
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2023-07-06 16:45:21
:END:
****** Estimated audience requirements, by feature

******* Redesigned UI

Clear Instructions and Guidance: The documentation should provide clear step-by-step instructions on how to navigate and utilize the redesigned UI. It should guide users on the new layout, highlighting any changes or improvements made. Clear guidance on accessing and interacting with the new features, such as hiding/showing columns, moving action forms, and utilizing the new action button group, is essential.

Visual Aids: Users expect visual aids, such as screenshots or illustrations, to assist in understanding the new layout and UI elements. The documentation should include visual examples of the redesigned UI in action, demonstrating the location of new features and how to interact with them effectively.

Practical Examples: Users value practical examples that showcase real-world use cases of the redesigned UI. Providing examples that illustrate how to customize column visibility, perform actions using the new button group, and navigate through the side panels can help users grasp the practical applications of the new features.

Troubleshooting Guidance: As the redesigned UI introduces changes, users may encounter issues or have questions. The documentation should address common problems and provide troubleshooting guidance to help users resolve any issues they may face during the transition to the new UI.

Integration with Existing Documentation: Users expect seamless integration of the redesigned UI documentation with the existing MAAS documentation. It should be easy to navigate between related topics and find relevant information, ensuring a comprehensive and cohesive documentation experience.

Terminology and Language: The documentation should use terminology and language familiar to MAAS users. It should align with the language and concepts used in the UI, avoiding technical jargon or assuming extensive prior knowledge. Clear explanations and definitions of any new terms or concepts introduced in the redesigned UI should be provided.

Compatibility and Migration: Users may have concerns about the compatibility of their existing UI configurations or workflows with the redesigned UI. The documentation should address these concerns and provide guidance on any necessary migration steps or considerations.

******* Configurable session timeout

The MAAS UI admin users who primarily use the UI have specific requirements and expectations regarding the documentation for the Configurable Session Timeout feature. Here are the key points to consider:

Clear Instructions: The documentation should provide clear instructions on how to configure the session expiration timeout within the MAAS UI. Step-by-step guidance should be provided to ensure admins can easily navigate the settings and make the necessary changes.

Security Compliance: The documentation should emphasize the importance of configuring the session expiration timeout to comply with security requirements. It should highlight the potential risks of leaving sessions open for extended periods and the benefits of setting appropriate timeouts to mitigate unauthorized access.

Customization Options: Admins expect detailed information on the range of customization options available for the session timeout. The documentation should explain how to adjust the timeout duration based on specific needs, taking into account factors such as the level of risk, user requirements, and the nature of the environment.

Usability and Convenience: Admins should be informed about the default session timeout of two weeks, which ensures a balance between security and convenience. The documentation should explain how this default timeout provides a reasonable level of convenience for users while maintaining a secure environment.

Configuration Methods: Admins need to understand how to configure the session timeout through the MAAS UI Settings page. Additionally, advanced users may prefer to modify the timeout via the CLI. The documentation should cover both methods, providing clear instructions for each approach.

Use Cases and Scenarios: It would be helpful to provide real-world use cases and scenarios to illustrate the benefits and practical applications of configuring the session expiration timeout. This can help admins understand how to make informed decisions based on their specific environment and security requirements.

Troubleshooting and FAQs: Anticipate potential issues or questions that admins may encounter while configuring the session timeout. Include troubleshooting tips, common FAQs, and known limitations to assist admins in resolving any issues they may encounter.

By addressing these requirements and expectations, the documentation can effectively assist MAAS UI admin users in configuring the session expiration timeout feature, ensuring they have the necessary information to comply with security requirements and enhance the usability of the platform.

******* Ansible HA PostgreSQL Playbook Enhancements

For MAAS admins who monitor and configure MAAS via the command line, the documentation for the Ansible HA PostgreSQL Playbook Enhancements feature should meet the following requirements and expectations:

Depth and Complexity: The documentation should provide a detailed and comprehensive explanation of the enhancements made to the Ansible Playbooks for HA PostgreSQL. It should cover the technical aspects of configuring and managing the Pacemaker and Corosync components, as well as the refactoring of the Postgres roles. The documentation should assume a certain level of technical expertise and familiarity with the command line interface.

Prior Knowledge: The audience is expected to have prior knowledge of MAAS and its command line interface. The documentation should build upon this existing knowledge and focus on explaining the specific changes and enhancements introduced by the feature. It should highlight the benefits and implications of using Pacemaker, Corosync, and the refactored Postgres roles in the context of HA PostgreSQL deployments.

Scope of Information: The documentation should cover the entire feature implementation, including the installation and configuration of Pacemaker and Corosync, the refactoring of the Postgres roles, and the integration with HAProxy for proxying Postgres connections. It should provide step-by-step instructions, command examples, and configuration details to guide MAAS admins through the setup process.

Level of Detail: The documentation should include comprehensive explanations of the concepts, terminology, and commands involved in configuring HA PostgreSQL. It should provide in-depth information on the interactions between Pacemaker, Corosync, and the Postgres roles. It should also highlight any potential considerations, caveats, or best practices that admins should be aware of when implementing the feature.

Terminology: The documentation should use accurate and precise terminology familiar to MAAS admins working with the command line interface. It should provide clear definitions and explanations of any specialized terms or acronyms related to HA PostgreSQL and the Ansible Playbooks.

Code Examples: Since the audience is proficient in the command line interface, the documentation should include relevant code examples, command sequences, and configuration snippets to illustrate the configuration process. This will enable admins to understand the syntax and structure required to implement the feature effectively.

By addressing these requirements, the documentation will enable MAAS admins to understand and utilize the Ansible HA PostgreSQL Playbook Enhancements feature effectively. It will empower them to configure and manage HA PostgreSQL deployments using the command line interface, ensuring the stability, availability, and reliability of their MAAS infrastructure.

******* Ansible Observability Playbook

The MAAS admins who monitor and configure MAAS via the command line have specific requirements and expectations regarding the feature documentation for the Ansible Observability Playbook:

Comprehensive Command References: MAAS admins expect detailed command references that cover all available options and parameters related to the observability features. The documentation should provide clear examples of command syntax and usage to enable admins to effectively configure and manage the observability stack.

Advanced Configuration Examples: Since MAAS admins are familiar with the command line interface, they anticipate advanced configuration examples that showcase complex command sequences and workflows. These examples should address specific scenarios relevant to monitoring, alerting, and logging with the observability stack.

Troubleshooting Guidance: Documentation should include troubleshooting guides specific to the observability features. MAAS admins require detailed information on common issues, error messages, and steps to resolve potential problems encountered during setup, configuration, or operation of the observability stack.

Integration Instructions: As some organizations may already have an existing observability stack, MAAS admins would appreciate instructions on integrating the Ansible Observability Playbook with their pre-existing stack. The documentation should provide guidelines on configuring Prometheus and Loki instances to fire alerts on MAAS events and facilitate the integration process.

Grafana-Agent Configuration: Since the playbooks involve the installation and configuration of the grafana-agent, MAAS admins expect clear instructions on how to customize and fine-tune the agent's behavior. This includes setting up specific metric and log sources, configuring endpoints, and understanding the agent's interaction with Prometheus and Loki.

Security Considerations: Given the sensitive nature of monitoring and logging data, MAAS admins require documentation that addresses security considerations. This includes guidelines on securing inbound connections, managing authentication and access controls, and best practices for securing the observability stack components.

Compatibility and Dependencies: The documentation should outline any compatibility requirements and dependencies associated with the observability features. This includes specifying the supported versions of Prometheus, Loki, and other related components, as well as any prerequisite software or configurations.

By considering these specific requirements and expectations, the documentation for the Ansible Observability Playbook can effectively support MAAS admins in configuring, managing, troubleshooting, and integrating the observability stack for their MAAS deployments.

******* Packer - SLES++

For MAAS admins who monitor and configure MAAS via the command line, the feature documentation for Packer MAAS - SLES should address their specific requirements and expectations. Here's a summary of what they would expect:

Detailed Installation Instructions: MAAS admins would require step-by-step instructions on how to install and set up Packer with MAAS for SUSE Linux Enterprise Server (SLES). This would include information on any dependencies or prerequisites needed for the integration.

Configuration Options: The documentation should provide clear guidance on how to configure Packer templates specifically for SLES deployments. It should cover the necessary parameters, variables, and settings that need to be defined in the template file.

Integration with MAAS: MAAS admins would expect guidance on how to integrate Packer with their existing MAAS setup. This would involve instructions on authenticating Packer with MAAS, specifying the correct API endpoints, and any additional configurations needed for smooth interaction between Packer and MAAS.

Customization and Extensibility: MAAS admins often require flexibility to customize Packer templates to suit their specific deployment needs. The documentation should explain how to modify the template to include custom packages, configuration files, or scripts for SLES.

Troubleshooting and Best Practices: The documentation should provide troubleshooting tips and solutions for common issues that may arise during Packer builds for SLES. It should also offer best practices and recommendations to optimize the deployment process and improve the overall experience.

Integration with Other Distributions: Since the feature includes support for additional distributions like openSUSE, openSUSE Tumbleweed, and Red Hat Enterprise Linux (RHEL) version 9, the documentation should cover how to utilize Packer for these distributions as well. It should provide clear instructions and any distribution-specific considerations for successful integration.

Examples and Code Snippets: MAAS admins often find examples and code snippets valuable for understanding the correct syntax, structure, and usage of Packer templates. Including relevant examples and code snippets specific to SLES would greatly assist them in their configuration tasks.

By addressing these specific requirements and expectations, the documentation for Packer MAAS - SLES will enable MAAS admins to effectively utilize the feature, integrate Packer with their existing MAAS infrastructure, and confidently deploy SUSE Linux Enterprise Server (SLES) and other supported distributions.
** [#C] Actions describer
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-845
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Alexsander Silva de Souza
:Assignee: Jack Lloyd-Walters
:Issuetype: Task
:Created:  2022-07-19 21:06:25
:Modified: 2022-07-29 14:31:47
:END:
*** Description
*** Comments
** [#A] MAAS 3.3 feature doc [MAAS-TA-22P01]                 :ejira_assigned:
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-756
:TYPE:     ejira-issue
:Status:   Done
:Reporter: Bill Wear
:Assignee: Bill Wear
:Issuetype: Task
:Created:  2022-07-18 21:17:29
:Modified: 2023-05-10 07:22:53
:Effort:   80:00
:Left:     80:00
:END:
*** Description
The following features (most of these are not ready for prime time) are listed for MAAS 3.3 in the [[https://docs.google.com/spreadsheets/d/1qVLWYg5bjndt500n7TNZj9FcHOIch4qK5oBDK-dvlN4/edit#gid=2005610047][People Allocation]]:

                * Nvidia DPU (SmartNIC deployment MVP) + OPI
                ** [[https://docs.google.com/document/d/1m5zKgl2fah97Eku4IcQx1HDkt2t0TQUqof4M-DYvFi4/edit][Specification]]
                ** [[https://docs.google.com/document/d/1m5zKgl2fah97Eku4IcQx1HDkt2t0TQUqof4M-DYvFi4/edit#heading=h.qyg7xmvm3sbb][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-dpu][MM channel]]
                * MAAS on 22.04 LTS and core22 snap
                ** [[https://docs.google.com/document/d/1YstTlkbG8Ib0ovntW277QwtnzVNO5BQqQeWfFB8mdyE/edit][Specification]]
                ** [[https://docs.google.com/document/d/1YstTlkbG8Ib0ovntW277QwtnzVNO5BQqQeWfFB8mdyE/edit#heading=h.ekbxnm9kdzzl][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-jammy-base][MM channel]]
                * OpenAPI / Swagger
                ** [[https://docs.google.com/document/d/1_-QB1Q3lUzhGnH3rhpWdVoRqrwlYqQTYothXYL9J9dg/edit][Specification]]
                ** [[https://docs.google.com/document/d/1_-QB1Q3lUzhGnH3rhpWdVoRqrwlYqQTYothXYL9J9dg/edit#heading=h.qbf0gwduqpm2][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-openapi][MM channel]]
                * Server-side filtering for machine list UI
                ** [[https://docs.google.com/document/d/1B8CQXRxzapUq8dbSILzCZdrNzU49brVS8K5KQAZeQiw/edit][Specification]]
                ** [[https://docs.google.com/document/d/1B8CQXRxzapUq8dbSILzCZdrNzU49brVS8K5KQAZeQiw/edit#heading=h.1czsjbke1ky7][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-server-side-filtering][MM channel]]
                * Simultaneous machine deployments - reliability improvements
                ** [[https://docs.google.com/document/d/174tAfdZ12-s1lcrzAeqyMdLRQz03jHItFanfOzJobn8/edit][Specification]]
                ** [[https://docs.google.com/document/d/174tAfdZ12-s1lcrzAeqyMdLRQz03jHItFanfOzJobn8/edit#heading=h.3j4d7qnwr2k7][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-simultaneous-deployments][MM channel]]
                * Integrate Vault for credential storage
                ** [[https://docs.google.com/document/d/1ssfthB3g1kzELDaKgKdr4Mzt5n-eLQx11mnotvNbKJM/edit][Specification]]
                ** [[https://docs.google.com/document/d/1ssfthB3g1kzELDaKgKdr4Mzt5n-eLQx11mnotvNbKJM/edit#heading=h.f3mneqvboqtr][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-vault][MM channel]]
                * Ansible playbooks for HA MAAS and PostgreSQL
                ** [[https://docs.google.com/document/d/1jwAn1n7JQoApfCh6kkFAO_Gd9rZXl8IUq-o02KM-or8/edit][Specification]]
                ** [[https://docs.google.com/document/d/1jwAn1n7JQoApfCh6kkFAO_Gd9rZXl8IUq-o02KM-or8/edit#heading=h.nbgj678z887p][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-ansible-playbooks][MM channel]]
                * MAAS site identity
                ** [[https://docs.google.com/document/d/1mPUwTmP2atNFdGhnIukFbescv-tQGKzNFP_kYiLVHGc/edit][Specification]]
                ** [[https://docs.google.com/document/d/1mPUwTmP2atNFdGhnIukFbescv-tQGKzNFP_kYiLVHGc/edit#heading=h.iwj05cnsn4lb][Spec doc section]]
                ** [[https://chat.canonical.com/canonical/channels/maas-site-identity][MM channel]]
                * MAAS Ansible provider
                ** [[https://chat.canonical.com/canonical/channels/maas-ansible-provider][MM channel]]
                * MAAS Terraform provider
                ** [[https://chat.canonical.com/canonical/channels/maas-terraform-provider'][MM channel]]
                ** [[https://docs.google.com/document/d/1r1Uuoz2UVpvyD9mLuV_Bh8imPiKGwUH4nm9COiNlnbY/edit][Peripheral spec: Terraform doc improvements]]

                Calling upon [~accountid:70121:298364ed-4bb8-4ffb-bb4c-3a7e13fbd06c] , [~accountid:620a63688c763e0068d099b9] and [~accountid:6156c82fc7bea40069023542] to vet / update this list as necessary.
              [2022-09-21 Wed 12:03]
*** Comments
**** [2022-09-12 Mon 19:54] Bill Wear
:PROPERTIES:
:CommId:   96260
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2022-09-12 19:54:39
:Modified: 2022-09-21 17:01:29
:END:
******* 🖼️ Big picture / tie-together statements (testing org-jira):

*
**** [2022-09-21 Wed 17:24] Bill Wear
:PROPERTIES:
:CommId:   99322
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2022-09-21 17:24:11
:END:
this is a test comment
* DONE [#B] Storage profile Design
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-17
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Anton Smith
:Assignee: Bjorn Tillenius
:Issuetype: Epic
:Created:  2021-11-01 17:05:56
:Modified: 2022-03-10 13:55:59
:END:
*** Description
*** Comments
**** [2021-11-02 Tue 10:22] Anton Smith
:PROPERTIES:
:CommId:   24595
:TYPE:     ejira-comment
:Author:   Anton Smith
:Created:  2021-11-02 10:22:22
:END:
interesting reference material on machine profiles: [[https://support.hpe.com/hpesc/public/docDisplay?docId=a00104888en_us][https://support.hpe.com/hpesc/public/docDisplay?docId=a00104888en_us]]
* TODO [#B] SONiC ToR Spike - multitenant aware host connections
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-18
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Smith
:Assignee:
:Issuetype: Story
:Created:  2021-11-01 17:06:02
:Modified: 2023-02-20 13:58:20
:END:
*** Description
Goal is to provision with MAAS. Timeboxed spike for initial understanding, follow up with MVP
*** Comments
**** [2021-11-30 Tue 14:08] Adam Collard
:PROPERTIES:
:CommId:   29193
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2021-11-30 14:08:20
:END:
Serdar has done some research and knows about ONOS and P4
* TODO [#B] Network profiles
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-19
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Smith
:Assignee:
:Issuetype: Story
:Created:  2021-11-01 17:06:50
:Modified: 2023-02-20 13:58:27
:END:
** Description
** Comments
* TODO [#B] React migration -  Subnets list and subnet/fabric/VLAN/space details
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-20
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Anton Smith
:Assignee:
:Issuetype: Epic
:Created:  2021-11-01 17:07:00
:Modified: 2023-02-20 13:58:21
:END:
** Description
** Comments
* TODO [#C] Review inclusive naming project requests for MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-36
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Task
:Created:  2021-11-17 11:47:25
:Modified: 2023-02-20 13:58:27
:END:
** Description
Inclusive naming project have requested status of issues found in MAAS
** Comments
* TODO [#C] Commissioning with Jammy Images
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-49
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Diego Mascialino
:Assignee:
:Issuetype: Task
:Created:  2021-11-25 15:51:44
:Modified: 2023-02-20 13:58:31
:END:
** Description
Have a successful commisioning for our am64, arm64 and ppc64el in labmaas
** Comments
*** [2021-11-25 Thu 15:53] Diego Mascialino
:PROPERTIES:
:CommId:   28732
:TYPE:     ejira-comment
:Author:   Diego Mascialino
:Created:  2021-11-25 15:53:14
:END:
I filed this issue in curtin:[[https://bugs.launchpad.net/curtin/+bug/1952226|smart-link][https://bugs.launchpad.net/curtin/+bug/1952226]]
*** [2021-12-07 Tue 19:46] Diego Mascialino
:PROPERTIES:
:CommId:   30166
:TYPE:     ejira-comment
:Author:   Diego Mascialino
:Created:  2021-12-07 19:46:34
:END:
smartcl-validate is failing for opelt in the labmaas

{noformat}Unable to run 'smartctl-validate': Storage device 'PERC H730P Mini' with serial '61866da06e5723001f5b3a6e0ff3e538' not found!

This indicates the storage device has been removed or the OS is unable to find it due to a hardware failure. Please re-commission this node to re-discover the storage devices, or delete this device manually.

Given parameters:
{'storage': {'argument_format': '{path}', 'type': 'storage', 'value': {'id': 14, 'id_path': '/dev/disk/by-id/wwn-0x61866da06e5723001f5b3a6e0ff3e538', 'model': 'PERC H730P Mini', 'name': 'sda', 'serial': '61866da06e5723001f5b3a6e0ff3e538'}}}

Discovered storage devices:
[{'name': 'sda', 'model': 'PERC_H730P_Mini', 'serial': '0038e5f30f6e3a5b1f0023576ea06d86', 'maj:min': '8:0', 'model_enc': 'PERC H730P Mini'}]
Discovered interfaces:
{'18:66:da:6d:fb:3c': 'eno3'}{noformat}
*** [2022-02-18 Fri 09:29] Adam Collard
:PROPERTIES:
:CommId:   38673
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2022-02-18 09:29:31
:END:
[~accountid:6018030f8fb6ea014aaadb79] is this still an issue?
*** [2022-02-22 Tue 18:57] Diego Mascialino
:PROPERTIES:
:CommId:   39552
:TYPE:     ejira-comment
:Author:   Diego Mascialino
:Created:  2022-02-22 18:57:06
:END:
Yes, it is failing for amd64 machines.

Works well for arm64 and ppc64el
*** [2022-03-31 Thu 15:56] Diego Mascialino
:PROPERTIES:
:CommId:   53615
:TYPE:     ejira-comment
:Author:   Diego Mascialino
:Created:  2022-03-31 15:56:53
:END:
I opened this [[https://bugs.launchpad.net/maas/3.2/+bug/1967322|smart-link][https://bugs.launchpad.net/maas/3.2/+bug/1967322]]  to follow it
* TODO [#C] MAAS deploys fail if host has NIC w/ random MAC
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-51
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Bug
:Created:  2021-11-25 15:54:43
:Modified: 2023-02-20 13:58:35
:END:
** Description
https://bugs.launchpad.net/maas/+bug/1936972

Let's skip Redfish USB NICs as per suggestion 1) in the LP bug
** Comments
* TODO [#C] clarify how to set the DNS resolver setting in MAAS CLI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-58
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Sub-task
:Created:  2021-11-30 09:38:44
:Modified: 2023-02-20 13:58:27
:END:
** Description
We would like to clarify how to set the DNS resolver in MAAS, especially using the CLI because our users need an easy guide to getting past this basic configuration step without a lot of research.
** Comments
*** [2022-05-06 Fri 17:00] Bill Wear
:PROPERTIES:
:CommId:   64807
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2022-05-06 17:00:39
:END:
folded into checklist in https://warthogs.atlassian.net/browse/MAASENG-161
* TODO [#C] test high-availability and share documentable process/config
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-92
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Spike
:Created:  2021-12-01 20:24:53
:Modified: 2023-02-20 13:58:27
:END:
** Description
** Comments
* TODO [#C] stabilise API doc gen process
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-96
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Spike
:Created:  2021-12-01 20:25:48
:Modified: 2023-02-20 13:58:24
:END:
** Description
** Comments
* TODO [#C] MAAS Support
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-130
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Epic
:Created:  2021-12-14 12:29:12
:Modified: 2023-11-20 15:33:21
:END:
** Description
** Comments
* TODO [#C] Create Grafana dashboards for O11y
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-143
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Alexsander Silva de Souza
:Assignee:
:Issuetype: Story
:Created:  2022-01-04 15:54:15
:Modified: 2023-07-27 16:21:51
:Effort:   40:00
:Left:     40:00
:END:
** Description
** Comments
* TODO [#C] Figure out where we are with simplestreams and curtin updates
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-147
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Task
:Created:  2022-01-05 13:58:43
:Modified: 2023-02-20 13:58:19
:END:
** Description
** Comments
* TODO [#C] Move old images.maas.io logs to Prodstack 5
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-188
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2022-01-14 15:30:10
:Modified: 2023-02-20 13:58:33
:END:
** Description
The logs for images.maas.io from before the move to the new 100Gbs cluster are still in Prodstack 4.5, where they were before. We do use those logs to backfill old metrics data, but Prodstack 4.5 is due to be decomissioned.

We need to move those logs to Prodstack 4.5. Ideally to the same container where the new logs are, so that it will be easier to use them in the maas-kpi code.
** Comments
*** [2022-01-14 Fri 16:11] Bjorn Tillenius
:PROPERTIES:
:CommId:   33246
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-01-14 16:11:25
:END:
I sent an RT requesting the move:

[[https://portal.admin.canonical.com/135371][https://portal.admin.canonical.com/135371]]
* TODO [#C] Create operator charm to integrate MAAS and COS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-195
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Alexsander Silva de Souza
:Assignee:
:Issuetype: Story
:Created:  2022-01-18 01:18:27
:Modified: 2023-07-27 16:31:56
:Effort:   120:00
:Left:     120:00
:END:
** Description
** Comments
* TODO [#C] Document MAAS failure modes
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-196
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Alexsander Silva de Souza
:Assignee:
:Issuetype: Story
:Created:  2022-01-18 01:19:46
:Modified: 2023-02-20 13:58:25
:Effort:   80:00
:Left:     80:00
:END:
** Description
** Comments
* TODO [#C] MAAS release process/strategy
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-198
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Smith
:Assignee:
:Issuetype: Story
:Created:  2022-01-19 18:10:54
:Modified: 2023-02-20 13:58:24
:END:
** Description
We need a concise description in our docs about how we do releases, what processes we follow, how we handle bugs, how long we support releases for, etc. Does not need to be super extensive, rather concise, accurate and discoverable.

Ref:
https://discourse.maas.io/t/maas-versioning/5688
** Comments
* TODO [#C] Create overview spec for long-term plan and use cases
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-223
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2022-02-04 15:21:39
:Modified: 2023-07-12 08:39:49
:END:
** Description
There should be  a spec that gives a long-term plan for storage templates. It should be high-level and be used to keep track of how we will integrate with other teams, such as Juju, Openstack, and Ceph.
** Comments
*** [2022-02-04 Fri 15:25] Bjorn Tillenius
:PROPERTIES:
:CommId:   36009
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-02-04 15:25:20
:END:
Got some basic use case in place:

[[https://docs.google.com/document/d/1mqR5oVtKeVAWVLnBMISbAdpknXqHCSLXDppKjvPQUtU/edit#|smart-link][https://docs.google.com/document/d/1mqR5oVtKeVAWVLnBMISbAdpknXqHCSLXDppKjvPQUtU/edit#]]

Will need to add some diagrams and explain a bit more how templates and policies are expected to work.
*** [2022-07-11 Mon 14:21] Bjorn Tillenius
:PROPERTIES:
:CommId:   80685
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-07-11 14:21:01
:END:
I’m starting to look at this again this week. I’m currently going through the braindump and trying to remember what was said at the last meeting, so that I can start with modifying the doc to be more aligned.
*** [2022-07-19 Tue 14:00] Bjorn Tillenius
:PROPERTIES:
:CommId:   82743
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-07-19 14:00:00
:END:
Made some good progress today. I didn’t update the spec with my latest thinking, but I started to draw some examples in a miro board: [[https://miro.com/app/board/uXjVOlYdhjU=/|smart-link][https://miro.com/app/board/uXjVOlYdhjU=/]]
* TODO [#C] Review updated training materials from cloudbase
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-278
:TYPE:     ejira-story
:Status:   Untriaged
:Reporter: Anton Smith
:Assignee:
:Issuetype: Story
:Created:  2022-02-17 16:34:11
:Modified: 2023-02-20 13:58:22
:END:
** Description
[[https://docs.google.com/presentation/d/1i2q6lSkwZ2cR0kTq7qxDOPe3sUJdyKCV/edit?usp=sharing&ouid=105157906985511429852&rtpof=true&sd=true|smart-link][https://docs.google.com/presentation/d/1i2q6lSkwZ2cR0kTq7qxDOPe3sUJdyKCV/edit?usp=sharing&ouid=105157906985511429852&rtpof=true&sd=true]]



access can be granted by requesting it if needed. Contact is Octavian and Dan at cloudbase.
** Comments
* TODO [#C] Improve machine listing API performance
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-310
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Task
:Created:  2022-03-11 15:50:40
:Modified: 2023-02-20 13:58:34
:END:
** Description
This is a collection of all the issues related at actually making the machine listing API become quicker.
** Comments
* TODO [#C] Spike  trying to get rid of prefetches in the machine listing API
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-311
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Sub-task
:Created:  2022-03-11 15:52:16
:Modified: 2023-02-20 13:58:32
:END:
** Description
A big source of the slowness in the machine listing API is that we do a lot of prefetches. Simple tests suggests that rather than doing a big prefetch, it can be faster to refactor the API to work on all machines at once and do smarter queries to get the information we need.

I’m going to spike doing this for some simple attributes, as well as for interfaces, which is a nested structure that takes a significant amount of time to render.
** Comments
*** [2022-03-11 Fri 16:00] Bjorn Tillenius
:PROPERTIES:
:CommId:   45798
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-03-11 16:00:09
:END:
I’m doing the work here:

[[https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/perf-spike|smart-link][https://code.launchpad.net/~bjornt/maas/+git/maas/+ref/perf-spike]]

I have most of the simple attributes, as well as some of the foreign keys, like domain and owner working.

The main idea is that I want to make it so that we consider all the machines when construction the result, rather than working with one machine at a time. Currently I’m doing all the work in the machines handler, but as I flesh things out, I plan to move out code to other handlers, so that the same code gets used, no matter if you call the machines listing, or the interface listing API.
*** [2022-03-15 Tue 16:53] Bjorn Tillenius
:PROPERTIES:
:CommId:   46843
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-03-15 16:53:02
:END:
I got most of interface_set working know. What’s left to do is “discovered” and “links”. Both seems to be a simple query to the IP address table, so shouldn’t be too hard.

After that I want to make sure everything is included and see what kind of performance improvement I get. If it looks good, I’ll look into cleaning up the code and add tests.
*** [2022-03-25 Fri 15:42] Bjorn Tillenius
:PROPERTIES:
:CommId:   51422
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-03-25 15:42:21
:END:
Had to work on other tasks for a while, but I’m back working on this now.
*** [2022-03-29 Tue 15:23] Bjorn Tillenius
:PROPERTIES:
:CommId:   52453
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-03-29 15:23:06
:END:
Adding “links” was a bit harder than I had expected. I have something now that uses a more focused prefetch and still requires a constant number of queries. But that made it go from taking 1.8 seconds to 2.8 seconds.

I’m going to see if I can get rid of the prefetch altogether and optimize the code to get the links.
*** [2022-03-30 Wed 15:31] Bjorn Tillenius
:PROPERTIES:
:CommId:   52943
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-03-30 15:31:45
:END:
I got “discovered” and “links” working now, without prefetching. It brought it down from 2.8 seconds to 2.4 seconds. So a bit, but less then I had hoped for.

I did some simple profiling, but I couldn’t find anything obvious to optimize. I think we need to look at how it copes with 10 000 machines to get a clearer view of where the time is spent.

I did find out that get_api_description() gets called as well. By calling it from the test setup, to populate the cache, I got it down to 1.7 seconds.

I’m going to try to figure out how to land this in master now.
*** [2022-04-11 Mon 14:30] Bjorn Tillenius
:PROPERTIES:
:CommId:   57167
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-04-11 14:30:53
:END:
I got something working for the VLAN handler now. It was a bit tricky to get working, since there were not tests ensuring that changing the rendering wouldn’t break anything.

Also, the spike did some things in a hacky way. I had to spend time on figuring out how to do what I want to do in a less hacky way. What I have seems to work fine for the VLAN handler, but it might change when I go up the stack and want to reuse this handler from other handlers, like the Subnet one.
*** [2022-04-13 Wed 15:56] Bjorn Tillenius
:PROPERTIES:
:CommId:   58055
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-04-13 15:56:43
:END:
Got the Subnet handler working now and refactored things a bit to make it more readable. I also had to modify piston so that other handlers that used subnets and vlans continued working.

Now I’m working on Interface handler, which is the most complex one. There were already some complex tests already, though, so hopefully I won’t have to add that many tests before I start with the JSON serialization.
*** [2022-04-14 Thu 14:21] Bjorn Tillenius
:PROPERTIES:
:CommId:   58653
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2022-04-14 14:21:54
:END:
Landed the branch that increases the test coverage for the vlan, subnet and interface handlers.

Next I will work on serializing in the interface handler. I expect it to be a bit tricky, since they way I re-use the other handlers is currently done in a way to reduce the number of queries. I might have to change that a bit to make it more readable.
* TODO [#C] Internal documentation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-349
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Epic
:Created:  2022-03-18 15:06:42
:Modified: 2023-02-20 13:58:21
:END:
** Description
** Comments
* TODO [#C] Expand "How to use launchpad" internal document
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-350
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:13:08
:Modified: 2023-02-20 13:58:19
:END:
** Description
** Comments
*** [2022-03-18 Fri 15:16] Bill Wear
:PROPERTIES:
:CommId:   48613
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2022-03-18 15:16:36
:END:
[[https://discourse.maas.io/t/how-to-use-launchpad/4657][https://discourse.maas.io/t/how-to-use-launchpad/4657]]
* TODO [#C] How to triage bugs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-351
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:17:44
:Modified: 2023-02-20 13:58:20
:END:
** Description
** Comments
*** [2022-03-18 Fri 15:18] Bill Wear
:PROPERTIES:
:CommId:   48614
:TYPE:     ejira-comment
:Author:   Bill Wear
:Created:  2022-03-18 15:18:06
:END:
[[https://discourse.maas.io/t/how-to-triage-bugs/4695][https://discourse.maas.io/t/how-to-triage-bugs/4695]]
* TODO [#C] How to handle merge proposals
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-352
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:19:22
:Modified: 2023-02-20 13:58:23
:END:
** Description
[[https://discourse.maas.io/t/how-to-handle-merge-proposals-mps/4696][https://discourse.maas.io/t/how-to-handle-merge-proposals-mps/4696]]
** Comments
* TODO [#C] How to develop spanning features (UI/core)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-353
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:22:01
:Modified: 2023-02-20 13:58:26
:END:
** Description
[[https://discourse.maas.io/t/how-to-develop-spanning-features-ui-core/4697][https://discourse.maas.io/t/how-to-develop-spanning-features-ui-core/4697]]
** Comments
* TODO [#C] How to choose the next bug to fix
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-354
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:23:00
:Modified: 2023-02-20 13:58:27
:END:
** Description
[[https://discourse.maas.io/t/how-to-choose-the-next-bug-to-fix/4698][https://discourse.maas.io/t/how-to-choose-the-next-bug-to-fix/4698]]
** Comments
* TODO [#C] MAAS development best practices
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-355
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:24:31
:Modified: 2023-02-20 13:58:25
:END:
** Description
[[https://discourse.maas.io/t/maas-development-best-practices/4701][https://discourse.maas.io/t/maas-development-best-practices/4701]]
** Comments
* TODO [#C] How to use our labmaas
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-356
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:26:49
:Modified: 2023-02-20 13:58:23
:END:
** Description
[[https://discourse.maas.io/t/how-to-use-our-labmaas/4702][https://discourse.maas.io/t/how-to-use-our-labmaas/4702]]
** Comments
* TODO [#C] How to QA spanning features (UI/core)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-357
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:27:37
:Modified: 2023-02-20 13:58:27
:END:
** Description
[[https://discourse.maas.io/t/how-to-qa-spanning-features-ui-core/4703][https://discourse.maas.io/t/how-to-qa-spanning-features-ui-core/4703]]
** Comments
* TODO [#C] Promoting images
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-358
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-03-18 15:28:23
:Modified: 2023-02-20 13:58:24
:END:
** Description
[[https://discourse.maas.io/t/promoting-images/4704][https://discourse.maas.io/t/promoting-images/4704]]
** Comments
* TODO [#C] Add maasbot and wire up to Jenkins
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-471
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Adam Collard
:Assignee:
:Issuetype: Task
:Created:  2022-05-10 15:35:43
:Modified: 2023-02-20 13:58:23
:END:
** Description
** Comments
* TODO [#C] LP#1958451: bmc_skip_config doesn't work during enlistment
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-537
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Bug
:Created:  2022-05-25 14:49:23
:Modified: 2023-02-20 13:58:33
:END:
** Description
The user cannot skip BMC configuration during enlistment. This is a result of the target host using an anonymous endpoint to download from MAAS scripts run before the enlistment, so MAAS is unaware of the host id and cannot give it instructions to skip any script. A possible fix is to split the BCM handling in two scripts, one to detect current power parameters and another to configure them. The former always run during enlistment and the latter runs during commissioning when the host id is already known.
** Comments
* TODO [#C] Server-side filtering for machine list
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-574
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Epic
:Created:  2022-06-06 00:10:19
:Modified: 2023-02-20 13:58:27
:END:
** Description
** Comments
* DONE [#C] Directory layout cutover script
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-665
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Christian Grabowski
:Assignee: Christian Grabowski
:Issuetype: Task
:Created:  2022-07-06 14:01:12
:Modified: 2022-07-07 13:56:53
:END:
** Description
** Comments
* TODO [#C] Investigate PF-3651
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-678
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2022-07-08 09:16:51
:Modified: 2023-02-20 13:58:31
:END:
** Description
Need to check whether we can make changes in MAAS to allow ssh and prevent reboots during deployment, or whether changes in curtin are needed.
** Comments
* TODO [#C] System tests for deploying many machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-860
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Christian Grabowski
:Assignee: Christian Grabowski
:Issuetype: Task
:Created:  2022-07-26 20:24:39
:Modified: 2023-05-10 11:35:40
:END:
** Description
** Comments
*** [2023-03-01 Wed 11:02] Adam Collard
:PROPERTIES:
:CommId:   195097
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-03-01 11:02:44
:END:
[~accountid:606c651e4532c90069697f10] what’s the state of this? Can you link the MP that needs reviewing?
* TODO [#C] IP allocation performance tests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-863
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Christian Grabowski
:Assignee:
:Issuetype: Task
:Created:  2022-07-26 20:45:54
:Modified: 2023-02-20 13:58:34
:END:
** Description
** Comments
* TODO [#C] Metadata field may_reboot not working correctly in 20.04
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-875
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Bug
:Created:  2022-07-28 00:22:53
:Modified: 2023-02-20 13:58:26
:END:
** Description
** Comments
* TODO [#C] Add required parameters to path element definition
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-876
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Jack Lloyd-Walters
:Assignee:
:Issuetype: Sub-task
:Created:  2022-07-28 14:29:31
:Modified: 2023-02-20 13:58:33
:END:
** Description
When adding the current OpenAI spec into the swagger editor, a few errors arise when a required parameter is not listed in the path element:
ie:

=/vm-hosts/{id}/?op=remove_tag=
removing a tag from a vm-host has both an id and tag name as required parameters, but our current path element only contains the ID:

In theory, this should contain something along the lines of:
=/vm-hosts/{id}/?op=remove_tag&tag={tag=}



Of course, correct me if I am wrong
** Comments
* TODO [#C] sort out MAAS PostgreSQL DB well enough that we can document reasonable sizing and design guidelines (see DESC)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-877
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-07-28 21:51:16
:Modified: 2023-05-24 14:31:31
:END:
** Description
Writing the MAAS postgres design doc spec produced the following comments, which the tech author is not able to adjudicate without help from the engineering team:

MAAS does 3 things that are not DB-friendly:

1. it does tons of requests. Most tables are small so there isn't much the user can do to improve performance. This is on us.
2. it stores large objects. MAAS stores images in the DB, and the DB should be tuned for this. The storage capacity also needs to be planned for this.
3. there's one ever-growing table. The Events table grows without bounds, and this also requires storage capacity planning

Right, events and images are probably the main thing that make it hard to give sizing guidelines. I agree that we should be able to give a rough estimate of how much storage maas uses per machine, but the number of events depend on how much the machine is used (e.g. redeployed), so there's not a simple answer.

We also should give guidance on how to tweak the Postgres deployment. For example, how many connections to allow, buffer/cache sizes, and so on.

Another thing would be to talk about the fact that MAAS uses NOTIFY and LISTEN, which means that you can't put pgbouncer with transaction pooling in between.
** Comments
* TODO [#C] sort out RBAC sufficiently to get it to a workable/documentable state (see DESC)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-878
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Bill Wear
:Assignee:
:Issuetype: Task
:Created:  2022-07-28 22:03:20
:Modified: 2023-03-01 15:56:59
:END:
** Description
!AFdZucor5oS77FXFP6QGhmfhUjg9MWLT8gXz0nkbZBk0=s50-c-k-no|width=50,height=50,alt="Alexsander Silva de Souza"!

Alexsander Silva de Souza

6:00 PM Jul 25

There's a bigger issue here: RBAC itself is not part of the release cycle, the current stable version depends on Bionic.

!AFdZucor5oS77FXFP6QGhmfhUjg9MWLT8gXz0nkbZBk0=s50-c-k-no|width=50,height=50,alt="Alexsander Silva de Souza"!

Alexsander Silva de Souza

6:03 PM Jul 25

One of the reasons no existing tutorial is reliable is that each time MAAS or Ubuntu is updated, a new set of tricks is required to get RBAC working again.

!AFdZucowPtqh8rv3LhcgS0KRn5gubybLtuzqF1L72vuUWA=s50-c-k-no|width=50,height=50,alt="Alberto Donato"!

Alberto Donato

1:49 AM Today

Right. This is because we never released 1.1, which runs on focal. In reality, both versions of the snap can actually run on jammy as well, since they're snaps, but the deb that we provide in the PPA is actually currently bionic-specific (and focal-specific for 1.1).

What I've suggested in the past is that we could actually drop the logic in the deb postinst to install/configure postgres and candid, since this doesn't provide much value (AFAIU field engs actually often just unpack the deb and get the snap out) and we could have debs for focal + jammy which just install the same version of the snap.
** Comments
* TODO [#C] Schema design
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-997
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Epic
:Created:  2022-09-13 07:20:06
:Modified: 2023-08-16 08:39:55
:END:
** Description
The goal here is to get a proposal on how the data model (especially the DB schema) in MAAS should look like. Given the functionality we have today, how should the data model look like to make it more understandable and give better performance.

There should also be a set of rules that gives guidance on how to name things and how to add new parts to the model.
** Comments
* TODO [#C] Create rules for naming tables, columns, indexes, constraints
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-999
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2022-09-13 07:24:25
:Modified: 2023-10-24 07:42:55
:END:
** Description
When adding or modifying a new model, it should be clear on how to name things in the database. The goal is to make the naming consistent and to make it simpler, so that it’s easier to explore the database using tools like =psql=.
** Comments
*** [2023-05-10 Wed 14:14] Bjorn Tillenius
:PROPERTIES:
:CommId:   238192
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-05-10 14:14:07
:END:
[[https://docs.google.com/document/d/1umh0IElwHbs1dOdMX0ai06aBeXgceAcdXYm5aVYsnow/edit#|smart-link][https://docs.google.com/document/d/1umh0IElwHbs1dOdMX0ai06aBeXgceAcdXYm5aVYsnow/edit#]]  is now ready for review. Sent out a request to maas-design.
*** [2023-10-03 Tue 08:32] Bjorn Tillenius
:PROPERTIES:
:CommId:   320720
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-03 08:32:10
:END:
I’ve picked up this, starting to address the comments. Jacopo already addressed a few, and the big remaining one is to have an outline of the current schema, as well as some directions for how we want to evolve the model in the future.

To keep the MA119 spec clean and concise, I started another spec to outline the model and the future direction:

[[https://docs.google.com/document/d/1Q54W0TJiL_ZN3XEt6l2WQBi0dKBrTiAF-HS6mC4P7gU/edit|smart-link][https://docs.google.com/document/d/1Q54W0TJiL_ZN3XEt6l2WQBi0dKBrTiAF-HS6mC4P7gU/edit]]

It’s still in an early stage, though, but plan to complete it this week.
*** [2023-10-12 Thu 09:08] Bjorn Tillenius
:PROPERTIES:
:CommId:   324948
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-10-12 09:08:27
:END:
Almost done updating MA144, but I want to spend some time on uefi https booting today, since we need to be able to estimate the work.
* TODO [#C] Create a visualization of the data schema that is always up to date
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1000
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Task
:Created:  2022-09-13 07:24:40
:Modified: 2023-07-21 14:43:18
:END:
** Description
It should be easy to explore the current database schema. The goal here is to use something like =schemaspy= and have a job that updates the visualization regularly.
** Comments
* DONE [#C] Allow sorting images by last deployed
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1113
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee: Peter Makowski
:Issuetype: Epic
:Created:  2022-11-21 09:43:39
:Modified: 2023-03-01 10:54:52
:END:
** Description
** Comments
* TODO [#C] [Implementation] MAAS Site Manager 1.0
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1116
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Epic
:Created:  2022-11-21 16:22:53
:Modified: 2023-10-31 15:06:33
:END:
** Description
** Comments
* DONE [#C] [Design and Spec] MAAS Site Manager 1.0
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1117
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee: Thorsten Merten
:Issuetype: Epic
:Created:  2022-11-21 16:22:16
:Modified: 2023-05-16 12:40:22
:END:
** Description
** Comments
* DONE [#C] [Spike] Faster machine list via dedicated query
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1118
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Epic
:Created:  2022-11-21 16:21:10
:Modified: 2023-03-31 10:04:40
:END:
** Description
** Comments
* DONE [#C] Configurable session timeout
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1119
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee: Nick De Villiers
:Issuetype: Epic
:Created:  2022-11-21 09:45:45
:Modified: 2023-03-16 16:42:59
:END:
** Description
** Comments
* TODO [#C] Integrate machine.get_latest_failed_testing_script_results endpoint
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1158
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2022-12-01 15:34:15
:Modified: 2023-03-02 17:24:19
:END:
** Description
[[https://docs.google.com/document/d/1B8CQXRxzapUq8dbSILzCZdrNzU49brVS8K5KQAZeQiw/edit#heading=h.23nophmqwq4s|smart-link][https://docs.google.com/document/d/1B8CQXRxzapUq8dbSILzCZdrNzU49brVS8K5KQAZeQiw/edit#heading=h.23nophmqwq4s]]
** Comments
*** [2023-03-01 Wed 12:32] Adam Collard
:PROPERTIES:
:CommId:   195181
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-03-01 12:32:42
:END:
[~accountid:618e26d4e1b3e00069718a8d] what’s the state of this?
*** [2023-03-01 Wed 12:39] Peter Makowski
:PROPERTIES:
:CommId:   195186
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-03-01 12:39:17
:END:
[~accountid:70121:298364ed-4bb8-4ffb-bb4c-3a7e13fbd06c]  The status of this ticket seems to be correct. It wasn’t part of the initial release as it was marked optional in the spec.
*** [2023-03-02 Thu 16:55] Adam Collard
:PROPERTIES:
:CommId:   196132
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-03-02 16:55:35
:END:
[~accountid:618e26d4e1b3e00069718a8d] hmm, Untriaged is not a valid state - it can’t be part of server-side filtering since that work is done. Is it “just” a nice-to-have? What does ‘integration’ even mean? What would change if we did this?
*** [2023-03-02 Thu 17:24] Peter Makowski
:PROPERTIES:
:CommId:   196149
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-03-02 17:24:19
:END:
You’re right. In that case I’d suggest we either move it to UI Maintenance or mark as rejected.

This is described in more detail in the linked specification. In short, in MAAS 3.2 and earlier the UI would hide a bulk action action that cannot be performed on selected machines and inform the user about the number of machines that do not have failed tests once you open “Override failed tests” action form.

This wasn’t really in line with the how bulk actions are handled post server-side filtering and not part of the initial specification (we now allow to perform all actions and only display errors/warnings after attempting to perform the action in case anything has failed).
* DONE [#C] Update packer-maas templates
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1164
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Epic
:Created:  2022-12-05 22:09:14
:Modified: 2023-03-01 11:01:39
:END:
** Description
RHEL 9, SLES, update ESXI
** Comments
* TODO [#C] Define MAAS UI OKRs
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1171
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2022-12-06 09:58:01
:Modified: 2023-04-04 07:43:17
:END:
** Description
we need to identify *key areas of focus for MAAS UI* (AFAIK there’s nothing that exists at the moment)There's a number of things we should be focusing on improving I believe.

- We should base this on [[https://docs.google.com/presentation/d/1Z5_oObBjNxh29IeLET9765znYSf_7fWm7sX3hFhPFn4/edit?skip_itp2_check=true&pli=1#slide=id.g10feb6ab35d_3_250|smart-link][https://docs.google.com/presentation/d/1Z5_oObBjNxh29IeLET9765znYSf_7fWm7sX3hFhPFn4/edit?skip_itp2_check=true&pli=1#slide=id.g10feb6ab35d_3_250]] and core values:
*Metal* - Multi-vendor, multi-architecture, and OS-neutral by default.
- *Be a cloud* - Cloud abstraction that celebrates metal.
- *Beautiful UX* - Modern, helpful, and well-documented Web, CLI and API.
- *Proven scale and performance* - Fastest provisioning for the largest private data-centres in the world.
- *Lightweight*  - Scale down gracefully to small cluster and edge.
- *Automation* - Minimal human effort in the data-centre.
- *Ecosystem* - Create & maintain integrations for popular cloud orchestration tooling.
- *Operational excellence* - On-rails experience out of the box with comprehensive documentation.
- *Production grade* - Reliable, observable product that is robust, fault tolerant and secure.
- *Professional* - Trust and credibility with great training, certifications, community presence & exceptional pre and post-sales support.
- *Engineering excellence* - Clean architecture and great contributor experience, with a modern and maintainable tech stack.

Some ideas:

- we need to identify and focus our efforts on *key pages* - ones that are most often used (or important for other reasons),
- *bug fixes* - we need to be proactive around fixing bugs and issues (monitoring sentry etc.)
- *improving performance* (including tracking it continuously)
- *improving development workflow* - making it easier to contribute to and try out the MAAS UI. Currently we've got practically 0 external contributors, we should aim to be in a place when we can participate in initiatives such as hacktoberfest that would allow for wider engagement of the open source community and running MAAS UI should be possible via single command

[[https://docs.google.com/document/d/14i_3HpPHJ5WGk6zmeGpgFUMAcR7RzMct7KhcLVc6CC0/edit|smart-link][https://docs.google.com/document/d/14i_3HpPHJ5WGk6zmeGpgFUMAcR7RzMct7KhcLVc6CC0/edit]]
** Comments
* TODO [#C] MAAS UI Maintenance
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1172
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Epic
:Created:  2022-12-06 10:42:46
:Modified: 2023-11-23 12:46:36
:END:
** Description
** Comments
* TODO [#C] [ui] provide a way to disable swap files added by default to all deployed machines
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1175
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Task
:Created:  2022-12-06 10:49:12
:Modified: 2023-02-20 13:58:29
:END:
** Description
[[https://github.com/canonical/maas-ui/issues/1527|smart-link][https://github.com/canonical/maas-ui/issues/1527]]
** Comments
* TODO [#C] MAAS Rack in Go: Power drivers isolation
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1193
:TYPE:     ejira-epic
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Epic
:Created:  2022-12-07 15:29:41
:Modified: 2023-02-20 13:58:23
:END:
** Description
Power management: extract power drivers to separate binaries (with the intention to run them on the rack), define a clear public API for community contributions
** Comments
* TODO [#C] As a MAAS Maintainer, I want to have a contract between Rack controllers and power drivers
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1198
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2022-12-09 15:32:11
:Modified: 2023-02-20 13:58:35
:END:
** Description
** Comments
* TODO [#C] Define a contract that power drivers should implement, so they can be called by Rack controllers
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1199
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Sub-task
:Created:  2022-12-09 15:32:32
:Modified: 2023-05-10 07:24:45
:END:
** Description
** Comments
* TODO [#C] Define data needed for controllers and devices UI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1200
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2022-12-12 08:42:21
:Modified: 2023-02-20 13:58:32
:END:
** Description
[[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1196?focusedCommentId=122492|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1196?focusedCommentId=122492]]
”it would be great to also know which fields are used for devices and controllers. Right now we have a base NodeHandler which populates a lot of fields that are supposed to be common to all three kinds of nodes, but I suspect most of them are only used by machines, so they could be moved there”
** Comments
* TODO [#C] [MAAS UI] Remove unused machine.list properties
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1201
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2022-12-12 12:21:12
:Modified: 2023-02-20 13:58:30
:END:
** Description
We should try and remove unused properties from the UI (technically this change could land in the main branch). More on that in the spec below.

[[https://docs.google.com/document/d/1cDQxuEdNHkrk95Y9Qn0iiUMUerE90itEQ_eTzcGfK-k/edit#heading=h.43doqdjcodw1|smart-link][https://docs.google.com/document/d/1cDQxuEdNHkrk95Y9Qn0iiUMUerE90itEQ_eTzcGfK-k/edit#heading=h.43doqdjcodw1]]
** Comments
* TODO [#C] As a MAAS Maintainer, I want to isolate existing power drivers, so they no longer import Rack controller related code.
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1206
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2022-12-16 15:27:27
:Modified: 2023-05-10 07:24:55
:END:
** Description
Power drivers should not be dependent on things related to Rack Controllers. In order to communicate with the Rack controller they should implement the contract.
** Comments
* TODO [#C] Implement a new contract for each power driver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1207
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:28:03
:Modified: 2023-10-03 14:42:34
:END:
** Description
** Comments
* TODO [#C] Move enlistment and node creation (RPC calls) from chassis drivers to Rack.
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1208
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Sub-task
:Created:  2022-12-16 15:28:09
:Modified: 2023-03-17 15:39:12
:END:
** Description
** Comments
* DONE [#C] Move each power driver to a Python module
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1209
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:28:14
:Modified: 2023-03-10 09:14:20
:END:
** Description
** Comments
* TODO [#C] As a MAAS Maintainer, I want Rack controller to be able to call external power drivers that implement a special protocol
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1210
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2022-12-16 15:29:08
:Modified: 2023-02-20 13:58:34
:END:
** Description
** Comments
* TODO [#C] Implement protocol that allows Rack to call external power drivers
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1211
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:29:21
:Modified: 2023-02-20 13:58:31
:END:
** Description
** Comments
* TODO [#C] As a MAAS Maintainer, I want to remove any power driver related imports from Rack controller code.
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1212
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2022-12-16 15:29:41
:Modified: 2023-02-20 13:58:33
:END:
** Description
** Comments
* TODO [#C] Remove power driver related dependencies from the Rack controller
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1213
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:29:56
:Modified: 2023-02-20 13:58:34
:END:
** Description
** Comments
* TODO [#C] Change the way Rack controller calls power drivers. It should call them as an external script/binary in a subprocess
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1214
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:30:01
:Modified: 2023-02-20 13:58:31
:END:
** Description
** Comments
* TODO [#C] Describe the new way of how users can create their own power drivers
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1215
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2022-12-16 15:30:05
:Modified: 2023-02-20 13:58:35
:END:
** Description
** Comments
* TODO [#C] Backport 1996997 to 3.3
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1217
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Task
:Created:  2023-01-09 09:38:01
:Modified: 2023-02-20 13:58:35
:END:
** Description
Once RC-2 is green, we should merge this MP

[[https://code.launchpad.net/~troyanov/maas/+git/maas/+merge/435350|smart-link][https://code.launchpad.net/~troyanov/maas/+git/maas/+merge/435350]]
** Comments
* TODO [#C] Add new machine list page test to existing sitespeed action
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1221
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-01-11 12:26:21
:Modified: 2023-02-20 13:58:19
:END:
** Description
** Comments
* DONE [#C] Image Storage Redesign
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1232
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Christian Grabowski
:Assignee:
:Issuetype: Epic
:Created:  2023-01-13 17:33:23
:Modified: 2023-10-24 14:34:50
:END:
** Description
** Comments
* TODO [#C] Add pre-flight checks into the deb and snap for upgrade
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1234
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Christian Grabowski
:Assignee:
:Issuetype: Task
:Created:  2023-01-13 18:00:55
:Modified: 2023-08-28 22:34:50
:END:
** Description
** Comments
* DONE [#C] Provide path of image on image server in BootResource
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1239
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Christian Grabowski
:Assignee: Alexsander Silva de Souza
:Issuetype: Task
:Created:  2023-01-13 18:02:56
:Modified: 2023-11-14 15:35:57
:END:
** Description
We want to keep a name-based image path in configurations generated for netboot for debugging purpose. The path should contain the image hash so that the returned content is actually the hash-named file on disk
** Comments
* DONE [#C] Rack Controller Image download and caching
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1240
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Christian Grabowski
:Assignee: Christian Grabowski
:Issuetype: Task
:Created:  2023-01-13 18:03:13
:Modified: 2023-10-31 19:04:44
:END:
** Description
** Comments
* TODO [#C] [Dev] list candidates for removal from the machine list UI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1248
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-01-17 09:40:14
:Modified: 2023-02-20 13:58:31
:END:
** Description
based on the list of expensive properties, list candidates for removal from the machine list UI and discuss with design
** Comments
* TODO [#C] Map MachineStateListGroup type
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1281
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-02-01 12:01:09
:Modified: 2023-02-20 13:58:35
:END:
** Description
Add strict typing for MachineStateListGroup using custom =FilterGroupOptionType=

remove =as string= used in MachineList.tsx
** Comments
* TODO [#D] Provide a way to query status of 'config-tls' (enabled/disabled) via API and CLI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1283
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: David Desrosiers
:Assignee:
:Issuetype: Task
:Created:  2023-02-01 21:56:03
:Modified: 2023-02-20 13:58:22
:END:
** Description
The CLI and API can enable and disable TLS, but there’s no read-only way to query the status/state of that value via the same CLI or API (eg: =maas admin maas get-config name=tls= or similar).

T-Mobile has an immediate need to query their estate to provide this output as they are using Puppet for configuration management, and this is not yet exposed. The closest I could find was =get-config name=tls_cert_expiration_notification_enabled=. but that’s not definitive. (see case [[https://canonical.lightning.force.com/lightning/r/Case/5004K00000THbiLQAT/view][00353627]] for context)

Thanks MAAS team!
** Comments
* TODO [#C] Site Manager: Onboarding Workflow
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1286
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-02-06 08:16:26
:Modified: 2023-02-20 13:58:32
:END:
** Description
- Design the onboarding workflow as outlined here [[https://docs.google.com/document/d/1qCHvmaI3ppw0Vai-ETSKML5Qlm0Gzn0R1_o67m3noNQ/edit#heading=h.xwygrat930ce|smart-link][https://docs.google.com/document/d/1qCHvmaI3ppw0Vai-ETSKML5Qlm0Gzn0R1_o67m3noNQ/edit#heading=h.xwygrat930ce]]
    - Important: M2M Token generation and swapping the onboarding token to the generated token
    - What if MAAS client not yet authenticated?
- Design the API
- Design the related data model
** Comments
* TODO [#C] Site Manager: MAAS onboarding client
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1287
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-02-06 08:18:49
:Modified: 2023-09-12 14:42:20
:END:
** Description
A little client/process/service that can live next to MAAS and does the Site Manager connection.

- Onboarding part of this workflow, see [[https://docs.google.com/document/d/1qCHvmaI3ppw0Vai-ETSKML5Qlm0Gzn0R1_o67m3noNQ/edit#heading=h.xwygrat930ce|smart-link][https://docs.google.com/document/d/1qCHvmaI3ppw0Vai-ETSKML5Qlm0Gzn0R1_o67m3noNQ/edit#heading=h.xwygrat930ce]]  (WIP, but should not change dramatically, see notes)
- Related to [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1286|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1286]]
** Comments
* TODO [#C] Site Manager: Check in workflow
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1288
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-02-06 08:24:53
:Modified: 2023-02-20 13:58:32
:END:
** Description
As for onboarding, this needs to be designed in terms of

- workflow
- API
- authentication (note that this should not use the onboarding token anymore but a machine to machine token)
- Datamodel [[https://docs.google.com/document/d/1iQQafJjN7OmzI0pNLZFUDp85RLiCN3uwpuqf_1f20Ak/edit#heading=h.w35g06d60v7w|smart-link][https://docs.google.com/document/d/1iQQafJjN7OmzI0pNLZFUDp85RLiCN3uwpuqf_1f20Ak/edit#heading=h.w35g06d60v7w]]
** Comments
* TODO [#C] Site Manager: MAAS check in
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1291
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-02-06 08:31:13
:Modified: 2023-02-20 13:58:32
:END:
** Description
The client in [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1287|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1287]] needs to be extended to do regular checkins to the site manager. It should report about the data mentioned here: [[https://docs.google.com/document/d/1iQQafJjN7OmzI0pNLZFUDp85RLiCN3uwpuqf_1f20Ak/edit#heading=h.w35g06d60v7w|smart-link][https://docs.google.com/document/d/1iQQafJjN7OmzI0pNLZFUDp85RLiCN3uwpuqf_1f20Ak/edit#heading=h.w35g06d60v7w]]



API design: Should the client have a state? Should it be able to sent partial updates?



Related to [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1288|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1288]]
** Comments
* DONE [#C] HA Postgres Failover for Ansible Playbooks
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1302
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Christian Grabowski
:Assignee: Christian Grabowski
:Issuetype: Epic
:Created:  2023-02-06 15:02:52
:Modified: 2023-03-01 11:00:47
:END:
** Description
** Comments
* TODO [#C] [Dev] Mark all UTC timestamps
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1315
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-02-07 13:44:17
:Modified: 2023-02-20 13:58:22
:END:
** Description
Update all timestamps used across the app which are in UTC format

From:

=Tue, 07 Feb. 2023 12:58:29=

To:

=Tue, 07 Feb. 2023 12:58:29 (UTC)=



[[https://chat.canonical.com/canonical/pl/jp1rh9udh7835p14i4wirhinfw][https://chat.canonical.com/canonical/pl/jp1rh9udh7835p14i4wirhinfw]]
** Comments
* TODO [#C] Rack/Region DHCP
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1327
:TYPE:     ejira-story
:Status:   Done
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Story
:Created:  2023-02-08 15:34:46
:Modified: 2023-02-21 15:35:56
:END:
** Description
** Comments
* TODO [#C] Site Manager: Spec out frontend MVP
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1353
:TYPE:     ejira-issue
:Status:   In Review
:Reporter: Thorsten Merten
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-02-13 11:29:27
:Modified: 2023-02-17 15:34:32
:END:
** Description
Based on the [[https://docs.google.com/document/d/1-JSxar0t2vhB5WQon_1NDFM98ODn6AfFV6GFsQira-4/edit][MAAS Site Manager Spec]] and the table that [[https://docs.google.com/spreadsheets/d/1bYqv9bojCTPwwAIG6iyAte67RocNYCjg-fJ_paELgNM/edit#gid=1255855884][breaks down MAAS Site Manager into tasks]] we need to create a specification on the frontend.

[[https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit|smart-link][https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit]]

This should at least include:

- Architecture discussions (this should be done first as it unblocks other things)
    - How communication to the backend should be done (e.g. via redux, per component, or … )
    - What libraries we (might) want to use and why

-  (links to) the wireframes/prototypes that are already available
- Data needs and/or REST API suggestions for the backend per view
- CI/CD
- (feel free to add to this list)
** Comments
* TODO [#C] [UX] Define what should be displayed in the footer
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1357
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee: Amy Pattanasethanon
:Issuetype: Task
:Created:  2023-02-14 14:09:58
:Modified: 2023-02-20 13:58:23
:END:
** Description
“For this MVP, should we move the MAAS name to the footer, just so our users recall the placement (and remove it from the side nav). Then when we finalise what goes into the footer, we can bring the MAAS name to the side nav/” [[https://zpl.io/xmgwOEm|smart-link][https://zpl.io/xmgwOEm]]
** Comments
*** [2023-02-14 Tue 19:52] Amy Pattanasethanon
:PROPERTIES:
:CommId:   188323
:TYPE:     ejira-comment
:Author:   Amy Pattanasethanon
:Created:  2023-02-14 19:52:23
:END:
Do you need design for this, or can start dev [~accountid:618e26d4e1b3e00069718a8d]
*** [2023-02-15 Wed 09:20] Peter Makowski
:PROPERTIES:
:CommId:   188561
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-02-15 09:20:04
:END:
I suppose this is not a part of the MVP but something to investigate later.
* DONE [#C] MAAS HA O11y
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1360
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Alexsander Silva de Souza
:Assignee: Alexsander Silva de Souza
:Issuetype: Epic
:Created:  2023-02-14 15:36:08
:Modified: 2023-03-01 11:01:16
:END:
** Description
** Comments
* DONE [#C] Add shift + click selection of machines form multi selection
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1370
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Jones Ogolo
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-02-15 11:08:31
:Modified: 2023-02-15 11:08:32
:END:
** Description
Shift + click should select a range of machines on the machine list page when grouping is set to “no grouping”
** Comments
* DONE [#C] MAAS Tour
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1371
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Epic
:Created:  2023-02-15 16:19:29
:Modified: 2023-03-01 11:00:17
:END:
** Description
** Comments
* TODO [#C] Unnecessary calls made to load KVMs in the UI
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1382
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Nick De Villiers
:Assignee:
:Issuetype: Task
:Created:  2023-02-16 16:27:22
:Modified: 2023-02-20 13:58:21
:END:
** Description
[[https://github.com/canonical/maas-ui/pull/4767|smart-link][https://github.com/canonical/maas-ui/pull/4767]]



An unnecessary request is being made on the KVMs page to load pods, which are already being loaded when the navigation loads now (due to conditionally displaying “virsh” in the nav). This results in a flash of the loading indicator when you visit one of the KVM pages.
** Comments
* TODO [#C] [1] As an operator, I want to browse all enrolled sites and see data that is relevant to me
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1386
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-02-17 14:55:51
:Modified: 2023-02-20 13:58:31
:END:
** Description
** Comments
*** [2023-02-17 Fri 15:02] Peter Makowski
:PROPERTIES:
:CommId:   189965
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-02-17 15:02:18
:END:
props to [~accountid:62a75900bf7afc006f3aa340] for the initial breakdown of these 🙏
* TODO [#C] [Dev] API integration for filtered list
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1392
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Sub-task
:Created:  2023-02-17 15:03:37
:Modified: 2023-03-01 08:40:09
:END:
** Description
** Comments
* TODO [#C] [Dev] Eliminate the base node type
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1420
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-02-27 10:59:24
:Modified: 2023-02-27 10:59:43
:END:
** Description
Separate implementations of handlers for machines, controllers and devices (eliminating the base one for node), since they present different data
** Comments
* DONE [#C] Consolidate Onboarding documents
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1421
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Thorsten Merten
:Assignee: Jones Ogolo
:Issuetype: Task
:Created:  2023-02-27 12:59:47
:Modified: 2023-06-05 08:35:31
:END:
** Description
There are currently three potentially valid onboarding docs for UI folks in MAAS.

1. [[https://docs.google.com/document/d/18n4Ec2NLsIdQQaiYckTtB7tTQHRnqPJqtQqMdEj2kjc/edit#heading=h.yij8xaij9lcy|smart-link][https://docs.google.com/document/d/18n4Ec2NLsIdQQaiYckTtB7tTQHRnqPJqtQqMdEj2kjc/edit#heading=h.yij8xaij9lcy]] , see [[https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1255|smart-link][https://warthogs.atlassian.net/browse/https://warthogs.atlassian.net/browse/MAASENG-1255]]
2. The UI team onboarding doc
3. The MAAS team onboarding doc

We need to define of these three documents as a “base” document for new onbaording people (should be either 2. or 3. above) and make sure to have something like an appendix to it to capture the stuff in the other docs.

Please:

- check where there are overlaps
- create copies and mark what is unique AND frontend related
- be opinionated about which document to use as base and from which documents to create the appendixes from
- discuss with [~accountid:633d97f7140ba0bf651dee6a]
    - create the appendix
** Comments
* TODO [#C] Modular table grouping
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1426
:TYPE:     ejira-issue
:Status:   BLOCKED
:Reporter: Amy Pattanasethanon
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-02-27 17:59:05
:Modified: 2023-07-28 14:41:42
:END:
** Description
*Acceptance criteria*

- Group by column is displayed when group by value is selected.
- If a user selects ‘No grouping’, this Group by column disappears
- when group is collapsed and some items within that group have been selected, group by checkbox should display an indeterminate state
-  when group is collapsed and all items within that group have been selected, group by checkbox should display a checked state

*Implementation will involve at least the following tasks*

- add a new conditionally displayed column for group by value
- adjust table styles to align with the design
- updating group checkbox status to take into account values in a collapsed group

----

Modular table grouping is not implemented yet, which made it a little harder to make the header component complete.

!image-20230313-110906.png|width=1449,height=652!

[[https://zpl.io/JE3QwJx|smart-link][https://zpl.io/JE3QwJx]]
** Comments
*** [2023-07-12 Wed 12:37] Peter Makowski
:PROPERTIES:
:CommId:   276559
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-07-12 12:37:30
:END:
After further consideration and having experienced an interactive version of this I’m unsure this is a good change.

Whilst it can help with visual clarity, it reduces the amount of space available for displaying information about machines even further (and it’s something that users complained about).

There are also a few edge cases that aren’t addressed in the design, e.g.: if there’s only 1 machine in a collapsed group, expanding the group doesn’t cause the group to expand which seems unexpected (almost broken). Whilst it could be my personal bias, I feel like this might need some more thought. Considering that Amy is currently on leave we might want to put it on hold and get back to it at a later date.

For reference - I implemented the new grouping on a branch: [[https://github.com/petermakowski/maas-ui/tree/modular-table-grouping-https://warthogs.atlassian.net/browse/MAASENG-1426|smart-link][https://github.com/petermakowski/maas-ui/tree/modular-table-grouping-https://warthogs.atlassian.net/browse/MAASENG-1426]]

note that it’s missing a few stylistic changes and has some failing tests, but other than this it’s complete as per design.
*** [2023-07-12 Wed 13:25] Thorsten Merten
:PROPERTIES:
:CommId:   276591
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-07-12 13:25:51
:END:
Thank you [~accountid:618e26d4e1b3e00069718a8d] . Good thoughts. Just to clarify: In terms of reduced space you mean the horizontal space (due to the grouping column), right?

In terms of the vertical layout this is an improvement imo as it feels more like a list this way without the “two line separators”
*** [2023-07-12 Wed 14:07] Peter Makowski
:PROPERTIES:
:CommId:   276645
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-07-12 14:07:13
:END:
Correct, I mean the reduced horizontal space. I also agree with you that it is an improvement in some regards, as I mentioned, I do think “it can help with visual clarity”.
*** [2023-07-13 Thu 08:48] Peter Makowski
:PROPERTIES:
:CommId:   277063
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-07-13 08:48:23
:END:
We discussed this in detail with [~accountid:63b3c5e878aabbefa9d429f0] and would like to put it on hold until Amy comes back and/or designers revisit tables if that’s OK with you [~accountid:633d97f7140ba0bf651dee6a]
* TODO [#C] Spike: Infiniband support in MAAS
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1429
:TYPE:     ejira-epic
:Status:   BLOCKED
:Reporter: Adam Collard
:Assignee: Alberto Donato
:Issuetype: Epic
:Created:  2023-02-28 15:55:25
:Modified: 2023-08-16 08:35:51
:Effort:   160:00
:Left:     160:00
:END:
** Description
See [[https://warthogs.atlassian.net/browse/PF-3204|smart-link][https://warthogs.atlassian.net/browse/PF-3204]].

Come back with answers to the following:

- How do we configure netplan?
- Can you do bonding with Infiniband? Bridges?
- How do we configure DHCPD?
- Are there other changes required in MAAS beyond loosening the MAC address field type?
- Network booting on IPoIB only devices.

Also see: [[https://docs.google.com/document/d/1wKAO51u5I1glSckQw5xRmMfTQnIdu85arRG5cZ3MamQ/edit#][Spec]]
** Comments
*** [2023-03-06 Mon 11:59] Adam Collard
:PROPERTIES:
:CommId:   197238
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-03-06 11:59:25
:END:
Blocked due to missing hardware for Infiniband
* DONE [#C] Optimised kernel deployment on DGX
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1440
:TYPE:     ejira-epic
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Epic
:Created:  2023-03-01 14:25:07
:Modified: 2023-03-01 14:29:43
:END:
** Description
** Comments
* TODO [#C] [3] As a MAAS admin, I want to sync the DGX kernel from images.maas.io, so that I don’t have to maintain my own stream
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1443
:TYPE:     ejira-story
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Story
:Created:  2023-03-01 14:27:25
:Modified: 2023-08-17 14:12:58
:END:
** Description
** Comments
* TODO [#C] Research how to build a custom streams locally
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1445
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee: Bjorn Tillenius
:Issuetype: Sub-task
:Created:  2023-03-01 14:40:16
:Modified: 2023-03-10 15:53:30
:END:
** Description
** Comments
* TODO [#C] Improved kernel modelling
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1452
:TYPE:     ejira-epic
:Status:   Triaged
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Epic
:Created:  2023-03-03 11:07:01
:Modified: 2023-03-27 12:37:10
:END:
** Description
** Comments
* TODO [#C] [1] Identify changes in model/API to support IB devices
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1458
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-03-06 07:37:49
:Modified: 2023-03-06 07:41:13
:END:
** Description
** Comments
* TODO [#C] [2] Identify components and services that need to be aware of IB devices
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1459
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-03-06 07:38:34
:Modified: 2023-03-06 07:41:20
:END:
** Description
** Comments
* TODO [#C] [3] Identify how a machine needs to be configured to commission/deploy with IB devices
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1460
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-03-06 07:39:10
:Modified: 2023-03-06 07:39:10
:END:
** Description
** Comments
* TODO [#C] [4] Identify which network configurations available in MAAS are supported on IB
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1461
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-03-06 07:39:33
:Modified: 2023-03-06 07:39:34
:END:
** Description
** Comments
* TODO [#C] [5] Collect spike results in a document
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1462
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Alberto Donato
:Assignee:
:Issuetype: Task
:Created:  2023-03-06 07:40:38
:Modified: 2023-03-06 07:40:38
:END:
** Description
[[https://docs.google.com/document/d/1_lsAE57qRbMI9NWhYLOdHQ_lunDRtHiYo0KGERuP_38/edit#][This document]] should contain the results of the spike
** Comments
* DONE [#C] Investigate why LXD core and memory counts dropped Feb 25
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1464
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Bjorn Tillenius
:Assignee:
:Issuetype: Task
:Created:  2023-03-07 13:55:19
:Modified: 2023-03-07 14:53:05
:END:
** Description
Between February 24 and February 25 the counts for memory and cores for LXD VM hosts dropped from around 17 000 cores down to 10 000 cores. Memory dropped from around 145 TiB to 43 TiB.

At the same time 3.2.7 and 3.1.1 were released.
** Comments
*** [2023-03-07 Tue 13:57] Bjorn Tillenius
:PROPERTIES:
:CommId:   198202
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-03-07 13:57:22
:END:
I tried installing 3.2.7 and 3.1.1 and deploying a LXD VM host. Adding debug prints shows that the LXD stats are sent correctly.

I will poke around a bit in influxdb to see if I can find some clues there, and possibly also trying to upgrade to 3.1.1 and 3.2.7, rather than doing a fresh install.
*** [2023-03-07 Tue 14:53] Bjorn Tillenius
:PROPERTIES:
:CommId:   198241
:TYPE:     ejira-comment
:Author:   Bjorn Tillenius
:Created:  2023-03-07 14:53:05
:END:
Looking in influxd, i can see that the number of available lxd cores drops from around 13 000 to around 5 000 on 2023-02-25 for MAAS 3.2 deployments. MAAS 3.1 numbers seem stable around that date.

Also, for MAAS 3.2 the number of lxd vm hosts goes down from 177 to  147.

The number of reporting 3.2 deployments also seems to be down, but it’s not as clear as for the rest of the data. The number of reporting deployments seems to be going down on 2023-02-18.

{noformat}> SELECT count("machines") AS "Reports", sum("vm_hosts_lxd_total") AS "LXD", sum("vm_hosts_lxd_available_cores") AS "LXD available" FROM "maas.daily_stats" WHERE ("maas_version" =~ /3ktasqzhthowdnwtrmuovfpeetpqgugjs.2ktasqzhthowdnwtrmuovfpeetpqgugjs..*/) AND time >= now() - 30d GROUP BY time(1d)
name: maas.daily_stats
time                 Reports LXD LXD available
----                 ------- --- -------------
2023-02-05T00:00:00Z 0
2023-02-06T00:00:00Z 908     193 12390
2023-02-07T00:00:00Z 920     199 13566
2023-02-08T00:00:00Z 940     198 13585
2023-02-09T00:00:00Z 907     176 12225
2023-02-10T00:00:00Z 899     196 13429
2023-02-11T00:00:00Z 862     191 13377
2023-02-12T00:00:00Z 866     192 13369
2023-02-13T00:00:00Z 892     183 13186
2023-02-14T00:00:00Z 885     168 11874
2023-02-15T00:00:00Z 870     179 13021
2023-02-16T00:00:00Z 862     185 13050
2023-02-17T00:00:00Z 873     201 13173
2023-02-18T00:00:00Z 831     178 12973
2023-02-19T00:00:00Z 823     177 12993
2023-02-20T00:00:00Z 885     205 13213
2023-02-21T00:00:00Z 845     181 13021
2023-02-22T00:00:00Z 846     165 11673
2023-02-23T00:00:00Z 853     176 12877
2023-02-24T00:00:00Z 845     177 12901
2023-02-25T00:00:00Z 821     147 5094
2023-02-26T00:00:00Z 810     148 5101
2023-02-27T00:00:00Z 839     151 5133
2023-02-28T00:00:00Z 827     133 3829
2023-03-01T00:00:00Z 831     146 5077
2023-03-02T00:00:00Z 837     149 5275
2023-03-03T00:00:00Z 832     133 4007
2023-03-04T00:00:00Z 800     145 5247
2023-03-05T00:00:00Z 0
2023-03-06T00:00:00Z 0
2023-03-07T00:00:00Z 0
{noformat}
* TODO [#C] [2] As an operator I want to enrol a site
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1472
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-03-14 11:33:55
:Modified: 2023-03-14 11:44:32
:END:
** Description
** Comments
* TODO [#C] Fetch tokens from the back-end
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1475
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Sub-task
:Created:  2023-03-14 11:40:32
:Modified: 2023-03-15 14:31:28
:END:
** Description
** Comments
* TODO [#C] Post request to create a token
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1479
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Sub-task
:Created:  2023-03-14 11:48:02
:Modified: 2023-05-09 08:03:46
:END:
** Description
Integrate back-end endpoint for *HTTP POST /tokens/*

Acceptance criteria

- Post request to create a token
    - Requires name, amount, and expiration time
    - Returns list of tokens

[[https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit#heading=h.1l4q7j2430y6|smart-link][https://docs.google.com/document/d/1P82_RDYicbHencsbUvOoMB5jtqY3BzwZNNkEcoKtq9E/edit#heading=h.1l4q7j2430y6]]
** Comments
* TODO [#C] [Dev] dispatch "status/websocketError" for abnormal close codes
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1484
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-03-15 12:26:23
:Modified: 2023-03-15 12:26:24
:END:
** Description
** Comments
* DONE [#C] Create the spec for the new search.
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1488
:TYPE:     ejira-issue
:Status:   In Progress
:Reporter: Amy Pattanasethanon
:Assignee:
:Issuetype: Task
:Created:  2023-03-16 15:46:36
:Modified: 2023-09-11 13:49:40
:END:
** Description
Create a spec for search (MA063) with the new layout UI.

- Vanilla alignment
- Save search
- Search history
- AND/OR logic
** Comments
* TODO [#C] Site manager: improve return types in backend/msm/db/queries.py
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1493
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-03-17 16:25:20
:Modified: 2023-03-20 11:11:33
:END:
** Description
We currently return

{noformat}-> Iterable[dict[str, Any]]{noformat}

It would be good to be more specific and ideally we can re-use -either SQLAlchemy tables or- pydantic models for this so that we avoid specifying roughly the same data structure at three places.
** Comments
*** [2023-03-20 Mon 09:33] Adam Collard
:PROPERTIES:
:CommId:   205058
:TYPE:     ejira-comment
:Author:   Adam Collard
:Created:  2023-03-20 09:33:18
:END:
Have you thought about having query layer return Pydantic types? I think that makes the most sense and easiest to understand.
*** [2023-03-20 Mon 11:11] Thorsten Merten
:PROPERTIES:
:CommId:   205200
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-03-20 11:11:04
:END:
Yes, I think that doing the conversion over there makes a lot of sense as well. I’ll update the description accordingly.
* TODO [#C] Improve which architectures we show in the import screen
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1506
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee: Peter Makowski
:Issuetype: Task
:Created:  2023-03-27 12:37:10
:Modified: 2023-03-29 15:39:27
:END:
** Description
[~accountid:6324835fce3e476e42adf576] should have details and possibly screenshots
** Comments
*** [2023-03-28 Tue 08:03] Igor Brovtsin
:PROPERTIES:
:CommId:   211194
:TYPE:     ejira-comment
:Author:   Igor Brovtsin
:Created:  2023-03-28 08:03:28
:Modified: 2023-03-28 08:15:26
:END:
Not quite sure what this task is about. When I tested whether nvidia kernels will work with 3.3, I saw the following UI issues:

- Image import (=Showing images fetched from <source>=) screen uses the release name provided in simplestream, while the rest of the UI ignores it, e.g. Image sync (=Showing images synced from=) screen (backend issue, we return different names)

*Image import screen*

!image-20230328-075110.png|width=477,height=417!


*Image sync screen*

!image-20230328-075414.png|width=501,height=286!


- UI seems to show fixed set of architectures for all releases, regardless of whether they exist or not. It is possible to “deactivate” architectures by passing additional parameter from backend, but we might want to improve the approach there (or at least implement proper architecture handling on the backend). E.g. NVIDIA kernels only have =amd64= declared in simplestream:

*Image import screen, architecture picker*

!image-20230328-080148.png|width=420,height=282!

Not sure which one of these matches the =long labels fitting in the screen= description though.
*** [2023-03-29 Wed 07:59] Thorsten Merten
:PROPERTIES:
:CommId:   212252
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-03-29 07:59:49
:END:
Thanks for the details [~accountid:6324835fce3e476e42adf576] . Do I understand correctly, that the only frontend issue is to improve which architectures we should show in the import screen (the ones that actually exist)?
*** [2023-03-29 Wed 08:07] Igor Brovtsin
:PROPERTIES:
:CommId:   212264
:TYPE:     ejira-comment
:Author:   Igor Brovtsin
:Created:  2023-03-29 08:07:01
:END:
[~accountid:633d97f7140ba0bf651dee6a] correct.
*** [2023-03-29 Wed 11:13] Thorsten Merten
:PROPERTIES:
:CommId:   212433
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-03-29 11:13:21
:END:
Peter: Do you know if we have all the information to do that or does this need backend work as well?
*** [2023-03-29 Wed 15:29] Peter Makowski
:PROPERTIES:
:CommId:   212983
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-03-29 15:29:39
:END:
[~accountid:633d97f7140ba0bf651dee6a]  Like Igor said, it is already possible to disable specific architecture checkboxes for each release. We currently do it on the front-end based on the value of =unsupported_arches= parameter which is set by the back-end, which means there isn’t any work required for the front-end.

Once the back-end improves architecture handling and adds all architectures that should be hidden to  =unsupported_arches=  it should just work ™
*** [2023-03-29 Wed 15:39] Igor Brovtsin
:PROPERTIES:
:CommId:   213040
:TYPE:     ejira-comment
:Author:   Igor Brovtsin
:Created:  2023-03-29 15:39:27
:END:
[~accountid:618e26d4e1b3e00069718a8d] We might want to hide the checkboxes for unsupported architectures entirely once we will have more platform-specific kernels, so that we won’t clutter older releases arch list. However, I don’t think now is the right time for this discussion
* TODO [#C] Enrolment Confirmation List View
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1507
:TYPE:     ejira-issue
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Task
:Created:  2023-03-27 12:51:48
:Modified: 2023-03-27 14:36:48
:END:
** Description
When a site onboards in MAAS Site Manager it will not be displayed in the “Regions” List view immediately. Instead it will be shown in a “Enrolment Requests” screen, where the user has to confirm that the site should be enroled.

Designs can be found here:

[[https://zpl.io/GEYMGE4|smart-link][https://zpl.io/GEYMGE4]]  (also see the indented ones below)

To accept/deny a/multiple requests the user selects one or many rows and clicks accept/deny in upper right corner.
** Comments
* TODO [#C] [Dev] Enable e2e DHCP tests
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1527
:TYPE:     ejira-issue
:Status:   Untriaged
:Reporter: Peter Makowski
:Assignee:
:Issuetype: Task
:Created:  2023-03-30 12:41:06
:Modified: 2023-03-30 12:41:06
:END:
** Description
=enable DHCP tests once we can have reliable way of testing for DHCP=
** Comments
* TODO [#C] Sorting
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1568
:TYPE:     ejira-subtask
:Status:   BLOCKED
:Reporter: Maximilian Blazek
:Assignee:
:Issuetype: Sub-task
:Created:  2023-04-17 10:47:11
:Modified: 2023-04-18 07:27:44
:END:
** Description
!qSy3vdUUWoRV65Xq_gUuZTElBIceT69R8_UXvfowCYwewGkEOykry4Uvx47aoChVGRZbNRsum_tyLw6MEi5aMK-llJTGP3zLk21R4TsrTteRDm3OE4GmRs2qRKQF7sQcAnimMOL8tYpUk634Neb5Pko|width=1600,height=984!
** Comments
*** [2023-04-17 Mon 11:42] Peter Makowski
:PROPERTIES:
:CommId:   226508
:TYPE:     ejira-comment
:Author:   Peter Makowski
:Created:  2023-04-17 11:42:09
:END:
This needs some back-end input as back-end sorting has not been discussed and is not included in the specification. I was under the impression that we do not want any sorting in the MVP, in which case this could be marked as rejected. [~accountid:633d97f7140ba0bf651dee6a]
*** [2023-04-18 Tue 07:27] Thorsten Merten
:PROPERTIES:
:CommId:   227316
:TYPE:     ejira-comment
:Author:   Thorsten Merten
:Created:  2023-04-18 07:27:44
:END:
[~accountid:618e26d4e1b3e00069718a8d] : I’ll check with the backend. It makes sense to add this asap but we are currently only sorting by ID.
* TODO [#C] Add link to bug report once available
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1588
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Nick De Villiers
:Assignee: Nick De Villiers
:Issuetype: Sub-task
:Created:  2023-04-19 13:57:58
:Modified: 2023-04-27 08:16:30
:END:
** Description
** Comments
* TODO [#C] Add readable and write-able settings per user
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1537
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-04-04 13:36:59
:Modified: 2023-05-24 07:35:56
:END:
** Description
The first use case for settings is that we have a welcome screen that should only be presented once.

After login (or even during login) we should return user settings (e.g. welcome-screen: true). Also a user should be able to write to their own settings (e.g. patch with welcome-screen = false).

For writing can either:

- allow updates for single settings (partial update, Patch)
- allow putting the whole settings object (put)

The settings could be stored in their own table or in a json field attached to the user.

(personally I am leaning towards the simpler solutions, e.g. updating all settings at once as long as they are not becoming really huge and using a json field to store them but in case we prefer partial updates a table might be more elegant)

Please contact [~accountid:618e26d4e1b3e00069718a8d] to discuss use cases, API schema preferences, way of updating.

Initial use cases can be:

- -(short term) storing the polling/update frequency of the front-end- (should be a global setting)
- persisting views (e.g. sort order, displayed/hidden columns
- (mid term, as a learning from MAAS) session timeout
** Comments
* TODO [#C] Add audit logging
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1542
:TYPE:     ejira-subtask
:Status:   Triaged
:Reporter: Thorsten Merten
:Assignee:
:Issuetype: Sub-task
:Created:  2023-04-11 07:10:51
:Modified: 2023-04-18 09:45:46
:END:
** Description
We should add an audit log and save at least

- when a token was successfully used
- when a site was created
- when a site was deleted
- when a token is used that cannot/should not be used anymore (e.g. expired, depleted)

TBD: We might want to store token usage and site creation timestamp in the token and site tables as well for easy access and display.
** Comments
* TODO [#C] Implement POST zone create and plug it in the websocket handler in maasserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-1789
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-05-31 12:35:13
:Modified: 2023-05-31 12:36:18
:END:
** Description
** Comments
* TODO [#C] Expose Temporal SDK metrics (regiond)
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2007
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2023-07-24 22:29:22
:Modified: 2023-07-25 12:26:18
:END:
** Description
SDK metrics setup

[[https://docs.temporal.io/kb/prometheus-grafana-setup#sdk-metrics-setup|smart-link][https://docs.temporal.io/kb/prometheus-grafana-setup#sdk-metrics-setup]]
** Comments
* TODO [#C] Implement RBAC services in maasapiserver
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2035
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Jacopo Rota
:Assignee:
:Issuetype: Sub-task
:Created:  2023-07-28 14:41:33
:Modified: 2023-07-28 14:41:34
:END:
** Description
** Comments
* TODO [#C] Extend API to support release script uploading
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2296
:TYPE:     ejira-subtask
:Status:   Done
:Reporter: Anton Troyanov
:Assignee: Alberto Donato
:Issuetype: Sub-task
:Created:  2023-10-18 21:43:26
:Modified: 2023-10-27 13:08:26
:END:
** Description
** Comments
* TODO [#C] Remove special if-else case conditions and model “Erase disk” functionality as release script
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2304
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2023-10-18 21:45:07
:Modified: 2023-10-18 21:45:08
:END:
** Description
** Comments
* DONE [#C] Add release scripts into user-data generated for machine during Release life cycle
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2306
:TYPE:     ejira-subtask
:Status:   In Progress
:Reporter: Anton Troyanov
:Assignee: Anton Troyanov
:Issuetype: Sub-task
:Created:  2023-10-18 21:45:35
:Modified: 2023-10-31 14:46:59
:END:
** Description
** Comments
* TODO [#C] Return Release script results via API
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2308
:TYPE:     ejira-subtask
:Status:   Untriaged
:Reporter: Anton Troyanov
:Assignee:
:Issuetype: Sub-task
:Created:  2023-10-18 21:46:12
:Modified: 2023-10-18 21:46:12
:END:
** Description
** Comments
* TODO [#C] Promote Mantic
:PROPERTIES:
:ID:       https://warthogs.atlassian.net/browse/MAASENG-2399
:TYPE:     ejira-subtask
:Status:   In Review
:Reporter: Jack Lloyd-Walters
:Assignee: Jack Lloyd-Walters 
:Issuetype: Sub-task
:Created:  2023-11-15 15:33:41
:Modified: 2023-11-28 15:31:47
:END:
** Description
** Comments

